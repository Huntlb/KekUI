// ==UserScript==
// @name        KEK UI
// @description Hordes UI Script
// @namespace   https://hordes.io/
// @match       https://hordes.io/play
// @run-at      document-start
// @icon        https://www.google.com/s2/favicons?sz=64&domain=hordes.io
// @license     KEK
// @author      Scrizz and Grigory
// @version     0.50.665
// @grant       none
// ==/UserScript==
"use strict";const e="0.50.665",t="kekStorage",s={hordes:{default:{baseUrl:"",endpoints:{account:{method:"GET",endpoint:"account/info"}}},item:{baseUrl:"https://hordes.io/api",endpoints:{get:{method:"POST",endpoint:"item/get",bodyParams:["ids"],ttl:36e5},getnew:{method:"POST",endpoint:"item/getPlayerEquipped",bodyParams:["ids","pid"],ttl:36e5}}},player:{baseUrl:"https://hordes.io/api",endpoints:{get:{method:"POST",endpoint:"playerinfo/search",bodyParams:["name","order","limit","offset"]}}}},kek:{friend:{baseUrl:"https://hordes-friends-api.vercel.app",endpoints:{status:{method:"POST",endpoint:"status",bodyParams:["player_name","status_flag"]},get:{method:"POST",endpoint:"friends",bodyParams:["player_name"]},add:{method:"POST",endpoint:"add_friend",bodyParams:["player_name","friend_name"]},remove:{method:"POST",endpoint:"remove_friend",bodyParams:["player_name","friend_name"]}}},gloom:{baseUrl:"https://fasthordesapimongo.onrender.com",endpoints:{personal:{method:"POST",endpoint:"info",bodyParams:["player_name"]},ranking:{method:"POST",endpoint:"rankings",bodyParams:["player_name","required_arg","optional_args"]}}},tierlist:{baseUrl:"https://hordes-tierlist-api.vercel.app",endpoints:{rank:{method:"POST",endpoint:"rank",bodyParams:["classid","build_score"],ttl:36e5}}}}};const a=new class{constructor(){this.cache=new Map}init(){}async request(e="hordes.default.account",t){const a=(e=e.split("."))[0],n=e[1],i=e[2],o=s[a][n];if(!o)throw new Error(`Base URL key '${n}' not found in ApiUrls`);const r=o.endpoints[i];if(!r)throw new Error(`Endpoint '${i}' not found in ApiUrls[${a}][${n}]`);const l=this.generateCacheKey(i,t,n),c=this.cache.get(l);if(c&&Date.now()-c.timestamp<c.ttl)return c.data;const d=`${o.baseUrl}/${r.endpoint}`,h={method:r.method,headers:{"Content-Type":"application/json"}};if("GET"===r.method){const e=Object.entries(t).map((([e,t])=>`${encodeURIComponent(e)}=${encodeURIComponent(t)}`)).join("&");e&&(h.url+=`?${e}`)}else{const e={};r.bodyParams&&r.bodyParams.forEach((s=>{void 0!==t[s]&&(e[s]=t[s])})),r.sendTtl&&(e.ttl=r.ttl||0),Object.keys(e).length>0&&(h.body=JSON.stringify(e))}const m=await fetch(d,h);if(!m.ok)throw new Error(`Failed to fetch data from ${d}. Status: ${m.status}`);const p=await m.json();return this.cache.set(l,{data:p,timestamp:Date.now(),ttl:r.ttl}),p}generateCacheKey(e,t,s){return`${s}:${e}:${JSON.stringify(t)}`}};const n=new class{init(){}};function i(...e){(new Error).stack.split("\n").map((e=>e.split(" "))).filter((e=>e.length>6&&!e[6].includes("(<anonymous>)"))).map((e=>e[5])).reverse().join("::")}const o=new class{#e={};on(e,t,s){this.#e[e]||(this.#e[e]=[]);if(this.#e[e].find((e=>e.originalCallback===t&&e.context===s)))i();else{const a=function(...e){t.call(s,...e)};this.#e[e].push({originalCallback:t,context:s,wrappedCallback:a})}}off(e,t,s){const a=this.#e[e]?.find((e=>e.originalCallback===t&&e.context===s));a?this.#e[e]=this.#e[e].filter((e=>e!==a)):i()}trigger(e,...t){this.#e[e]&&this.#e[e].forEach((e=>e.wrappedCallback(...t)))}};const r=new class{constructor(e="localStorage"){if(this.storage=window[e],!this.storage)throw new Error(`Storage type '${e}' is not supported in this browser.`);this.storageKey=t}setItem(e,t){this.storage.setItem(e,JSON.stringify(t))}getItem(e){const t=this.storage.getItem(e);return t?JSON.parse(t):null}removeItem(e){if(e)throw new Error("Let's not delete anything yet...");this.storage.removeItem(e)}save(e){if(!e)throw new Error("Will not save empty values!");this.setItem(this.storageKey,e)}load(){return this.getItem(this.storageKey)}};const l=new class{#t={version:e};init(){this.load()||(this.migrate(),this.save())}register(e){e.split(".").reduce(((e,t)=>e[t]=e[t]||{}),this.#t)}load(){const e=r.load();return!!e&&(this.#t=e,o.trigger("state.load",this.#t),!0)}save(){o.trigger("state.save",this.#t),r.save(this.#t)}migrate(){}getModState(e){return this.#t.modules[e]}},c={body:{selector:"body",bruteForce:!0},layout:{selector:".layout",bruteForce:!0},mainContainer:{selector:".layout .container",bruteForce:!0,observe:["skillsMenuParent","characterParent","settingsParent","bagParent","pvpParent","interactParent","requestParent","itemParent","socialParent","clanParent","merchantParent","contextMenu","stashParent"]},partybtn:{selector:".btn.party",bruteForce:!0},skillbar:{selector:"#skillbar",bruteForce:!0},expbar:{selector:"#expbar",bruteForce:!0},sysbtnbar:{selector:".btnbar.svelte-133q4bd",bruteForce:!0},sysbag:{selector:"#sysbag",bruteforce:!0},syssocial:{selector:"#syssocial",bruteforce:!0},syscog:{selector:"#syscog",bruteforce:!0},partyBtnbar:{selector:".btnbar",bruteForce:!0},minimap:{selector:"#minimapcontainer",bruteForce:!0},urContainer:{selector:".l-corner-ur",bruteForce:!0},chatPanel:{selector:"#chat",bruteForce:!0,observe:["chatArticle"]},chatArticle:{selector:"article",bruteForce:!1,ignore:!0},chatInput:{selector:"#chatinput",bruteForce:!0},channelSelect:{selector:".channelselect",bruteForce:!0},partyframes:{selector:".partyframes",bruteForce:!0,observe:["partyGrid"]},targetframes:{selector:".targetframes",bruteForce:!0,observe:["uftarget"]},contextMenu:{selector:".panel.context.border.grey",bruteForce:!1},merchantParent:{selector:".window-pos",bruteForce:!1,wName:"merchant"},clanParent:{selector:".window-pos",bruteForce:!1,wName:"clan"},stashParent:{selector:".window-pos",bruteForce:!1,wName:"stash"},socialParent:{selector:".window-pos",bruteForce:!1,wName:"social"},requestParent:{selector:".window-pos",bruteForce:!1,wName:"request"},interactParent:{selector:".window-pos",bruteForce:!1,wName:"interaction"},itemParent:{selector:".window-pos",bruteForce:!1,wName:"item"},bagParent:{selector:".window-pos",bruteForce:!1,wName:"inventory"},skillsMenuParent:{selector:".window-pos",bruteForce:!1,wName:"skills"},characterParent:{selector:".window-pos",bruteForce:!1,wName:"character"},settingsParent:{selector:".window-pos",bruteForce:!1,wName:"settings"},pvpParent:{selector:".window-pos",bruteForce:!1,wName:"pvp"},ufplayer:{selector:"#ufplayer",bruteForce:!0},uftarget:{selector:"#uftarget",bruteForce:!1},partyGrid:{selector:".partyframes .grid",bruteForce:!1,ignore:!0}},d=e=>{const t=e.querySelector(".filter"),s=e.querySelector(".slotcontainer");return{node:e,filter:t,slotcontainer:s}},h=e=>{if("article"!==e.tagName.toLowerCase())return;const t=e.firstElementChild,[s,a,n]=t.children,i=a.firstElementChild,o=a.classList[0].substring(4),r={article:e,linewrap:t,time:s,info:a,text:n,channel:i,channelType:o},l=a.children[1];if(l){const[e,t]=l.children;r.sender_container=l,r.sender_info=e,r.sender_name=t;const s=e.children;2===s.length?[r.sender_supporter,r.sender_icon]=s:1===s.length&&(r.sender_icon=s[0])}return r};const m=new class{constructor(){this.chatArticle=h,this.bagParent=d}get(e){return this[e]}};const p=new class{getElement(e){const{selector:t,bruteForce:s,observe:a,wName:n,ignore:i}=c[e];this[e]={selector:t,observe:a,wName:n};let o=null;!0!==i&&(o=n?[...document.querySelectorAll(t)].find((e=>e.querySelector(".title").textContent.toLowerCase().startsWith(n))):document.querySelector(t),o?(this[e].element=o,this[e].onScreen=!0,this.handleObservers(e)):s&&setTimeout((()=>{this.getElement(e)}),1))}init(){for(let e in c)this.getElement(e)}triggerEvent(e,t,s){let a=null;"function"==typeof m[s]&&(a=m[s](t)),o.trigger(e,{element:t,obj:a})}handleObservers(e){if("object"==typeof this[e]){const{element:t,observe:s}=this[e];if(!t)return;if(this.triggerEvent("ui."+e,t,e),s&&!t.classList.contains("mutationObserving")){const a=new MutationObserver(((e,t)=>{for(const t of e)if("childList"===t.type){for(let e of t.removedNodes)for(let t of s){const s=this[t].selector;if(e instanceof HTMLElement&&e.matches(s)){if(!e.querySelector(".title")){this[t].element=e,this[t].onScreen=!1,this.triggerEvent("uiclose."+t,e,t);break}{const s=this[t].wName,a=e.querySelector(".title");if(a&&a.textContent.toLowerCase()===s){this[t].element=e,this[t].onScreen=!1,this.triggerEvent("uiclose."+t,e,t);break}}}}for(let e of t.addedNodes)for(let t of s){const s=this[t].selector;if(e instanceof HTMLElement&&e.matches(s)){if(!e.querySelector(".title")){this[t].element=e,this[t].onScreen=!0,this.triggerEvent("ui."+t,e,t);break}{const s=this[t].wName,a=e.querySelector(".title");if(a&&a.textContent.toLowerCase()===s){this[t].element=e,this[t].onScreen=!0,this.triggerEvent("ui."+t,e,t);break}}}}}}));a.observe(t,{childList:!0}),t.classList.add("mutationObserving"),this[e].observer=a}}}};class u{constructor(e,t,s){this.element=document.createElement(e),Object.assign(this.element,t),Object.assign(this.element.dataset,s)}to(e){return e.element.appendChild(this.element),this}add(e,t=!0){return t?this.element.appendChild(e.element):this.element.insertBefore(e.element,this.element.firstChild),this}remove(){return this.element.remove()}prepend(e){return this.add(e,!1)}append(e){return this.add(e)}first(){return this.element.firstElementChild}last(){return this.element.lastElementChild}addFirst(e){return this.prepend(e)}addLast(e){return this.append(e)}data(e,t){return this.element.dataset[e]=t,this}on(e,t){return this.element.addEventListener(e,t),this}attr(e,t){return this.element.setAttribute(e,t),this}hidden(){return this.element.hidden=!0,this}selected(e=!1){return this.element.selected=e,this}text(e){return void 0===e?this.element.textContent:(this.element.textContent=e,this)}style(e){return Object.assign(this.element.style,e),this}css(e){return this.element.className=e,this}has(e){return Array.from(this.element.classList??[]).includes(e)}addClass(e){return this.element.classList.add(e),this}removeClass(e){return this.element.classList.remove(e),this}toggle(e){return this.element.classList.toggle(e),this}type(e){return this.element.type=e,this}value(e){return this.element.value=e,this}getPos(){return this.element.getBoundingClientRect()}clear(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);return this}}const g=(e,t={},s={})=>new u(e,t,s);function f(e,t){let s=document.querySelector(".sysbtnbarKEK");s||(s=g("div",{className:"sysbtnbarKEK",style:"display: flex; float: right; clear: right; margin: 5px"}).element,e.parentNode.appendChild(s)),t.addEventListener("mouseenter",(()=>{if(s){const e=g("div",{className:"btn black displayBtnKEK border textsecondary",textContent:t.tooltip,style:"padding-left: 3px; padding-right: 3px; margin: 2px;"}).element;s.insertBefore(e,s.firstChild)}})),t.addEventListener("mouseleave",(()=>{if(s){const e=s.querySelector(".displayBtnKEK");e&&e.remove()}})),s.appendChild(t)}function y(e){let t=null;return e.includes("classes")?(t=e.split("classes")[1][1],t):5}function b(e,t,s,a=[".ignoreScale"]){if(!s._scale)return;let n,i,o,r;e.style.width=s.width+"px",e.style.height=s.height+"px";for(const t of e.children){if(!a.some((e=>e.startsWith(".")?t.classList.contains(e.slice(1)):t.tagName.toLowerCase()===e.toLowerCase()))){t.style.width=s.width+"px",t.style.height=s.height+"px";let e=t.querySelector(".bar");e&&(e.style.width=s.width+"px",e.style.height=s.height+"px")}}function l(t){if(e.classList.contains("is-scaling")){const l=t.clientX-o,c=t.clientY-r,d=n*((n+l)/n),h=i*((i+c)/i);e.style.width=d+"px",e.style.height=h+"px",s.width=d,s.height=h;for(const t of e.children){if(!a.some((e=>e.startsWith(".")?t.classList.contains(e.slice(1)):t.tagName.toLowerCase()===e.toLowerCase()))){t.style.width=d+"px",t.style.height=h+"px";let e=t.querySelector(".bar");e&&(e.style.width=d+"px",e.style.height=h+"px")}}}}function c(){e.classList.remove("is-scaling"),document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",c)}t&&t.addEventListener("mousedown",(function(t){e.classList.add("is-scaling"),n=e.offsetWidth,i=e.offsetHeight,o=t.clientX,r=t.clientY,document.addEventListener("mousemove",l),document.addEventListener("mouseup",c),t.preventDefault()}))}const v={name:"GUI",description:"Partyframes/Targetframes/chat customizations",state:{_transform:{partyframes:{height:60,width:120,_drag:!0,_scale:!0,left:591,top:675},ufplayer:{_drag:!0,top:-476,left:-339},uftarget:{top:-482,left:340,_drag:!0},targetframes:{height:30,width:195,_scale:!0},chatPanel:{_drag:!0,left:0,top:0},skillbar:{_drag:!0,left:-279,top:-74}},_configs:{partyframes:{colors:{"kek-bgc0":{top:["#5a3816",0],middle:["#70563c",50],bottom:["#8B6D4D",100]},"kek-bgc1":{top:["#11698d",0],middle:["#0992cc",49],bottom:["#159cd4",100]},"kek-bgc2":{top:["#76b935",0],middle:["#76c134",50],bottom:["#79c232",100]},"kek-bgc3":{top:["#20367f",0],middle:["#2644a7",50],bottom:["#3859c7",100]},"kek-bgc4":{top:["#2ba71e",0],middle:["#0fce00",49],bottom:["#20b611",100]},"kek-bgc5":{top:["#9f0707",0],middle:["#c62527",49],bottom:["#F42929",100]}},playerPerRow:5,buffSize:17,buffTextSize:10,buffPosition:0,gridGap:10},targetframes:{buffSize:25,buffTextSize:15},skillbar:{skillsPerRow:20,slotSize:35},chatPanel:{colors:{textglobal:"#ffcb9d",textnotice:"#9de74d",textparty:"#2ed3f6",textfaction:"#f68e7a",textclan:"#de8b09",textsystem:"#4de751",textto:"#ef3eff",textfrom:"#ef3eff"},fontSize:15,blackChat:1,height:250,width:470}},_color:!0,_lock:!1},defaultState:{_transform:{partyframes:{height:60,width:120,_drag:!0,_scale:!0,left:591,top:675},ufplayer:{_drag:!0,top:-476,left:-339},uftarget:{top:-482,left:340,_drag:!0},targetframes:{height:30,width:195,_scale:!0},chatPanel:{_drag:!0,left:44,top:644},skillbar:{_drag:!0,left:-279,top:-74}},_configs:{partyframes:{colors:{"kek-bgc0":{top:["#5a3816",0],middle:["#70563c",50],bottom:["#8B6D4D",100]},"kek-bgc1":{top:["#11698d",0],middle:["#0992cc",49],bottom:["#159cd4",100]},"kek-bgc2":{top:["#76b935",0],middle:["#76c134",50],bottom:["#79c232",100]},"kek-bgc3":{top:["#20367f",0],middle:["#2644a7",50],bottom:["#3859c7",100]},"kek-bgc4":{top:["#2ba71e",0],middle:["#0fce00",49],bottom:["#20b611",100]},"kek-bgc5":{top:["#9f0707",0],middle:["#c62527",49],bottom:["#F42929",100]}},playerPerRow:5,buffSize:17,buffTextSize:10,buffPosition:0,gridGap:10},targetframes:{buffSize:25,buffTextSize:15},skillbar:{skillsPerRow:20,slotSize:35},chatPanel:{colors:{textglobal:"#ffcb9d",textnotice:"#9de74d",textparty:"#2ed3f6",textfaction:"#f68e7a",textclan:"#de8b09",textsystem:"#4de751",textto:"#ef3eff",textfrom:"#ef3eff"},fontSize:15,blackChat:1,height:250,width:470}},_color:!0,_lock:!1},_profiles:!0,style:".svelte-svpjti {display: none;}",gradientNames:["kek-bgc0","kek-bgc1","kek-bgc2","kek-bgc3","kek-bgc5","kek-bgc4"],start(){this.makeElementsDraggable(),o.on("ui.partyframes",this.handlePartyframes,this),o.on("ui.chatPanel",this.handleChatPanel,this),o.on("ui.targetframes",this.handleTargetframes,this),o.on("ui.partyGrid",this.handlePartyGrid,this),o.on("ui.uftarget",this.handleTargetGrid,this),o.on("ui.ufplayer",this.handleTargetGrid,this),o.on("ui.skillbar",this.handleSkillbar,this),o.on("ui.uftarget",this.handleUftargetMutations,this),o.on("click.lockUI",this.toggleLockUI,this),o.on("click.toggleColors",this.toggleColorize,this),o.on("click.importGUI",this.handleImportUI,this),o.on("click.exportGUI",this.handleExportUI,this),o.on("click.resetGUI",this.handleResetUI,this),o.on("ui.sysbtnbar",this.addBtn,this),p.sysbtnbar&&(this.lockBtn||(console.log("adding button manually!"),this.addBtn(p.sysbtnbar)))},stop(){o.off("ui.partyframes",this.handlePartyframes,this),o.off("ui.chatPanel",this.handleChatPanel,this),o.off("ui.targetframes",this.handleTargetframes,this),o.off("ui.partyGrid",this.handlePartyGrid,this),o.off("ui.uftarget",this.handleTargetGrid,this),o.off("ui.ufplayer",this.handleTargetGrid,this),o.off("ui.skillbar",this.handleSkillbar,this),o.off("ui.uftarget",this.handleUftargetMutations,this),o.off("click.lockUI",this.toggleLockUI,this),o.off("click.toggleColors",this.toggleColorize,this),o.off("click.importGUI",this.handleImportUI,this),o.off("click.exportGUI",this.handleExportUI,this),o.off("click.resetGUI",this.handleResetUI,this),o.off("ui.sysbtnbar",this.addBtn,this),this.lockBtn&&(this.lockBtn.remove(),this.lockBtn=null)},lockBtn:null,addBtn(e){e=e.element;const t=this.createBtn("Lock🔒","Lock UI",this.handleLockBtn.bind(this));this.lockBtn=t,f(e,t)},handleLockBtn(e){this.state._lock?(e.classList.add("textgreen"),e.classList.remove("textsecondary")):(e.classList.remove("textgreen"),e.classList.add("textsecondary")),e.addEventListener("click",(()=>{this.toggleLockUI(),this.state._lock?(e.classList.add("textgreen"),e.classList.remove("textsecondary")):(e.classList.remove("textgreen"),e.classList.add("textsecondary"))}))},createBtn(e,t,s){const a=g("div",{className:"btn border black textsecondary",textContent:e,tooltip:t,style:"padding-left: 3px; padding-right: 3px; margin: 2px;"}).element;return s(a),a},toggleLockUI(){this.state._lock^=1},toggleColorize(){this.state._color=!this.state._color},partyColors:{"kek-bgc0":{top:["#5a3816",0],middle:["#70563c",50],bottom:["#8B6D4D",100]},"kek-bgc1":{top:["#11698d",0],middle:["#0992cc",49],bottom:["#159cd4",100]},"kek-bgc2":{top:["#76b935",0],middle:["#76c134",50],bottom:["#79c232",100]},"kek-bgc3":{top:["#20367f",0],middle:["#2644a7",50],bottom:["#3859c7",100]},"kek-bgc4":{top:["#2ba71e",0],middle:["#0fce00",49],bottom:["#20b611",100]},"kek-bgc5":{top:["#9f0707",0],middle:["#c62527",49],bottom:["#F42929",100]}},chatColors:{textglobal:"#ffcb9d",textnotice:"#9de74d",textparty:"#2ed3f6",textfaction:"#f68e7a",textclan:"#de8b09",textsystem:"#4de751",textto:"#ef3eff",textfrom:"#ef3eff"},makeElementsDraggable(){for(let e in this.state._transform){const t=this.state._transform[e];"chatPanel"==e?o.on(`ui.${e}`,(e=>{x(e.element.parentNode,t)})):o.on(`ui.${e}`,(e=>{x(e.element,t)}))}},createInputParty(e,t){const s=document.createElement("input");return s.placeholder=e,s.title=`${e}`,s.style.width="70px",s.style.height="40px",s.type="number",s.value=this.state._configs.partyframes[t],s.classList.add("kek-ui-input"),s.style.display="none",s.addEventListener("input",(()=>{let e=parseInt(s.value);e>50&&(s.value=50),e<1&&(s.value=1),e=parseInt(s.value),this.state._configs.partyframes[t]=e,this.updatePartyStyle()})),s},handlePartyframes(e){e=e.element,this.updatePartyStyle();const t=document.createElement("div");t.textContent="Change Buff Position",t.addEventListener("click",(()=>{this.toggleBuffPosition()})),t.title="Click to change buff orientation",t.style.zIndex="1",t.classList.add("horizontal-btn","kek-ui-btn","btn","black","textsecondary"),t.style.marginRight="10px";const s=document.createElement("div");s.title="Hold and Drag to change size",s.textContent="Change Size",s.classList.add("scale-btn-party","btn","black","textsecondary","kek-ui-btn"),s.style.zIndex="1",s.style.marginRight="10px",b(e,s,this.state._transform.partyframes);const a=document.createElement("div");if(a.textContent="Colors",a.style.marginRight="10px",a.style.zIndex="1",a.title="Click to change party colors",a.addEventListener("click",(e=>{e.target===a&&this.openPartyColorCustomization(e)})),a.classList.add("partyColorButton","kek-ui-btn","btn","black","textsecondary"),s.style.display="none",t.style.display="none",a.style.display="none",!e.querySelector(".kek-ui-input")){const n=this.createInputParty("Player Per Row","playerPerRow"),i=this.createInputParty("Party Buff Size","buffSize"),o=this.createInputParty("Party Buff Stack Text Size","buffTextSize"),r=this.createInputParty("Grid Space","gridGap"),l=document.createElement("div");l.style.display="flex",l.style.left="10px",l.style.top="-50px",l.style.position="absolute",l.classList.add("ignoreScale"),l.classList.add("inputContainerKEK"),l.appendChild(a),l.appendChild(t),l.appendChild(s),l.appendChild(n),l.appendChild(i),l.appendChild(o),l.appendChild(r),e.insertBefore(l,e.firstChild)}const n=e.children;for(let e of n)e.classList.contains("grid")&&this.handlePartyGrid({element:e})},handleRightSpanMutations(e){const t=e.querySelector("span.right");if(t&&!t.classList.contains("mutationObserving")){let e=t.textContent;new MutationObserver((()=>{if("offline"==e.trim().toLowerCase()||"dead"==e.trim().toLowerCase()){const e=t.closest(".grid");this.colorizeGrid(e)}e=t.textContent})).observe(t,{characterData:!0,attributes:!1,childList:!1,subtree:!0}),t.classList.add("mutationObserving")}},handleUftargetMutations(e){if((e=e.element)&&!e.classList.contains("mutationObserving")){const t=e.querySelector(".icon");new MutationObserver(((t,s)=>{for(const s of t)if("attributes"===s.type){s.target.classList.contains("pclass")&&this.colorizeGrid(e)}})).observe(t,{attributes:!0}),e.classList.add("mutationObserving")}},copyArticleSender(e){const t=e.querySelector(".name").textContent;t&&navigator.clipboard.writeText(t).then((()=>console.log("Article sender copied to clipboard:",t))).catch((e=>console.error("Copy failed:",e)))},copyArticleContent(e){const t=e.querySelector(".content").nextElementSibling.textContent;t&&navigator.clipboard.writeText(t).catch((e=>console.error("Copy failed:",e)))},getPartyColors(){return this.state._configs.partyframes.colors},setPartyColors(e){this.state._configs.partyframes.colors=e},updatePartyStyle(){const e=this.getPartyColors(),t=document.querySelector(".partyframes");t.style.gridTemplateColumns=`repeat(${this.state._configs.partyframes.playerPerRow}, auto)`,t.style.gap=`${this.state._configs.partyframes.gridGap}px`;const s=t.children;for(let e of s)e.classList.contains("grid")&&this.handleBuffarray(e);const a=Object.entries(e).map((([e,t])=>{const[s,a]=t.top,[n,i]=t.middle,[o,r]=t.bottom;return`\n        .${e} {\n        background: linear-gradient(0deg, ${s} ${a}%, ${n} ${i}%, ${o} ${r}%);\n        }\n        `})).join("\n"),n=document.getElementById("partyStyleKEK");n&&n.remove();const i=document.createElement("style");i.id="partyStyleKEK",i.classList.add("ignoreScale"),i.textContent=a,document.body.insertBefore(i,document.body.firstChild)},updateTargetStyle(){const e=document.querySelector(".targetframes").children;for(let t of e)t.classList.contains("grid")&&this.handleBuffarray(t)},toggleBuffPosition(){this.state._configs.partyframes.buffPosition=0==this.state._configs.partyframes.buffPosition?1:0;const e=document.querySelector(".partyframes").children;for(let t of e)t.classList.contains("grid")&&this.handleBuffarray(t)},getClassName:e=>({0:"Warrior",1:"Mage",2:"Archer",3:"Shaman",4:"Wardens/Conjurer",5:"Enemy/Monster"}[e]),openPartyColorCustomization(e){const t=document.querySelector(".party-color-customizationKEK");if(t)return void t.parentNode.remove();const s=this.getPartyColors(),a=document.querySelector(".partyColorButton"),n=document.createElement("div");n.className="widow panel-black border black";const i=document.createElement("div");i.className="party-color-customizationKEK panel-black bar",i.style.position="absolute",i.style.display="grid",i.style.gridTemplateColumns="repeat(1, auto)",i.style.top=a.offsetTop-300+"px",i.style.left=a.offsetLeft+a.offsetWidth+10+"px";for(const e in s){const t=document.createElement("div");t.style.display="flex",t.style.alignItems="center";const a=document.createElement("div");a.className="color-item-party btn black textsecondary";const n=e.split("bgc")[1];a.textContent=this.getClassName(n);const o=this.createColorPicker("Top Color","top",s[e].top[0],(t=>{this.handlePartyColorChange(e,"top",t)})),r=this.createColorPicker("Middle Color","middle",s[e].middle[0],(t=>{this.handlePartyColorChange(e,"middle",t)})),l=this.createColorPicker("Bottom Color","bottom",s[e].bottom[0],(t=>{this.handlePartyColorChange(e,"bottom",t)})),c=this.createPercentageInput(e,"top",s[e].top[1]),d=this.createPercentageInput(e,"middle",s[e].middle[1]),h=this.createPercentageInput(e,"bottom",s[e].bottom[1]),m=document.createElement("div"),p=document.createElement("div");p.className="bar  svelte-i7i7g5",m.classList.add("progressBar",`kek-bgc${n}`),m.style.height="50px",m.style.width="120px",p.style.marginLeft="20px";const u=document.createElement("span");u.classList.add("left"),u.textContent="Dummy",u.style.marginLeft="5px";const g=document.createElement("span");g.classList.add("right","svelte-i7i7g5"),g.textContent="0/0",m.appendChild(u),m.appendChild(g),a.style.width="150px",a.style.padding="10px",p.appendChild(m),t.appendChild(a),t.appendChild(o),o.style.margingLeft="5px",t.appendChild(c),t.appendChild(r),t.appendChild(d),t.appendChild(l),t.appendChild(h),t.appendChild(p),t.style.padding="5px",i.appendChild(t)}const o=document.createElement("button");o.classList.add("btn","black","textsecondary"),o.textContent="Reset",o.addEventListener("click",(()=>{this.setPartyColors(this.partyColors),this.openPartyColorCustomization(),this.updatePartyStyle()})),i.appendChild(o),n.appendChild(i),i.style.zIndex=20,e.target.parentNode.appendChild(n)},handlePartyColorChange(e,t,s){const a=this.getPartyColors();a[e][t][0]=s,this.setPartyColors(a)},createColorPicker(e,t,s,a){const n=document.createElement("input");return n.type="color",n.title=e,n.style.height="35px",n.style.width="35px",n.value=s,n.style.flex=1,n.addEventListener("input",(e=>{e.stopPropagation(),a(e.target.value),this.updatePartyStyle()})),n},createPercentageInput(e,t,s){const a=document.createElement("input");return a.type="number",a.placeholder="Percentage",a.value=s,a.title="Percentage value",a.style.width="45px",a.style.flex=1,a.style.height="35px",a.addEventListener("input",(s=>{s.stopPropagation();let n=parseInt(s.target.value);n<0?n=0:n>100&&(n=100),a.value=n,this.handlePartyPercentageChange(e,t,n)})),a},handlePartyPercentageChange(e,t,s){const a=this.getPartyColors();a[e][t][1]=parseInt(s),this.setPartyColors(a)},openChatColorCustomization(e){const t=document.querySelector(".chat-color-customizationKEK");if(t)return void t.remove();const s=this.getChatColors(),a=document.createElement("div");a.className="chat-color-customizationKEK panel-black",a.style.position="absolute",a.style.display="grid",a.style.gridTemplateColumns="repeat(2, auto)",a.style.top=chat.offsetTop-400+"px",a.style.left=chat.offsetLeft+"px";const n=document.createElement("button"),i=document.createElement("div");n.className="btn black textsecondary",n.textContent="Reset",n.addEventListener("click",(()=>{this.setChatColors(this.chatColors),this.openChatColorCustomization(),this.updateChatStyle()})),a.appendChild(n),a.appendChild(i);for(const e in s){const t=document.createElement("div");t.className="color-item",t.textContent=e.split("text")[1].toUpperCase();const n=document.createElement("input");n.type="color",n.value=s[e],n.addEventListener("input",(t=>{t.stopPropagation(),this.handleChatColorChange(e,t.target.value)})),t.style.width="100px",t.style.padding="10px",n.style.width="30px",n.style.height="30px",a.appendChild(t),a.appendChild(n)}a.style.zIndex=2,e.target.appendChild(a)},handleChatColorChange(e,t){const s=this.getChatColors();s[e]=t,this.setChatColors(s),this.updateChatStyle()},getChatColors(){return this.state._configs.chatPanel.colors},setChatColors(e){this.state._configs.chatPanel.colors=e},createInputChat(e,t,s="number"){const a=document.createElement("input");return a.type=s,a.className="kek-ui-input",a.placeholder=e,a.title=`${e}`,a.value=t||"",a},handleInputChangeChat(e){return t=>{this.state._configs.chatPanel=this.state._configs.chatPanel||{};const s=t.target.value;this.state._configs.chatPanel[e]=s,this.updateChatStyle()}},updateChatStyle(){},positionOverChat(e){const t=chat.parentNode.getBoundingClientRect(),s=chat.getBoundingClientRect();e.style.position="absolute",e.style.left=s.left-t.left+"px",e.style.top=s.top-t.top-40+"px"},handleChatPanel(e){(e=e.element).scrollTop=e.scrollHeight+10,e.addEventListener("contextmenu",(e=>{const t=e.target.closest("article");if(t){e.preventDefault();const s=document.querySelector(".context"),a=document.createElement("div");a.classList.add("choice"),a.textContent="Copy",a.addEventListener("click",(()=>{this.copyArticleContent(t),s.remove()})),s.appendChild(a);const n=document.createElement("div");n.classList.add("choice"),n.textContent="Copy Name",n.addEventListener("click",(()=>{this.copyArticleSender(t),s.remove()})),s.appendChild(n)}})),this.updateChatStyle()},handleTargetframes(e){e=e.element;const t=document.createElement("div");t.textContent="Change Size",t.title="Hold and Drag to change Size",t.classList.add("scale-btn-player"),t.classList.add("kek-ui-btn","btn","black","textsecondary"),t.style.display="none",b(e,t,this.state._transform.targetframes);const s=this.createInputTarget("Buff Size","buffSize"),a=this.createInputTarget("Buff Text Size","buffTextSize"),n=document.createElement("div");n.style.display="flex",n.style.left="10px",n.style.top="-50px",n.style.position="absolute",n.style.zIndex=1,n.classList.add("ignoreScale"),n.classList.add("inputContainerKEK"),t.style.flex=1,s.style.flex=1,a.style.flex=1,n.appendChild(t),n.appendChild(s),n.appendChild(a),setTimeout((()=>{const e=document.querySelector("#ufplayer");e.insertBefore(n,e.firstChild)}),300)},createInputTarget(e,t){const s=document.createElement("input");s.placeholder=e,s.style.width="120px",s.style.height="40px",s.title=`${e}`,s.type="number",s.value=this.state._configs.targetframes[t],s.classList.add("kek-ui-input"),s.style.display="none";return s.addEventListener("input",(()=>{let e=parseInt(s.value);e>50&&(s.value=50),e<1&&(s.value=1),e=parseInt(s.value),this.state._configs.targetframes[t]=e,this.updateTargetStyle()})),s},updateSkillbarStyle(e){const t=e.querySelectorAll(".slot");for(let e of t)e.style.height=this.state._configs.skillbar.slotSize+"px",e.style.width=this.state._configs.skillbar.slotSize+"px";e.style.gridAutoRows="initial",e.style.gridAutoColumns="unset",e.style.gridAutoFlow="dense",e.style.gridTemplateColumns=`repeat(${this.state._configs.skillbar.skillsPerRow}, auto)`;const s=document.querySelector("#skillbarStyle");s&&s.remove();const a=g("style",{textContent:`#skillbar .overlay img {\n                height: ${this.state._configs.skillbar.slotSize}px;\n                width: ${this.state._configs.skillbar.slotSize}px; \n            }`,id:"skillbarStyle"}).element;e.insertBefore(a,e.firstChild)},createInputSkillbar(e,t,s){const a=document.createElement("input");a.placeholder=e,a.style.width="120px",a.style.height="40px",a.title=`${e}`,a.type="number",a.value=this.state._configs.skillbar[t],a.classList.add("kek-ui-input"),a.style.display="none";return a.addEventListener("input",(()=>{let e=parseInt(a.value);e>50&&(a.value=50),e<1&&(a.value=1),e=parseInt(a.value),this.state._configs.skillbar[t]=e,this.updateSkillbarStyle(s)})),a},handleTargetGrid(e){let t=(e=e.element).querySelector(".bar");t&&(t.style.width=this.state._transform.targetframes.width+"px",t.style.height=this.state._transform.targetframes.height+"px"),this.colorizeGrid(e),this.handleBuffarray(e)},handlePartyGrid(e){(e=e.element).style.width=this.state._transform.partyframes.width+"px",e.style.height=this.state._transform.partyframes.height+"px",this.state._color&&(e.style.gridTemplate="none");let t=e.querySelector(".bar");t&&(t.style.width=this.state._transform.partyframes.width+"px",t.style.height=this.state._transform.partyframes.height+"px"),this.colorizeGrid(e),this.handleRightSpanMutations(e),this.handleBuffarray(e)},colorizeGrid(e){if(0==this.state._color)return;const t=e.querySelector(".iconcontainer");if(t){const s=t.querySelector("img");if(s){let a=y(s.src);a||(a=5);const n=e.querySelector(".progressBar");n&&(this.gradientNames.forEach((e=>{n.classList.remove(e)})),n.classList.add(`kek-bgc${a}`),t.style.display="none")}}},handleSkillbar(e){e=e.element,this.updateSkillbarStyle(e);const t=document.createElement("div");t.style.display="flex",t.style.position="absolute",t.style.left="10px",t.style.top="-50px";const s=this.createInputSkillbar("Skills Per Row","skillsPerRow",e),a=this.createInputSkillbar("Skill Icon Size","slotSize",e);t.appendChild(a),t.appendChild(s),e.appendChild(t)},handleBuffarray(e){"ufplayer"==e.id||"uftarget"==e.id?this.buffArrayResizing(e):(this.buffArrayResizing(e),this.repositionBuffarray(e))},repositionBuffarray(e){let t,s=this.state._configs.partyframes.buffPosition;const a=e.querySelector(".buffarray");if(a){let n;if(a&&0==s){a.style.position="absolute",n=this.state._configs.partyframes.buffSize;const s=e.parentNode;t=s.style.height?1*parseInt(s.style.height.split("px")[0])-n:-1*n,a.style.top=t+"px",a.style.left="0"}else a&&1==s&&(a.style.position="",a.style.top="",a.style.left="")}},buffArrayResizing(e){const t=e.querySelector(".buffarray");if(t&&t instanceof HTMLElement){let s,a=!1;s=this.state._configs.partyframes.buffSize,"ufplayer"==t.parentNode.parentNode.id||"uftarget"==t.parentNode.parentNode.id?(s=this.state._configs.targetframes.buffSize||s,a=!0):t.style.pointerEvents="none",t.style.margin="0px";const n=t.querySelectorAll(".icon");if(n)for(let r of n)r.style.maxWidth=s+"px";let i=t.querySelector("style.buffTextSize");i||(i=document.createElement("style"),i.classList.add("buffTextSize"),t.insertBefore(i,t.firstChild));let o=15;if(a?(o=this.state._configs.targetframes.buffTextSize,i.textContent=`.stacks.svelte-1nn7wcb {\n                    font-size: ${o}px;\n                    }\n                    .buffarray .overlay img {\n                        height: ${s}px;\n                        width: ${s}px;\n                    }\n                    `):(o=this.state._configs.partyframes.buffTextSize,i.textContent=`.partyframes .stacks.svelte-1nn7wcb {\n                    font-size: ${o}px;\n                    }\n                    .partyframes .buffarray .overlay img {\n                        height: ${s}px;\n                        width: ${s}px;\n                    }\n                    `),!t.classList.contains("mutationObserving")){function l(e,t){for(const t of e)if("childList"===t.type){t.addedNodes.forEach((e=>{if(e instanceof HTMLElement){const t=e.querySelector(".icon");t&&(t.style.maxWidth=s+"px")}}))}}new MutationObserver(l).observe(t,{childList:!0,subtree:!1}),t.classList.add("mutationObserving")}}},handleExportUI(e){console.log("Exporting GUI...");try{const t=e.target;if(t.classList.contains("choice-item")&&!t.classList.contains("exportActive")){t.classList.add("exportActive");const s=l.getModState(this.name);Object.keys(s).map((e=>{if(e.startsWith("_"))return;const t=document.createElement("button");return t.className="btn black textsecondary",t.style.padding="1px",t.style.marginLeft="2px",t.style.fontSize="15px",t.textContent=e,t.addEventListener("click",(function(){const a=JSON.stringify(s[e]);navigator.clipboard.writeText(a).then((()=>{const e=t.textContent;t.textContent="Copied!",setTimeout((()=>{t.textContent=e}),1e3)})).catch((e=>{console.error("Error copying to clipboard:",e)}))})),t})).forEach((t=>{t instanceof HTMLElement&&e.target.appendChild(t)}))}}catch(e){console.error("Error exporting props:",e)}},handleImportUI(e){const t=e.target;if(t.classList.contains("choice-item")&&!t.classList.contains("inputActiveKEK")){t.classList.add("inputActiveKEK"),document.createElement("div");const s=document.createElement("textarea");s.placeholder="Paste your configuration here...",s.style.width="300px",s.style.height="150px";const a=document.createElement("button");a.className="btn black";const n=document.createElement("span");n.classList.add("textsecondary"),n.textContent="Import";const i=document.createElement("span");i.classList.add("textsecondary"),i.textContent="Import Failed!";const o=document.createElement("span");o.classList.add("textsecondary"),o.textContent="Import Success!",a.appendChild(n),a.style.padding="10px",a.style.height="",e.target.appendChild(s),e.target.appendChild(a);const r=1e3;a.addEventListener("click",(()=>{const e=s.value.trim();if(!e)return s.remove(),a.innerHTML=i.outerHTML,void setTimeout((()=>{a.remove(),t.classList.remove("inputActiveKEK")}),r);try{const n=JSON.parse(e);console.log(n),n&&"object"==typeof n?(this.state=n,console.log("Configuration imported successfully."),a.innerHTML=o.outerHTML,s.remove(),setTimeout((()=>{a.remove(),t.classList.remove("inputActiveKEK")}),r)):(s.remove(),a.innerHTML=i.outerHTML,setTimeout((()=>{a.remove(),t.classList.remove("inputActiveKEK")}),r),console.log("NOT AN OBJECT"))}catch(e){s.remove(),a.innerHTML=i.outerHTML,setTimeout((()=>{a.remove(),t.classList.remove("inputActiveKEK")}),r),console.error("Error parsing or importing configuration:",e)}}))}},handleResetUI(e){this.state=this.defaultState,e.target.textContent="Success!",setTimeout((()=>{e.target&&(e.target.textContent="ResetUI")}),500)}};function x(e,t){if(!t._drag)return;const s=e.classList.contains("l-corner-ll");let a,n;e.style.position="absolute",s?e.style.bottom=t.top+"px":e.style.top=t.top+"px",e.style.left=t.left+"px";let i,o=parseInt(e.style.left.split("px")[0]);function r(r){if(!v.state._lock&&e.classList.contains("is-dragging")&&!e.parentNode.classList.contains("is-scaling")&&!e.classList.contains("is-scaling")&&(l="is-scaling",null===e.querySelector("."+l))){const l=r.clientX-a,c=r.clientY-n,d=o+l;let h=i+c;s&&(h=i-c),e.style.left=d+"px",s?e.style.bottom=h+"px":e.style.top=h+"px",t.left=d,t.top=h}var l}function l(){e.classList.remove("is-dragging"),o=e.offsetLeft,i=s?e.style.bottom.split("px")[0]:e.offsetTop,document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",l)}i=s?parseInt(e.style.bottom.split("px")[0]):parseInt(e.style.top.split("px")[0]),e.addEventListener("mousedown",(function(t){e.classList.add("is-dragging"),a=t.clientX,n=t.clientY,document.addEventListener("mousemove",r),document.addEventListener("mouseup",l)}))}function k(e,t="200px",s="50px",a,n){const i=e.split(" ").join("").toLowerCase()+"KEK",o=g("div",{className:`window panel-black ${i}`,style:`position: absolute; left: ${t}; top: ${s}; z-index: 10`}),r=g("div",{className:"titleframe",style:"display: flex; justify-content: space-between;"}),l=g("div",{className:"textprimary title",style:"width: 200px; padding: 10px;",textContent:e}),c=g("img",{className:"btn black svgicon",src:"/data/ui/icons/cross.svg?v=8498194",style:"margin-top: 6px;"});return r.append(l),r.append(c),o.append(r),c.on("click",(function(){o.remove(),"function"==typeof n&&n()})),o.style.zIndex=10,a&&x(o.element,a),o}function w(e,t,s="3px",a="5px"){const n=g("div",{className:`panel-black ${t||""}`,style:`display: grid; grid-template-columns: repeat(${e.length}, auto)`});return e.forEach((e=>{const t=g("div",{className:"btn black textprimary grid-header",textContent:e,style:`margin: ${s}; padding: ${a};`});n.append(t)})),n}const C={name:"Emojis",state:{emojiList:{":cake":"🎂",":fire":"🔥",":bow":"🏹",":biceps":"💪💪💪",":flushed":"😳",":yum":"😋",":joy":"😂",":katana":"▬▬ι═══════ﺤ",":sad":"( •̯́ ^ •̯̀)",":izi":"ᶻ 𝗓 𐰁",":boo":"👻",":skull":"💀",":nerd":"🤓☝️"},_transform:{top:100,left:100,_drag:!0}},hotkey:{"Open Emojis":{key:".",callback:"generateUI"}},start(){o.on("click.emojis",this.generateUI,this),o.on("ui.chatInput",this.handleChatInput,this),o.on("ui.channelSelect",this.addControlBtn,this)},stop(){o.off("click.emojis",this.generateUI,this),o.off("ui.chatInput",this.handleChatInput,this)},addControlBtn(e){this.controlBtn=g("small").css("btn border black textgrey").text(this.name).style({lineHeight:"1em",marginRight:"4px"}).on("click",(()=>{this.generateUI()})),e.element.appendChild(this.controlBtn.element)},toggleControlBtn(){["textgrey","textprimary"].forEach((e=>this.controlBtn.toggle(e)))},generateUI(){this.toggleControlBtn();const e=document.querySelector(".emojisKEK");if(e)return void e.remove();const t=()=>{const e=document.querySelector(".emoji-list");if(e){e.innerHTML="";for(let s in this.state.emojiList){const n=this.state.emojiList[s],i=document.createElement("div");i.className="emoji-item btn black textsecondary";const o=document.createElement("span");o.classList.add("textsecondary"),o.textContent=s;const r=document.createElement("span");r.classList.add("textsecondary"),r.textContent=n,i.appendChild(o),i.appendChild(r),i.style.display="flex",i.style.justifyContent="space-between",i.addEventListener("contextmenu",(function(e){e.preventDefault(),a(s),t()})),i.addEventListener("click",(function(e){navigator.clipboard.writeText(n).then((function(){console.log("Copying item ",n);const e=i.innerHTML;i.textContent="Copied!",i.classList.add("textgreen"),setTimeout((function(){i.innerHTML=e,i.classList.remove("textgreen")}),500)})).catch((function(e){console.error("Unable to copy text to clipboard",e)}))})),e.appendChild(i)}}},s=(e,t)=>{this.state.emojiList[t]=e},a=e=>{delete this.state.emojiList[e]},n=e=>{try{const t=JSON.stringify(this.state.emojiList);navigator.clipboard.writeText(t).then((()=>{console.log("Emojis copied to clipboard successfully.");const t=e.target.textContent;e.target.textContent="Copied!",e.target.classList.add("textgreen"),setTimeout((()=>{e.target.textContent=t,e.target.classList.remove("textgreen")}),1e3)})).catch((e=>{console.error("Error copying emojis to clipboard:",e)}))}catch(e){console.error("Error exporting emojis:",e)}},i=e=>{try{const s=document.createElement("textarea");s.placeholder="Paste your emojis here...";const a=document.createElement("button");a.className="btn black textsecondary",a.textContent="Import";const n=document.createElement("div");n.style.display="flex",n.style.marginBottom="10px",s.style.flex="1",a.style.flex="1",a.style.fontSize="16px",n.appendChild(s),n.appendChild(a);const i=document.querySelector(".emoji-list");e.target.parentNode.parentNode.insertBefore(n,i),a.addEventListener("click",(()=>{e.stopPropagation();document.querySelector(".import-emoji-btn").classList.remove("importActive");const i=s.value.trim();if(!i)return a.textContent="Failed!",s.remove(),void setTimeout((()=>{a.remove(),n.remove()}),1e3);try{const e=JSON.parse(i);e&&"object"==typeof e?(this.state.emojiList={...this.state.emojiList,...e},console.log("Emojis imported successfully."),a.textContent="Successful!",a.classList.add("textgreen"),s.remove(),setTimeout((()=>{a.remove(),n.remove()}),1e3),t()):(console.error("Invalid emojis data format."),a.textContent="Failed!",s.remove(),setTimeout((()=>{a.remove(),n.remove()}),1e3))}catch(e){importSpan.textContent="Failed!",s.remove(),setTimeout((()=>{importSpan.textContent="Import Emojis",a.remove(),n.remove()}),1e3)}}))}catch(e){console.error("Error setting up emojis import:",e)}},o=k("Emojis","100px","100px",this.state._transform,this.toggleControlBtn.bind(this)).element,r=document.createElement("div");r.className="emoji-list panel-black bar slot",r.style.display="grid",r.style.gridTemplateColumns="repeat(10, auto)";const l=document.createElement("input");l.type="text",l.placeholder="Paste emoji",l.style.marginRight="10px";const c=document.createElement("input");c.type="text",c.placeholder="Enter emoji name";const d=document.createElement("div");d.className="btn black textsecondary",d.textContent="Save Emoji",d.addEventListener("click",(function(){const e=l.value.trim(),a=c.value.trim();e&&a&&(s(e,a),l.value="",c.value="",t())}));const h=document.createElement("div");h.className="btn black textsecondary",h.textContent="Export Emojis",h.addEventListener("click",(function(e){n(e)}));const m=document.createElement("div");m.className="btn black textsecondary import-emoji-btn",m.textContent="Import Emojis",m.addEventListener("click",(function(e){m.classList.contains("importActive")||(m.classList.add("importActive"),i(e),t())}));const p=document.createElement("div");p.style.display="flex",p.appendChild(l),p.appendChild(c);const u=document.createElement("div");u.style.display="flex",u.appendChild(d),u.appendChild(h),u.appendChild(m),d.style.flex="1",h.style.flex="1",m.style.flex="1",h.style.textAlign="center",m.style.textAlign="center",d.style.textAlign="center",p.style.marginBottom="10px",u.style.marginBottom="10px",o.appendChild(p),o.appendChild(u),o.appendChild(r),document.body.appendChild(o),t()},handleChatInput(e){(e=e.element).querySelector("input").addEventListener("input",this.chatInputListener.bind(this))},chatInputListener(e){const t=this.state.emojiList,s=e.target;let a=s.value,n=!1;for(const[e,s]of Object.entries(t))a.includes(e)&&(a=a.replace(new RegExp(e,"g"),s),n=!0);if(n){s.value=a;const e=new InputEvent("input",{bubbles:!0});s.dispatchEvent(e)}}},S={name:"Mouse Over",state:{enabled:!1},toggle(){this.state.enabled=!this.state.enabled},start(){document.addEventListener("mouseover",(e=>{const t=e.target;this.state.enabled&&(t.classList.contains("bghealth")||t.classList.contains("left")||t.classList.contains("right"))&&e.target.click()})),o.on("click.mouseOver",this.toggle,this)},stop(){o.off("click.mouseOver",this.toggle,this)}},T={UIMode:function(){const e=document.querySelectorAll(".kek-ui-btn"),t=document.querySelectorAll(".kek-ui-input");e.forEach((e=>{"none"==e.style.display?e.style.display="inline-block":e.style.display="none"})),t.forEach((e=>{"none"==e.style.display?e.style.display="inline-block":e.style.display="none",e.title="",e.addEventListener("mouseenter",L),e.addEventListener("mouseleave",P)}))},"Mouse Over":()=>{o.trigger("click.mouseOver")},"Hide EXP":()=>{o.trigger("click.expbar")},"Picture Mode":function(){const e=document.querySelector(".l-ui.layout");e&&("none"!==e.style.display?e.style.display="none":e.style.display="grid")},"Blocked Players":()=>{o.trigger("click.blockPlayers")},Emoji:()=>{o.trigger("click.emojis")},"Disable Class Colors":()=>{o.trigger("click.toggleColors")},"Rune Tracker":()=>{o.trigger("click.runeTracker")},"Kill Tracker":()=>{o.trigger("click.killtracker")},ExportUI:e=>{o.trigger("click.exportGUI",e)},ImportUI:e=>{o.trigger("click.importGUI",e)},ResetUI:e=>{o.trigger("click.resetGUI",e)}};let E=null;function L(e){const t=g("div",{className:"btn black textprimary",textContent:e.target.placeholder,style:`\n        position: absolute;\n        top: ${e.target.offsetTop-40}px;\n        left: ${e.target.offsetLeft}px;\n        padding: 5px`}).element;E=t,e.target.parentNode.appendChild(t)}function P(e){E&&(E.remove(),E=null)}const I={name:"KEK UI Main Menu",menuStatus:{"Hide EXP":()=>"none"==p.expbar.element.style.display,"Mouse Over":()=>!!S.state.enabled,UIMode:()=>{const e=document.querySelector(".kek-ui-input");return!!e&&"none"!=e.style.display},"Disable Class Colors":()=>!v.state._color},hotkey:{"Open Menu":{key:"u",callback:"generate"}},start(){},stop(){},generate(e){let t=document.querySelector(".kek-ui-mainmenu");if(t)return void t.remove();t=document.createElement("div"),t.className="widow panel-black border black kek-ui-mainmenu absCentered";const s=document.createElement("div");s.className="titleframe svelte-yjs4p5",s.style.display="flex",s.style.justifyContent="space-between";const a=document.createElement("div");a.className="textprimary title svelte-yjs4p5",a.textContent="UI Menu",a.style.width="200px",a.style.padding="10px",a.style.fontSize="20px";const n=document.createElement("img");n.src="/data/ui/icons/cross.svg?v=8498194",n.className="btn black svgicon",n.style.padding="5px",n.addEventListener("click",(function(){t.remove()})),s.appendChild(a),s.appendChild(n),t.appendChild(s);const i=document.createElement("div");i.className="panel-black bar";["UIMode","Mouse Over","Blocked Players","Emoji","Picture Mode","Rune Tracker","Kill Tracker","Disable Class Colors","ExportUI","ImportUI","ResetUI"].forEach((e=>{const t=document.createElement("div");t.className="choice-item btn black textsecondary",t.textContent=e,t.style.padding="5px",t.style.fontSize="15px",this.menuStatus[e]&&"function"==typeof this.menuStatus[e]&&this.menuStatus[e]()&&(t.classList.add("textgreen"),t.classList.remove("textsecondary")),t.addEventListener("click",(s=>{T[e]&&T[e](s),this.menuStatus[e]&&"function"==typeof this.menuStatus[e]&&this.menuStatus[e]()?(t.classList.add("textgreen"),t.classList.remove("textsecondary")):(t.classList.remove("textgreen"),t.classList.add("textsecondary"))})),i.appendChild(t)})),t.appendChild(i),t.style.zIndex=9999;const o=document.querySelector("body");o&&o.appendChild(t)}},M={name:"Block players",state:{blockedPlayersList:[],_transform:{left:100,top:100,_drag:!0}},hotkey:{"Open Blocked Players":{key:",",callback:"generateUI"}},start(){o.on("ui.chatArticle",this.handleChatArticle,this),o.on("click.blockPlayers",this.generateUI,this),o.on("ui.chatPanel",this.handleChatPanel,this)},stop(){o.off("ui.chatArticle",this.handleChatArticle,this),o.off("click.blockPlayers",this.generateUI,this),o.off("ui.chatPanel",this.handleChatPanel,this)},handleChatArticle(e){const t=(e=e.element).querySelector(".sender .name");if(t){const s=t.textContent.toLowerCase().trim();this.state.blockedPlayersList.includes(s)&&(e.style.display="none")}},unblockPlayer(e){e=e.toLowerCase();let t=new Set(this.state.blockedPlayersList)||new Set;t.has(e)&&(t.delete(e),t=Array.from(t),this.state.blockedPlayersList=[...t])},blockPlayer(e){e=e.toLowerCase();const t=new Set(this.state.blockedPlayersList)||new Set;t.has(e)||(t.add(e),this.state.blockedPlayersList=Array.from(t))},generateUI(e){const t=()=>{const e=document.querySelector(".blocked-players-list");if(!e)return;e.innerHTML="";const s=this.state.blockedPlayersList;if(s){const a=7;e.style.display="grid",e.style.gridTemplateColumns=`repeat(${a}, auto)`;for(let a of s){const s=document.createElement("div");s.className="blocked-player-item btn black textsecondary",s.style.margin="1px",s.style.display="flex",s.style.justifyContent="space-between",s.textContent=a,s.addEventListener("click",(()=>{this.unblockPlayer(a),t()})),e.appendChild(s)}}},s=document.querySelector(".blockedplayersKEK");if(s)return void s.remove();const a=k("Blocked Players","100px","100px",this.state._transform).element,n=document.createElement("div");n.className="panel-black bar slot";const i=document.createElement("div");i.className="blocked-players-list panel-black bar slot";const o=document.createElement("input");o.type="text",o.placeholder="Enter player name";const r=document.createElement("div");r.className="btn black textsecondary",r.textContent="Block Player",r.style.marginTop="5px",r.addEventListener("click",(()=>{const e=o.value.trim();e&&(this.blockPlayer(e),o.value="",t())})),n.appendChild(o),n.appendChild(r),a.appendChild(n),a.appendChild(i),document.body.appendChild(a),t()},handleChatPanel(e){(e=e.element).addEventListener("contextmenu",(e=>{const t=document.querySelector(".panel.context");if(t&&!t.classList.contains("kek-ui-menu")){t.classList.add("kek-ui-menu");const e=t.querySelector(".choice.disabled");if(e){const s=e.textContent.trim(),a=document.createElement("div");a.classList.add("choice"),a.textContent="Block",t.appendChild(a),a.addEventListener("click",(()=>{console.log("blocking "+s),this.blockPlayer(s),t.remove()}))}}}))}};const B=new class{constructor(){this.playerName=null,this.playerClass=null,this.playerLevel=null,this.pid=null,this.charSheetOpened=!1,this.profileMapping=JSON.parse(localStorage.getItem("profileMapping")||null)||{},this.foundProfile=!1,this.wrongProfile=null}init(){this.fetchPlayerInfo()}fetchPlayerInfo(){const e=document.querySelector("#ufplayer"),t=document.getElementById("syschar");if(e&&t){this.playerName=e.querySelector(".left").textContent;const s=e.querySelector("img").src,a=e.querySelector(".progressBar.bgmana");if(this.playerLevel=parseFloat(this.getLevel(a)),this.playerClass=parseFloat(y(s)),this.pid=parseFloat(this.getPid()),this.playerName.endsWith("...")){if(this.wrongProfile=`${this.playerName}_${this.playerClass}`,this.profileMapping[this.wrongProfile])return void(this.playerName=this.profileMapping[this.wrongProfile].split("_")[0]);this.charSheetOpened||(t.click(),this.charSheetOpened=!0,this.getPlayerName())}}else console.error("not found ufplayer or syscharElement"),setTimeout(this.fetchPlayerInfo.bind(this),1)}getPlayerName(){const e=document.querySelector(".statcol"),t=document.getElementById("syschar");if(e&&t){const t=e.querySelector("span:nth-child(2)");if(t){this.playerName=t.textContent.trim(),console.log("player name from second span: ",this.playerName);const e=`${this.playerName}_${this.playerClass}`;this.profileMapping[this.wrongProfile]=e,localStorage.setItem("profileMapping",JSON.stringify(this.profileMapping))}else console.error("not found second span"),setTimeout(this.getPlayerName.bind(this),1)}else console.error("not found statcol or syschar"),setTimeout(this.getPlayerName.bind(this),1)}getLevel(e){return e.childNodes[0].textContent.split(" ")[1]}getPid(){return localStorage.getItem("lastConnectedChar")}},A={name:"Expbar Tweaks",description:"Hide experience bar",state:{lvl:!1},settings:{lvl:{control:"checkbox",desc:"Hide for Level 45",comment:"Don't show expbar for 45 level.",onupdate:"handle"}},start(){o.on("ui.expbar",this.handle,this),p.expbar?.element&&this.handle()},stop(){i(stop),o.off("ui.expbar",this.handle,this),p.expbar.element.style.display="block"},handle(){const e=45===B.playerLevel&&this.state.lvl;p.expbar.element.style.display=e?"none":"block"}},N={name:"Rune Tracker",description:"Monitor and manage runes for your party",state:{activeTab:"rawCount",allRuneData:[],isActive:!1,_transform:{left:100,top:100,_drag:!0}},hotkey:{"Open Rune Tracker":{key:"h",callback:"generateUI"}},runeTrackerOpen:!1,runeData:[],paddingValue:"5px",marginValue:"3px",idx:0,start(){this.idx=this.state.allRuneData.length-1,this.runeData=this.state.allRuneData[this.idx],o.on("click.runeTracker",this.generateUI,this),o.on("ui.chatArticle",this.handleChatArticle,this)},stop(){o.off("click.runeTracker",this.generateUI,this),o.off("ui.chatArticle",this.handleChatArticle,this)},runeNames:["Lucid","Melant","Turim","Fundo","Amari"],handleChatArticle(e){const t=(e=e.element).querySelectorAll(".textnotice")[1];if(t){const e=t.textContent.trim(),s=e.match(/^(.*?)\s+received\s+(.*?)\s*x(\d+)\s*\.?$/),a=e.match(/^(.*?)\s+has left your party\.$/);if(a){const e=a[1];this.changePlayerState(e,0)}if(s){const e=s[1],t=s[2],a=parseInt(s[3]),n=t.split(" ")[1],i=t.split(" ")[0],o=parseInt(i.split("T")[1]);"rune"==n.trim().toLowerCase()&&this.addRuneData(e,o-1,a)}}},getActiveTab(){return this.state.activeTab},setActiveTab(e){this.state.activeTab=e},getRuneName:e=>({0:"Lucid",1:"Melant",2:"Turim",3:"Fundo",4:"Amari"}[e-1]),saveRuneData(e){let t=e||{};this.state.allRuneData=t},getRuneData(){return this.state.allRuneData},getRuneTrackerDataLength(){return this.state.allRuneData.length},addRuneData(e,t,s){let a;if(this.state.allRuneData&&(a=this.state.allRuneData[this.state.allRuneData.length-1]),a){if(this.getRuneTrackerState())for(const n in a)"activeTab"!=n&&(a[n][e]||(a[n][e]={},this.runeNames.forEach(((t,s)=>{a[n][e][s]=0})),a[n].by||(a[n].by="Amari")),a[n][e][t]=(a[n][e][t]||0)+s,a[n][e].state=1);this.saveRuneData(this.state.allRuneData),this.updateRuneTracker()}},changePlayerState(e,t){this.runeData&&this.runeData.rawCount&&this.runeData.manualCount&&(this.runeData.rawCount[e]&&(this.runeData.rawCount[e].state=t),this.runeData.manualCount[e]&&(this.runeData.manualCount[e].state=t),this.saveRuneData(this.state.allRuneData),this.updateRuneTracker())},getRuneTrackerState(){return this.state.isActive},updateRuneTracker(){const e=document.querySelector(".runeTrackerKEK");if(0==this.runeTrackerOpen)return;e&&e.remove();const t=document.createElement("div");x(t,this.state._transform),t.className="window panel-black runeTrackerKEK";const s=document.createElement("div");s.className="panel-black",s.style.display="grid",s.style.gridTemplateColumns=`auto repeat(${this.runeNames.length}, auto)`;const a=document.createElement("div");a.className="titleframe svelte-yjs4p5",a.style.display="flex",a.style.justifyContent="space-between";const n=document.createElement("button");n.style.padding="10px",n.style.flex=1,n.style.width="100px";this.getRuneTrackerState()?(n.textContent="Stop",n.className="btn textprimary rune-tracker-startbtn red"):(n.textContent="Start",n.className="btn textprimary rune-tracker-startbtn grey"),n.addEventListener("click",(()=>{"Start"==n.textContent?(n.textContent="Stop",n.className="btn textprimary rune-tracker-startbtn red",this.state.isActive=!0):(n.textContent="Start",n.className="btn textsecondary rune-tracker-startbtn grey",this.state.isActive=!1)}));const i=document.createElement("button");i.style.padding="10px",i.style.flex=1,i.textContent="New",i.style.width="100px",i.className="btn textprimary rune-tracker-btn grey",i.addEventListener("click",(()=>{this.state.allRuneData?this.idx=this.state.allRuneData.length:this.idx=0;const e={manualCount:{},rawCount:{}};this.runeData=e,this.state.allRuneData.push(e);this.state.allRuneData.length>10&&(this.state.allRuneData.shift(),this.idx=Math.max(0,this.idx-1)),this.saveRuneData(this.state.allRuneData),this.updateRuneTracker()}));const o=document.createElement("div");o.className="textprimary title svelte-yjs4p5",o.style.width="200px",o.style.padding="10px",o.textContent="Rune Tracker",a.appendChild(o),a.appendChild(n),a.appendChild(i),t.appendChild(a);const r=document.createElement("div");let l;if(r.className="btn black textprimary rune-tracker-item",r.textContent="Players",r.style.width="100px",r.style.padding=this.paddingValue,r.style.margin=this.marginValue,s.appendChild(r),t.appendChild(s),t.style.zIndex=10,t.style.height="calc(100vh - 500px)",t.style.overflow="hidden",t.addEventListener("wheel",(e=>{t.scrollTop+=e.deltaY})),document.body.appendChild(t),this.runeData){const e=document.createElement("div");e.style.display="flex",e.style.marginTop="10px";const t=document.createElement("input"),s=document.createElement("button");s.className="btn grey textsecondary",s.textContent="<",s.style.padding="10px",s.style.marginLeft="5px",s.addEventListener("click",(()=>{this.idx>0&&(this.idx--,t.value=this.idx,this.runeData=this.state.allRuneData[this.idx],this.updateRuneTracker())}));const n=document.createElement("button");n.textContent=">",n.style.padding="10px",n.className="btn grey textsecondary",n.addEventListener("click",(()=>{const e=this.getRuneTrackerDataLength();this.idx<e-1&&(this.idx++,t.value=this.idx,this.runeData=this.state.allRuneData[this.idx],this.updateRuneTracker())})),t.type="number",t.className="input",t.style.width="50px",t.value=this.idx,t.style.padding="7px",t.addEventListener("input",(()=>{const e=parseInt(t.value,10);!isNaN(e)&&e>=0&&(this.idx=e,t.value=this.idx,this.runeData=this.state.allRuneData[this.idx],this.updateRuneTracker())}));let i=this.getActiveTab()||"rawCount";l=this.runeData[i];const o=this.createTabButton("Raw Count","rawCount"),r=this.createTabButton("Manual Count","manualCount");a.appendChild(o),a.appendChild(r),a.appendChild(s),a.appendChild(t),a.appendChild(n)}const c=document.createElement("img");if(c.src="/data/ui/icons/cross.svg?v=8498194",c.className="btn black svgicon",a.appendChild(c),c.addEventListener("click",(()=>{t.remove(),this.runeTrackerOpen=!1})),l){this.runeNames.forEach((e=>{const t=document.createElement("div");t.className="btn black textprimary rune-tracker-item",t.textContent=e,t.style.padding=this.paddingValue,t.style.margin=this.marginValue,t.addEventListener("click",(()=>{this.runeData[this.getActiveTab()].by=e,this.saveRuneData(this.state.allRuneData),this.sortAndUpdateRuneTracker(l,e)})),s.appendChild(t)}));for(const e in l){if("by"===e)continue;const t=document.createElement("div");t.className="btn black textsecondary rune-tracker-item",t.textContent=e;const a=e==B.playerName,n=this.runeData.rawCount[e].state;a&&t.classList.add("textgreen"),0===n&&t.classList.add("textgrey"),t.style.width="100px",t.style.padding=this.paddingValue,t.style.margin=this.marginValue,s.appendChild(t);for(let t=0;t<this.runeNames.length;t++){const i=document.createElement("div");i.className="btn black textsecondary rune-tracker-item",a&&i.classList.add("textgreen"),0===n&&i.classList.add("textgrey"),i.textContent=null!==l[e][t]?l[e][t]:"N/A",i.style.padding=this.paddingValue,i.style.margin=this.marginValue,"manualCount"==this.getActiveTab()&&(i.addEventListener("click",(()=>{l[e][t]++,this.saveRuneData(this.state.allRuneData),this.updateRuneTracker()})),i.addEventListener("contextmenu",(s=>{s.preventDefault(),console.log("from context menu in cell"),l[e][t]=Math.max(0,l[e][t]-1),this.saveRuneData(this.state.allRuneData),this.updateRuneTracker()}))),s.appendChild(i)}}}},generateUI(){if(this.runeTrackerOpen){const e=document.querySelector(".runeTrackerKEK");return e&&e.remove(),void(this.runeTrackerOpen=!1)}this.runeTrackerOpen=!0,this.updateRuneTracker()},updateTabButtonClass(e,t){const s=this.getActiveTab()==t;e.className="btn textprimary rune-tracker-btn "+(s?"disabled black":"grey")},createTabButton(e,t){const s=document.createElement("button");return this.updateTabButtonClass(s,t),s.style.padding="10px",s.style.flex=1,s.style.width="130px",s.textContent=e,s.value=t,s.addEventListener("click",(()=>{this.setActiveTab(s.value),this.saveRuneData(this.state.allRuneData),this.updateRuneTracker();document.querySelectorAll(".rune-tracker-btn").forEach((e=>this.updateTabButtonClass(e,e.value)))})),s},getSortedData(e,t){const s={};return Object.keys(e).filter((e=>"by"!==e)).sort(((s,a)=>{const n=e[s][this.runeNames.indexOf(t)];return e[a][this.runeNames.indexOf(t)]-n})).forEach((t=>{s[t]=e[t]})),s.by=e.by,s},sortAndUpdateRuneTracker(e,t){const s=this.getSortedData(e,t);this.runeData[this.getActiveTab()]=s,this.updateRuneTracker()}},D={name:"Gloom Timer/Data",state:{_transform:{timer:{left:100,top:100,_drag:!0},personal:{left:100,top:100,_drag:!0},ranking:{left:100,top:100,_drag:!0}}},start(){3==B.playerClass&&(this.defaultRequiredArg="hps"),this.oldOptions=[this.defaultRequiredArg],o.on("click.gloomPersonal",this.handlePersonalGloom,this),o.on("click.gloomRanking",this.handleGloomRankings,this),o.on("ui.sysbtnbar",this.addBtn,this),p.sysbtnbar&&(this.personalGloomBtn||this.rankingBtn||this.addBtn(p.sysbtnbar))},stop(){o.off("click.gloomPersonal",this.handlePersonalGloom,this),o.off("click.gloomRanking",this.handleGloomRankings,this),o.off("ui.sysbtnbar",this.addBtn,this),this.personalGloomBtn&&(this.personalGloomBtn.remove(),this.personalGloomBtn=null),this.rankingBtn&&(this.rankingBtn.remove(),this.rankingBtn=null)},isFetchingPersonal:!1,gloomRankingData:{},gloomPersonalData:{},defaultRequiredArg:"dps",rankingOpened:!1,oldOptions:[],isFetchingRanking:!1,requiredButtonGroup:["dps","hps","mps","kills","deaths"],optionalButtonGroups:{faction:["vg","bl"],class:["warrior","mage","shaman","archer"],duration:["true"]},gloomTimerVisible:!1,gloomTimerInterval:null,rankingBtn:null,personalGloomBtn:null,rankingSvg:'<svg fill="#a6dcd5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" stroke="#ffffff"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M6.5,12h-4a.5.5,0,0,0-.5.5V20H7V12.5A.5.5,0,0,0,6.5,12Z"></path><path d="M14,4H10a.5.5,0,0,0-.5.5V20h5V4.5A.5.5,0,0,0,14,4Z"></path><path d="M21.5,8h-4a.5.5,0,0,0-.5.5V20h5V8.5A.5.5,0,0,0,21.5,8Z"></path></g></svg>',personalGloomSvg:'<svg fill="#a6dcd5" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" stroke="#ffffff"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <title>archery-target</title> <path d="M9.791 15.798c0 3.429 2.78 6.209 6.209 6.209s6.209-2.78 6.209-6.209-2.78-6.209-6.209-6.209-6.209 2.78-6.209 6.209zM16.003 12.066c2.062 0 3.734 1.672 3.734 3.734s-1.672 3.734-3.734 3.734c-2.062 0-3.734-1.672-3.734-3.734s1.672-3.734 3.734-3.734zM17.81 15.8c0 0.998-0.809 1.807-1.807 1.807s-1.807-0.809-1.807-1.807c0-0.998 0.809-1.807 1.807-1.807s1.807 0.809 1.807 1.807zM23.148 20.662c0-0 0-0 0-0l1.113 3.669c2.229-2.159 3.615-5.182 3.615-8.53 0-5.832-4.204-10.682-9.748-11.684l-0.79-2.606-3.232-0-0.818 2.727c-5.25 1.227-9.16 5.938-9.16 11.562 0 3.16 1.235 6.032 3.248 8.159l-1.944 6.482h2.926l1.466-4.5c1.304 0.796 2.773 1.348 4.345 1.592v2.909h3.251v-6.116c-0.461 0.076-0.934 0.116-1.416 0.116-0.629 0-1.243-0.068-1.834-0.196-1.236-0.267-2.374-0.799-3.351-1.533-0.927-0.696-1.71-1.575-2.294-2.582 0.004 0.008 0.009 0.015 0.014 0.023-0.747-1.278-1.175-2.765-1.175-4.353 0-3.384 1.946-6.314 4.78-7.732-0.001 0-0.001 0.001-0.002 0.001v0c1.163-0.582 2.475-0.91 3.863-0.91 1.146 0 2.239 0.223 3.239 0.628 3.167 1.282 5.402 4.386 5.402 8.013 0 1.803-0.553 3.478-1.498 4.863-0.636 0.932-1.449 1.733-2.392 2.355 0-0 0-0 0.001-0-0.989 0.652-2.12 1.107-3.336 1.308v3.264c1.571-0.187 3.048-0.681 4.369-1.42l1.401 4.271h2.926l-2.967-9.78c-0 0-0 0-0 0z"></path> </g></svg>',addBtn(e){e=e.element;const t=this.createBtn("👹","Gloom Personal"),s=this.createBtn("📊","Gloom Rankings");this.rankingBtn=s,this.personalGloomBtn=t,f(e,t),f(e,s)},createBtn(e,t){const s=g("div",{className:"btn border black textsecondary",tooltip:t,style:"padding-left: 3px; padding-right: 3px; margin: 2px;"}).element,a=g("img").css("svgicon").element;let n="";return"Gloom Rankings"==t&&(n=encodeURIComponent(this.rankingSvg),s.addEventListener("click",this.handleGloomRankings.bind(this))),"Gloom Personal"==t&&(n=encodeURIComponent(this.personalGloomSvg),s.addEventListener("click",this.handlePersonalGloom.bind(this))),a.src=`data:image/svg+xml,${n}`,s.appendChild(a),s},calculateTimeUntilNextGloom(e,t){const s=e.getUTCHours(),a=e.getUTCMinutes();let n=0;for(let e=0;e<t.length;e++)if(s<t[e]||s===t[e]&&a<60){n=e;break}let i=t[n]-s,o=60-a;o>0&&(i-=1);return{hours:i,minutes:o,seconds:60-e.getUTCSeconds()}},updateGloomTime(){const e=new Date,t=this.calculateTimeUntilNextGloom(e,[1,4,7,10,13,16,19,22]);return t.hours<0&&(t.hours+=3),`${t.hours}h ${t.minutes}m ${t.seconds}s`},updateObeliskTime(){const e=new Date,t=this.calculateTimeUntilNextGloom(e,[1,4,7,10,13,16,19,22]);let s=t.hours-1;const a=t.minutes,n=t.seconds;return s<0&&(s=3-Math.abs(s)),`${s}h ${a}m ${n}s`},createGloomTimer(){const e=document.activeElement;if("INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName)if(this.gloomTimerVisible){const e=document.querySelector(".gloomtimerKEK");e&&e.remove(),this.gloomTimerVisible=!1,clearInterval(this.gloomTimerInterval)}else{const e=k("Gloom Timer","100px","100px",this.state._transform.timer).element,t=w(["Event","Time"],"gloomGridKEK").element,s=document.createElement("div");s.className="textsecondary btn black",s.textContent=`${this.updateGloomTime()}`;const a=document.createElement("div");a.className="textsecondary btn black",a.textContent=`${this.updateObeliskTime()}`,t.appendChild(g("div",{textContent:"Gloom",className:"btn black textsecondary"}).element),t.appendChild(s),t.appendChild(g("div",{textContent:"Obelisk",className:"btn black textsecondary"}).element),t.appendChild(a),e.appendChild(t),document.body.appendChild(e),e.style.zIndex=20,this.gloomTimerInterval=setInterval((()=>{this.gloomTimerVisible&&(s.textContent=`${this.updateGloomTime()}`,a.textContent=`${this.updateObeliskTime()}`)}),1e3),this.gloomTimerVisible=!0}},async handlePersonalGloom(){const e=document.querySelector(".gloomdataKEK");if(e)return void e.remove();const t=k("Gloom Data","100px","100px",this.state._transform.personal).element,s=document.createElement("div");s.classList.add("btn","black","textprimary","refreshBtnPersonalGloom"),s.textContent="Refresh",s.style.padding="7px",s.style.margin="5px",this.isFetchingPersonal&&(s.classList.remove("black"),s.classList.add("disabled","grey"),s.textContent="Refreshing..."),s.addEventListener("click",(()=>{s.classList.remove("black"),s.classList.add("disabled","grey"),this.isFetchingPersonal=!0,s.textContent="Refreshing...",a.request("kek.gloom.personal",{player_name:B.playerName}).then((e=>{this.gloomPersonalData=e,this.updateGloomDataGrid(this.gloomPersonalData);const t=document.querySelector(".refreshBtnPersonalGloom");t&&(t.classList.remove("disabled","grey"),t.classList.add("black"),t.textContent="Refresh"),this.isFetchingPersonal=!1})).catch((e=>{console.log(e);const t=document.querySelector(".refreshBtnPersonalGloom");t&&(t.classList.remove("disabled","grey"),t.classList.add("black"),t.textContent="Refresh"),this.isFetchingPersonal=!1}))})),s.click(),t.appendChild(s),document.body.appendChild(t),this.updateGloomDataGrid(this.gloomPersonalData)},handleGloomRankings(){const e=document.querySelector(".gloomrankingKEK");if(e)return void e.remove();const t=k("Gloom Ranking","100px","100px",this.state._transform.ranking).element,s=e=>{const t=document.createElement("div");return t.className="optional-buttons-row",this.optionalButtonGroups[e].forEach((s=>{const a=n(s,(t=>((e,t)=>{e.stopPropagation(),e.preventDefault();const s=document.querySelectorAll(`.optional-btn-${t}`),a=e.target;t&&(a.classList.contains("selected")?(a.classList.remove("grey","selected"),a.classList.add("black")):s.forEach((e=>{e===a?(e.classList.add("grey","selected"),e.classList.remove("black")):(e.classList.remove("grey","selected"),e.classList.add("black"))})))})(t,e)),"optional",e);this.oldOptions.includes(a.value)&&(a.classList.remove("black"),a.classList.add("grey","selected")),t.appendChild(a)})),t},n=(e,t,s,a="")=>{const n=document.createElement("div");return n.value=e,n.textContent=e.charAt(0).toUpperCase()+e.slice(1),"bl"!=e.toLowerCase()&&"vg"!=e.toLowerCase()||(n.textContent=e.toUpperCase()),n.addEventListener("click",t),"submit"===s&&(n.className="btn black textprimary submit-btn-kek"),"optional"===s&&(n.className=`btn black textsecondary optional-btn-${a}`),"required"===s&&(n.className="btn black textsecondary required-btn-kek"),n},i=e=>{const t=[];this.rankingOpened=!0;for(const e in this.optionalButtonGroups){document.querySelectorAll(`.optional-btn-${e}`).forEach((e=>{e.classList.contains("selected")&&t.push(e.value)}))}let s="";const n=document.querySelectorAll(".required-btn-kek");for(let e of n)if(e.classList.contains("selected")){s=e.value;break}this.oldOptions=[...t,s];const i=t.length>0?t.join(" "):"none";console.log("Optional Args:",i),console.log("Required Arg:",s),e.target.classList.add("disabled","grey"),e.target.classList.remove("black"),e.target.textContent="Fetching...",this.isFetchingRanking=!0,a.request("kek.gloom.ranking",{player_name:B.playerName,required_arg:s,optional_args:i}).then((e=>{this.updateGloomRankingGrid(e),this.gloomRankingData=e;const t=document.querySelector(".submitBtnGloomRanking");t&&(t.classList.remove("disabled","grey"),t.classList.add("black"),t.textContent="Submit"),this.isFetchingRanking=!1})).catch((e=>{console.error(e);const t=document.querySelector(".submitBtnGloomRanking");t&&(t.classList.remove("disabled","grey"),t.classList.add("black"),t.textContent="Submit"),this.isFetchingRanking=!1}))},o=document.createElement("div");o.style.display="flex",o.classList.add("flex-container-kek"),o.style.flexDirection="row";const r=document.createElement("div");r.className="panel-black";const l=document.createElement("div");l.textContent="Required",l.className="btn black textprimary";const c=document.createElement("div");c.className="required-buttons-row",c.style.padding="5px",c.appendChild(l),this.requiredButtonGroup.forEach((e=>{const t=n(e,(e=>(e=>{e.stopPropagation(),e.preventDefault();const t=e.target,s=document.querySelectorAll(".required-btn-kek");t.classList.contains("selected")?(t.classList.remove("grey","selected"),t.classList.add("black")):s.forEach((e=>{e===t?(e.classList.add("grey","selected"),e.classList.remove("black")):(e.classList.remove("grey","selected"),e.classList.add("black"))}))})(e)),"required");this.oldOptions.includes(t.value)&&(t.classList.remove("black"),t.classList.add("grey","selected")),c.appendChild(t)})),r.appendChild(c);const d=document.createElement("div");d.className="optional-container",d.style.display="flex",d.style.margin="0",d.style.padding="5px";for(const e in this.optionalButtonGroups){const t=document.createElement("div");t.textContent=e.charAt(0).toUpperCase()+e.slice(1),t.className="btn black textprimary";const a=s(e);a.insertBefore(t,a.firstChild),d.appendChild(a)}const h=document.createElement("div");h.classList.add("submitBtnContainer");const m=n("Submit",(e=>i(e)),"submit");m.classList.add("submitBtnGloomRanking"),1==this.isFetchingRanking&&(m.classList.add("disabled","grey"),m.classList.remove("black"),m.textContent="Fetching..."),h.appendChild(m),d.appendChild(h),r.appendChild(d),o.appendChild(r),t.appendChild(o),document.body.appendChild(t),this.updateGloomRankingGrid(this.gloomRankingData)},updateGloomRankingGrid(e){if(!e)return;const t=document.querySelector(".gloomrankingGridKEK");if(t&&t.remove(),!(e=e.data))return;delete e[0].id;const s=Object.keys(e[0]).map((e=>e.charAt(0).toUpperCase()+e.slice(1))),a=w(s,"gloomrankingGridKEK").element;for(let t of e)for(let e of s){e=e.toLowerCase();let s=t[e];const n=document.createElement("div");if(n.className="btn black textsecondary personal-gloom-item","faction"==e.toLowerCase()&&(n.classList.remove("textsecondary"),n.classList.add(`textf${s}`),s=0==s?"VG":"BL"),"name"==e.toLowerCase()&&B.playerName==s&&(n.classList.remove("textsecondary"),n.classList.add("textgreen")),"class"==e.toLowerCase()){s={0:"Warrior",1:"Mage",2:"Arch",3:"Sham"}[s]}n.textContent=s,n.style.margin="2px",n.style.padding="4px",a.appendChild(n)}const n=document.querySelector(".gloomrankingKEK");if(n){n.querySelector(".flex-container-kek").appendChild(a)}},updateGloomDataGrid(e){const t=document.querySelector(".gloomdataGridKEK");t&&t.remove();if(!e)return;const s=Object.keys(e).map((e=>e.charAt(0).toUpperCase()+e.slice(1)));s.push("K/D");const a=w(s,"gloomrankingGridKEK").element;a.classList.add("gloomdataGridKEK");for(let t in e){let s=e[t];const n=document.createElement("div");n.className="btn black textsecondary personal-gloom-item",n.textContent=s,n.style.margin="3px",n.style.padding="5px",a.appendChild(n)}let n=(e.kills/e.deaths).toFixed(2);const i=document.createElement("div");i.className="btn black textsecondary personal-gloom-item",i.textContent=n,i.style.margin="3px",i.style.padding="5px",a.appendChild(i);const o=document.querySelector(".gloomdataKEK");o&&o.appendChild(a)}},q={name:"Whispers",whisperBtn:null,state:{whisperLogs:{},_transform:{top:100,left:100,_drag:!0}},hotkey:{"Open Whispers":{key:"/",callback:"generateUI"}},currentSenderName:"",currentMessage:"",sendInput:null,start(){o.on("click.whispers",this.generateUI,this),o.on("ui.chatArticle",this.handleChatArticle,this),o.on("ui.channelSelect",this.addControlBtn,this)},stop(){o.off("click.whispers",this.generateUI,this),o.off("ui.chatArticle",this.handleChatArticle,this),document.contains(this.whisperBtn)&&this.whisperBtn.remove()},addControlBtn(e){this.controlBtn=g("small").css("btn border black textgrey").text("Whispers").style({lineHeight:"1em",marginRight:"4px"}).on("click",(()=>{this.generateUI()})),e.element.appendChild(this.controlBtn.element)},toggleControlBtn(){["textgrey","textprimary"].forEach((e=>this.controlBtn.toggle(e)))},handleChatArticle(e){const{sender_name:t,text:s,channel:a}=e.obj;if(e=e.element,"to"==a?.textContent||"from"==a?.textContent){const e=t.textContent,n=a.textContent,i=s.textContent;this.addWhisperLog(n,e,i,B.playerName),this.currentSenderName==e&&this.displayWhisperLogs(e),this.updateSenderNameList()}},calculateTotalNotSeen(e){const t=e.reduce(((e,t)=>e+(0===t.seen?1:0)),0);return t},fetchAllSenderNames(){const e=Object.keys(this.state.whisperLogs);e.sort(((e,t)=>{const s=this.state.whisperLogs[e]?this.calculateTotalNotSeen(this.state.whisperLogs[e]):0;return(this.state.whisperLogs[t]?this.calculateTotalNotSeen(this.state.whisperLogs[t]):0)-s}));const t={},s={};for(let t of e)s[t]=this.state.whisperLogs[t];this.state.whisperLogs=s;for(let s of e)t[s]=this.state.whisperLogs[s][this.state.whisperLogs[s].length-1].seen;return t},updateWhisperLogs(e,t){this.state.whisperLogs[e]=t},addWhisperLog(e,t,s,a){const n={content:s,type:e,receiver:a,seen:0};if(this.state.whisperLogs[t]){this.state.whisperLogs[t].push(n);const e=20;this.state.whisperLogs[t].length>e&&this.state.whisperLogs[t].shift()}else this.state.whisperLogs[t]=[n]},fetchWhisperLogs(e){return this.state.whisperLogs[e]?this.state.whisperLogs[e]:[]},chatInputListener(e){const t=C.state.emojiList,s=e.target;let a=s.value;for(const[e,s]of Object.entries(t))a=a.replace(new RegExp(e,"g"),s);s.value=a},generateUI(){const e=document.querySelector(".whispersKEK");if(this.toggleControlBtn(),e)return void e.remove();let t=this.fetchAllSenderNames(),s=Object.keys(t);const a=k("Whispers","100px","0px",this.state._transform,this.toggleControlBtn.bind(this)).element;a.querySelector(".titleframe").style.borderBottom="2px solid #393636";const n=document.createElement("div");n.classList.add("senderContainerKEK"),n.style.display="flex",n.style.flexDirection="column";const i=document.createElement("div");i.style.display="flex",i.style.flexDirection="column",i.classList.add("whisperContainerKEK");const o=document.createElement("div");o.classList.add("senderNamesListContainerKEK"),o.style.overflow="hidden",o.style.height="400px",o.addEventListener("wheel",(e=>{o.scrollTop+=e.deltaY}));const r=document.createElement("div");r.classList.add("senderNamesListKEK"),r.style.display="flex",r.style.flexDirection="column",s.forEach((e=>{const s=document.createElement("div"),a=t[e];s.textContent=0==a?e+" (new)":e,s.classList.add("btn","black","textsecondary","border"),s.addEventListener("click",(t=>{this.handleSenderNameClick(t,e)})),s.style.padding="10px",r.appendChild(s)}));const l=document.createElement("input");l.setAttribute("placeholder","Search Names..."),l.addEventListener("input",this.handleSortInput.bind(this)),l.style.padding="10px",o.appendChild(r);const c=document.createElement("div");c.classList.add("whisperLogsListContainerKEK"),c.style.height="400px",c.style.overflow="hidden",c.addEventListener("wheel",(e=>{c.scrollTop+=e.deltaY}));const d=document.createElement("div");d.style.width="600px",d.id="whisperLogsList";const h=document.createElement("input");h.setAttribute("placeholder","Type your message..."),h.addEventListener("keypress",this.handleSendWhisperInput.bind(this)),h.style.padding="10px",h.style.width="600px",h.addEventListener("input",this.chatInputListener.bind(this)),this.sendInput=h,l.classList.add("btn","black","textsecondary"),h.classList.add("btn","black","textsecondary"),c.appendChild(d);const m=document.createElement("div");m.style.display="flex",n.appendChild(l),n.appendChild(o),i.appendChild(c),i.appendChild(h),m.appendChild(n),m.appendChild(i),a.appendChild(m),document.body.appendChild(a)},handleSenderNameClick(e,t){const s=document.querySelector(".whispersKEK .title");e.stopPropagation(),e.target,this.currentSenderName=t,this.displayWhisperLogs(t),s&&(s.style.width="300px",s.textContent="Whispering "+this.currentSenderName);document.querySelectorAll(".senderNamesListKEK .btn").forEach((e=>{e.classList.remove("grey"),e.classList.add("black")})),this.updateSenderNameList()},displayWhisperLogs(e){let t=this.fetchWhisperLogs(e);const s=document.querySelector("#whisperLogsList");s&&(s.innerHTML="",t.forEach((e=>{const t=document.createElement("div");t.classList.add("btn","black","textsecondary"),t.style.margin="5px",e.content.trim().length>40?t.style.width="300px":t.style.width="fit-content",t.style.whiteSpace="normal",t.style.padding="7px",t.textContent=`${e.content}`,t.style.marginLeft="from"===e.type?"10":"auto",t.style.marginRight="to"===e.type?"10":"auto",s.appendChild(t),e.seen=1})),s.parentNode.scrollTop=s.parentNode.scrollHeight,this.updateWhisperLogs(e,t))},updateSenderNameList(e){let t,s;const a=document.querySelector(".senderNamesListKEK");a&&(t=e||this.fetchAllSenderNames(),s=Object.keys(t),a.innerHTML="",s.forEach((e=>{const s=document.createElement("div"),n=t[e];s.textContent=0==n?e+" (new)":e,s.classList.add("btn","black","textsecondary","border"),e==this.currentSenderName&&(s.classList.remove("black"),s.classList.add("grey")),s.addEventListener("click",(t=>{this.handleSenderNameClick(t,e)})),s.style.padding="10px",a.appendChild(s)})))},handleSortInput(e){let t=this.fetchAllSenderNames(),s=Object.keys(t);const a=e.target.value.toLowerCase(),n=s.filter((e=>e.toLowerCase().includes(a))),i={};for(let e of n)i[e]=t[e];this.updateSenderNameList(i)},handleSendWhisperInput(e){"Enter"===e.key&&(this.sendWhisper(e.target.value),e.target.value="")},sendWhisper(e){if(""==this.currentSenderName)return;this.currentMessage=e;const t=document.querySelector(".chatsection input");document.body.dispatchEvent(new KeyboardEvent("keydown",{bubbles:!0,keyCode:13})),t&&(t.value=`/${this.currentSenderName} `,t.dispatchEvent(new InputEvent("input",{bubbles:!0})),setTimeout((()=>{t.value=`${this.currentMessage}`,t.dispatchEvent(new KeyboardEvent("input",{bubbles:!0})),setTimeout((()=>{t.dispatchEvent(new KeyboardEvent("keydown",{bubbles:!0,keyCode:13})),this.sendInput.focus()}),0)}),0))},handlePartyBtn(e){e=e.element;const t=g("div",{className:"btn border black textsecondary",textContent:"Whispers"}).element;t.addEventListener("click",this.generateUI.bind(this)),this.whisperBtn=t,function(e,t){e.appendChild(t)}(e,t)}},F={amulet:[{name:"Rotten Talisman",description:"Burned ingredients have been twisted and tied together to form an amulet of meager protection. Creating simple amulets like this has been a common survival tactic since ancient times."},{name:"Wolf's Collar",description:"Collars to keep wolves in servitude are made from a thick leather. Some of them still have chain links connected, but all wolf collars are sturdy. Some collars are imbued with spiritual protection."},{name:"Bone Necklace",description:"This necklace consists of bone fragments from a variety of strong creatures. Each bone necklace varies in protection based on the origin of the bones."},{name:"Werewolf's Claw",description:"Fearsome werewolf claws that were left behind on the bodies of victims were anointed with mystic oils and instilled with spiritual fortitude through meditation. The creators of these amulets hoped that these spiritual protections would one day be used for revenge."},{name:"Eagle's Talon",description:"When a talon was found, it was considered a gift from the sacred birds in the mountains. The monks in the mountains used the talons to produce spiritual amulets to protect themselves from invaders during battle."},{name:"Shadow Scarab",description:"Ancient desert people collected special stones and shaped them into scarabs with strange, dark magic. Many important people in that ancient civilization wore these amulets for stature and protection."},{name:"Mystic Shard",description:"Strange shards mined from the mountains were enhanced by mystics and formed into amulets in order to provide protection and cause fear."},{name:"Omega Medallion",description:"Warring theocracies created divine omega symbols as a means for protection. These symbols were used to deter attacks, given as protective gifts, and presented to potential religious followers."},{name:"Verstärker",description:"This amulet has a strange set of overlapping discs that taps into natural energies and amplifies the natural protection of the wearer. Many magic users strive to learn the secrets of these amulets so that they can be reproduced."},{name:"Tempest Carcanet",description:"Metal strands weave in and out of each other, producing electric arcs and giving the appearance of a living amulet. Scholars speculate that these amulets came from a realm that disappeared, but no one seems sure."},{name:"Ankh",description:"Ancient kings had powerful ankh symbols made to protect them in the afterlife. Grave robbers have stolen many of these amulets and sold them to both people and monsters. Each ankh has an eerie glow that belies its true power."},{name:"Yggdrasil Pendant",description:"Twisted pieces of the enormous World Tree, Yggdrasil, were made into amulets of the most sacred kind. Sap seeps out of the amulet and is absorbed by the body for extra protection."},{name:"Dragon's Periapt",description:"This amulet contains elder dragon magic that was bestowed upon young dragons; these amulets gave young dragons a better chance of survival into adolescence. Once the young dragons became old and large enough to survive on their own, the chain broke and the amulet was lost."},{name:"Lionheart",description:"This amulet contains a gem from the crown worn by a famous king. The edges of this amulet are ruthlessly sharp and partially smeared with a mysterious substance."},{name:"Phoenix",description:"The center of this amulet of phoenix feathers contains a small amount of ashes from all of the fallen adventurers that have ever owned it. Without exception, every adventurer to use such an amulet has transcended into legend."}],armlet:[{name:"Simple Wristbands",description:"These wristbands are leather strips that are wrapped in a simple formation."},{name:"Makeshift Armbands",description:"These armbands were created hastily. The rough battle markings on the sides of the leather do not inspire confidence of the previous owner's survival."},{name:"Leather Armlets",description:"Tough leather has been painstakingly crafted into fine armlets. On the side of the leather is the craftsman's signature: \"Markay'ak\"."},{name:"Bone Bracelets",description:"This type of bracelet is ornately crafted with thick monster bones. Many superstitious traditions claim that the wearer of such bracelets become permeated with the deceased monster's power; however, others claim that the reuse of bones prevents monsters from resurrecting."},{name:"Iron Vambraces",description:"This type of iron armor has been heavily used in war and remains dirty. The claw marks on the metal seem to be mostly superficial."},{name:"Imbued Bracers",description:"These steel bracers are marked with small runes that imbue extra protection. Imbued bracers are somewhat rare since the creation method of the runes is a secret."},{name:"Ember Cuffs",description:"These cuffs were forged with a special fire that can only be created through magic. In the past, fire elementals taught only a few special blacksmiths the secret to forging ember cuffs."},{name:"Mirror Armlets",description:"Mirrored armlets are made by exceptional blacksmiths with the skills necessary to make reflective armor for damage reduction. This protective quality inspired many Elvish wizards to often experiment on mirrored armlets."},{name:"Golem Fragments",description:"Golem fragments are painstakingly assembled by a small team of magic-using blacksmiths. Every pair of golem fragments is crafted over several hundred days using the husks of rock golems."},{name:"Coldforged Bracers",description:"Bracers such as this are comprised of a rare metal found in the mountains. Blacksmiths use enchanted hammers to forge the bracers without heat in order to retain the magic-enhancing properties of the metal."},{name:"Blackstars",description:"These bracers were created by blacksmiths that hammered metal found within black meteorites. So far, the greatest concentration of black meteorites was found after a cataclysm that followed the Second Great War."},{name:"Mobiuses",description:"Ambitious wizards on the edge of madness discovered secrets to dimensional magic and formed bracers that transcend normal magical protection. These abnormal bracers required a special shape to maintain their properties."},{name:"Guardians",description:"Some legends say that these bracers only appear when the realms need a guardian. History shows that terrible tragedies occur shortly thereafter whenever these bracers are found; as such, their appearances are often seen as bad omens."}],bag:[{name:"Linen Pouch",description:"This pouch is made from a delicate fabric. Pouches such as this are often owned by common people for carrying their belongings."},{name:"Adventurer's Rucksack",description:"This rugged sack is crafted from sturdy fabrics to hold more equipment than a linen pouch."},{name:"Purpur Duffel",description:"This robust sack is made from monster hides and permits a respectable inventory."},{name:"Elven Saddlebag",description:"This fine bag was crafted from expensive Elvish fabrics and contains more pockets than most other bags."},{name:"Moss Enigma",description:"Bags such as this are a gift from nature to secret druid societies. Unfortunately, monsters have disposed of many druids over time and have stolen these sacred bags."}],book:[{name:"Auto attack",description:"Perform automatic melee attacks with your weapon."},{name:"Slash",description:"Slash your enemy, striking with extra force. Heals you for 5% of the damage done."},{name:"Bulwark",description:"Temporarily increases your block chance, while also healing you when you block."},{name:"Crescent Swipe",description:"Swiftly swing your sword around you, damaging enemies within a radius."},{name:"Ice Bolt",description:"Fires a missile of frost towards your enemy. Reduces the cooldown of Icicle Orb by 0.5 seconds. Freezes targets for up to 5 stacks, at which they will be stunned and take 50% increased damage. Gains one instant cast every 7 seconds."},{name:"Auto attack",description:"Automatically attack your enemy at a distance."},{name:"Mend",description:"Heal a friendly target. Amount is increased for each stack of Revitalize."},{name:"Revitalize",description:"Heal a friendly target over a short duration, stacking up to 3 times while also increasing the power of your Mend."},{name:"Bloodline",description:"You inherited special abilities through your ancestry and family traditions, granting you extra benefits from certain stats."},{name:"Precise Shot",description:"A carefully aimed, high damage shot. Increases the damage of your next Swift Shots and allows them to be cast instantly."},{name:"Serpent Arrows",description:"Your Precise Shots will jump to additional targets while active."},{name:"Invigorate",description:"Instantly recovers MP and increases your damage temporarily."},{name:"Decay",description:"Curse your enemy with a spell of decay, dealing initial damage and additional damage over time."},{name:"Mimir's Well",description:"You and your party members quickly regenerate mana over a short period of time."},{name:"Chilling Radiance",description:"Emit a chilling shockwave of ice around you, damaging and freezing enemies. Increases the critical hit chance of some of your spells."},{name:"Icicle Orb",description:"Summon a large orb, ejecting icicles hitting all enemies in its path."},{name:"Hypothermic Frenzy",description:"You gain Haste and all your damage output is increased."},{name:"Enrage",description:"Temporarily increases your damage output."},{name:"Centrifugal Laceration",description:"Your Crescent Swipe lacerates enemies, causing them to bleed for additional Damage. Stacks up to 3 times."},{name:"Unholy Warcry",description:"You and your party members deal additional Damage."},{name:"Crusader's Courage",description:"You and your party members gain additional Defense and Mana Regeneration."},{name:"Armor Reinforcement",description:"Passively increase your Defense."},{name:"Arctic Aura",description:"You and your party members gain additional Crit %."},{name:"Ice Shield",description:"Protects you against the next incoming attacks."},{name:"Enchantment",description:"Increase your target's Damage."},{name:"Temporal Dilation",description:"You and your party members gain additional Haste."},{name:"Cranial Punctures",description:"Passively increase your Crit %."},{name:"Pathfinding",description:"You and your party members gain additional Movement Speed."},{name:"Canine Howl",description:"You and your party members become enraged with Haste, enabling you to attack faster."},{name:"Poison Arrows",description:"Your Precise Shot applies a poisonous Debuff on hit, damaging and slowing your enemies."},{name:"Healing Totem",description:"Place a totem on the ground, healing your entire party."},{name:"Swift Shot",description:"Fire a Swift Shot which can be enhanced by casting a Precise Shot prior to it."},{name:"Teleport",description:"Instantly teleport into the direction you are facing."},{name:"Charge",description:"Charge towards any target while also stunning it (if hostile). Stun duration increases with charge distance."},{name:"Taunt",description:"Taunt surrounding enemies, slowing their movement speed for a short duration. Forces monsters to attack you."},{name:"Summon",description:"Summon your party members, allowing them to instantly teleport towards you."},{name:"Spirit Animal",description:"Turn into your spirit animal for additional movement speed, removing all movement impairing effects active at the point of the transformation. All spellcasting will cancel this effect."},{name:"Agonize",description:"Turns your target into a zombie, interrupting all actions, slowing it down, and reducing received healing for the duration."},{name:"Dash",description:"You dash into your current direction, instantly resetting the cooldown of Precise Shot. Your next Precise Shot is an instant cast."},{name:"Mount Riding",description:"Allows you to ride ground mounts. Mounts are bound to your account."},{name:"Conjurer's Recall",description:"Teleport to the nearest Conjurer."},{name:"Tempering",description:"Two seconds after casting all active stun and root effects on you will be removed. If any effect is removed then your Charge cooldown is reset and you gain 20 Movement Speed for 3 seconds."},{name:"Soul Harvest",description:"Reap the souls of nearby enemies affected by Decay, dealing damage and granting you mana for each harvested soul."},{name:"Plaguespreader",description:"Decay deals damage and jumps to a nearby enemy if the current target is already affected by Decay. Additionally, casting Decay grants you Haste for a short duration."},{name:"Flamepits",description:"Lights the ground below enemies on fire"},{name:"Volley",description:"Rapidly shoots arrows at all targets in front of you, dealing damage over a short period of time."},{name:"Whirlwind",description:"Spins your sword for a short period of time, dealing damage to all targets around you while slowing you down. Removes all root effects when used. You can't block attacks while active."},{name:"Mimir's Cleanse",description:"Removes negative effects from a friendly target, prioritizing movement impairing effects. Heals the target for each removed effect."},{name:"Vampiric Arrow",description:"A cursed arrow which bites your enemy, healing you as it returns. If your target is casting, the cast will be interrupted and the healing is increased."},{name:"Blinding Shot",description:"Blinds the target, impairing its movement and casting for a short duration."},{name:"Relentless Cry",description:"Intimidate your enemies, confusing them for a short duration and recovering a percentage of your missing health."},{name:"Shatterfrost",description:"Hurls a heavy fragment of frost at your target for massive amounts of damage. Deals extra damage to targets deep frozen by Ice Bolt."},{name:"Frostcall",description:"Channel a freezing storm over a targeted area, dealing damage to all targets in a radius."},{name:"Ice Block",description:"Summons a protective ice block, preventing all damage to you and recovering a percentage of your health over a short duration. You cannot move or cast any spells during this time."},{name:"Bone Shot",description:"Fire a heavy femur bone at your target for massive damage. Deals 50% extra damage to targets below 50% health."},{name:"Summon Runedisks",description:"-"},{name:"Runefire Blast",description:"-"},{name:"Obelisk Conjuration",description:"-"}],boot:[{name:"Sandals",description:"This footwear is primarily made for comfort rather than running."},{name:"Cloth Footpads",description:"These footpads are wrapped in a makeshift material to increase running stability."},{name:"Leather Shoes",description:"Leather shoes are created with fine craftsmanship for moderate battle durability."},{name:"Bone Brogans",description:"The monster bones used in the creation of footwear such as this seem to enhance movement speed, but whether the enhancement is through magic or the lightness of the material is not known."},{name:"Scaled Treads",description:"This footwear is carefully crafted with monster scales that are both light and robust for battle."},{name:"Shadow Shoes",description:"Enchanted shoes such as this push the wearer's feet with shadow magic to augment speed."},{name:"Wartorn Boots",description:"These boots are crafted from sturdy iron and have been used in many wars."},{name:"Imbued Treads",description:"Footwear such as this is etched with runes that increase the wearer's speed. However, scholars are hesitant about the use of these runes since their true purpose and nature is unclear."},{name:"Skyswift Boots",description:"Elvish magic is assisted by wind spirits to create Skyswift Boots. Although Elves are very close to nature, even they know little about the reclusive wind spirits."},{name:"Coldforged Greaves",description:"These boots are forged without heat and with enchanted hammers to keep the innate properties of the special metal. This rare metal is most often found in the mountains."},{name:"Cloudrunners",description:"These boots are created by monster craftsmen with the help of sky spirits. Some monster factions have a close connection with sky spirits and nature; however, monsters do not frequently talk about this relationship."},{name:"Talaria",description:"These boots are named after a famous relic legend. The namesake of these boots were supposedly the fast footwear of a famous deity, but no one seems to know where the story originates."},{name:"Starshards",description:"This footwear is composed of meteorite pieces. Black meteorites were found during a terrible catastrophe where fire rained down from the sky and destroyed much of the landscape."}],bow:[{name:"Driftwood Shortbow",description:"This bow is a makeshift creation. Wood is not a plentiful resource in some regions, so denizens sometimes use the materials on hand to create weapons such as this."},{name:"Novice Shortbow",description:"Bows such as these are crafted for beginning archers to hone their skills."},{name:"Curved Shortbow",description:"Curved shortbows are mostly produced for hunting local wildlife."},{name:"Adventurer's Shortbow",description:"This type of bow is a standard weapon of choice for adventurers."},{name:"Longbow",description:"Longbows are designed to be weapons of war."},{name:"Bone Bow",description:"This bow is crafted from monster bones to produce extra resilience and power."},{name:"Elven Bow",description:"Elvish craftsmen put exquisite care in their bows during the crafting process, and Elvish archers have a proud reputation during times of war for a reason."},{name:"Ancient Bow",description:"Ancient bows are exceptional weapons that were designed by forgotten master craftsmen. These bows are often passed from one generation to another."},{name:"Iron Piercer",description:"These bows were developed in response to armor-wearing monsters."},{name:"Silver Recurve",description:"This bow design is more mechanically efficient than the longbow. The unique pattern of decorative silver is a testament to the craftsmanship required to make such a fine bow."},{name:"Assassin's Bow",description:"Bows such as this were previously owned by assassins that made modifications to drastically increase efficiency. Assassins regularly modify their weapons to reach optimal performance."},{name:"Hellfire Warbow",description:"Bows such as this were made from hellfires that are provided by devilish creatures. These kinds of bows are rare because of the ultimate price required for such wicked transactions and acquisitions."},{name:"Skyfire Warbow",description:"This bow was bathed in the flames of a phoenix and cooled in the night sky. Bows created in this way are sometimes imbued with extra magical characteristics from phoenix fire."},{name:"Widowmaker",description:"Widowmakers are living bows that bond with the user. Powerful monsters use a mystic process to create widowmakers; the resulting weapon can be remarkably jealous and entice the user not to use any other weapon by destroying foes with vast depths of battle experience."},{name:"Stormsong",description:"These bows are rare due to the length and method of the forging process; bows must be greatly elevated to ensure that every lightning strike can be used to gradually forge this bow into a Stormsong. The creation process can take ages."},{name:"Scarebow",description:"This malevolent bow eats the dreams and nightmares of the wielder. This living bow offers no loyalty and demands sacrifices in the form of battle victims."},{name:"Fury",description:'When a great tragedy befalls an entire civilization, the spirits of enraged victims pour their anger into a weapon to wreak vengeance upon the world. This weapon is only known as "Fury."'}],armor:[{name:"Potato Sack",description:"This is a surprisingly sturdy material that can be used as a protective clothing. The makeshift nature of this material is obvious, so many adventurers choose to replace the potato sack as quickly as possible."},{name:"Faded Garment",description:"This garment is a family heirloom that has been passed down from one adventuring generation to another."},{name:"Adventurer's Tunic",description:"This tunic is crafted from robust fabrics that are designed to withstand wilderness survival. Some traditions involve giving tunics as gifts to adventurers that are deemed worthy by an organization."},{name:"Leather Jerkin",description:"This leather armor is a common choice for traveling adventurers. The trend of wearing leather jerkins originated around Yggdrasil when dangerous creatures began to lurk in the nearby jungles."},{name:"Scaled Chestguard",description:"This armor is made of monster scales that were found on the ground. Monster scales are often crafted into respectable armor whenever metal is in short supply."},{name:"Sky Mail",description:"Light Elvish metals are used to create divine chainmails. Old legends say that the first sky mails were originally created from discarded armor pieces once worn by divine creatures."},{name:"Shadow Cloak",description:"This cloak summons small shadows that envelop the wearer during battle to enhance protection. Cloaks such as these are crafted with strange shadow magic and then alchemically enhanced in secret ways."},{name:"Runic Halfplate",description:"Magic runes were etched into this armor to provide additional protection. Some scholars believe the runes on all runic halfplate armors are meant to interact together in some larger, undiscovered ritual."},{name:"Hellfire Fullplate",description:"Supernatural infernos were used in the making of this armor. Great sacrifices were made to appease the demands of devilish creatures so that a few blacksmiths could forge with the strange flames."},{name:"Soulkeeper",description:"Ancient legends say that each Soulkeeper armor harbors a soul that willingly sacrificed itself to enhance the armor’s protective power. In harder times, individuals made great sacrifices to ensure the survival of their clans and families."},{name:"Deathless",description:"Deathless armors were created by the first kings and leaders as a means to prevent mortal wounds during the First Great War. True to the legend, those kings and leaders did not perish in battle; instead, they were each assassinated in their sleep and their armors were stolen. The forging techniques were lost to time, but massive fortunes were clearly necessary for the process."}],glove:[{name:"Hand Wraps",description:"This cloth is commonly used to lightly protect the hands and reduce vibration."},{name:"Cloth Mitts",description:"Cloth mitts are made from the finest Elvish cloth."},{name:"Leather Gloves",description:"These gloves are crafted with tough and hardened leather."},{name:"Bone Grips",description:"Gloves such as this are made from monster bones. Monster bones provide extra resilience and, occasionally, residual magic."},{name:"Iron Gauntlets",description:"Iron gauntlets are made by master craftsmen that have spent decades working with metal."},{name:"Imbued Battlefists",description:"Mage guilds often create experimental gloves such as this to increase magic power against monster factions. Some experimental gloves are adorned with runes that were copied from ancient sources."},{name:"Wartorn Mitts",description:"This armor was battle-tested during the Third Great War. Although these mitts are old, armor of this quality was once necessary for survival."},{name:"Fiery Handguards",description:"These are experimental gloves created by fire mages that used techniques and methods taught by fire elementals."},{name:"Empowerment Gloves",description:"Monster kings paid for expensive enhancements to these gloves. These enhancements were meant to gain an advantage against certain monster factions in battles for territory."},{name:"Coldforged Fists",description:"This armor is forged without fire or heat in the hopes of retaining the magical properties of the special metal found in the mountains. Blacksmiths require enchanted hammers to forge gloves such as this."},{name:"Eternals",description:"An elder race of immortals wore this armor and established great empires. The race disappeared suddenly and mysteriously, but some of their armor was left behind."},{name:"Phrygians",description:"Phrygians were developed by a long-lost civilization destroyed by war. Most of the ruins of these lost cities contained fantastic treasures that have long since been plundered."},{name:"Titans",description:"Powerful armor such as this was necessary to slay titanic monster overlords that tried to take control of the realms after the initial formation of the Great Barrier. The Great Barrier was created to protect the realms from dark and forgotten enemies that rivaled the power of deities."}],hammer:[{name:"Splintered Club",description:"This is a makeshift weapon that is often created by farmers."},{name:"Wooden Mallet",description:"This is a mallet normally used for carpentry; however, wooden mallets are often used for combat out of necessity when resources and materials are scarce."},{name:"Primal Mace",description:"Primal maces are battle-tested and have legends heaped upon them; however, their effectiveness has diminished over time."},{name:"Orcish Bludgeon",description:"This is an orc's preferred tool for interrogations and battle."},{name:"Heavy Mace",description:"Heavy maces are made for war, infiltration, and charisma."},{name:"Iron Basher",description:"Iron bashers are typically made by expert craftsmen such as the monster Markay'ak. Craftsmen almost always leave their mark on the iron as a symbol of pride."},{name:"Darkmetal Maul",description:"These mauls are made with a special metal that has distinct colors and properties. The secrets of this darkmetal were stolen from monster craftsmen and popularized."},{name:"Divine Gavel",description:"These gavels are blessed by a church. Divine gavels sometimes acquire power through the devotion, achievement, and sacrifice of previous owners."},{name:"Hallowed Hammer",description:"Hammers such as this are often created by famous blacksmiths like Markay'ak with the help of religious monster priests. Hallowed hammers are sometimes endowed with sacred powers."},{name:"Dwarven Maul",description:"Dwarven mauls are robust and powerful enough to withstand Dwarven life in the mines and ground. Dwarven blacksmiths have vast experience in making hammers."},{name:"Coldforged Gavel",description:"These gavels are made from a special metal and forged without heat. The process of forging without heat allows innate properties of the special metal to remain."},{name:"Skullshatterer",description:"Skullshatterer hammers were originally created to combat the undead. The hammers that remain are often considered prized possessions by many clerics and sacred beings."},{name:"Amboss",description:"These hammers are known for breaking anvil heads during the process of forging. They are rarely created and typically fetch a substantial price."},{name:"Benevolence",description:"Spiritual masters often spread the message of their spirituality in a variety of ways. This hammer has the power to give the gift of peace to enemies — one way or another."},{name:"Hammer of Gaia",description:"These hammers were owned and used by titanic monster overlords after the initial formation of the Great Barrier. These titans wrecked the land and ruled the realms for a time."},{name:"Worldender",description:"According to historians, this hammer is said to have once caused an earthquake massive enough to topple a city."},{name:"Nightmare",description:"An ancient legend claims that a strange hammer fell through a Great Barrier fissure into the realms; hammers such as this are simply not of this world."}],misc:[{name:"Small HP Potion",description:"A potion flask containing a red liquid, healing you as you drink it."},{name:"Small MP Potion",description:"A potion flask containing a blue liquid, recovering mana as you drink it."},{name:"Medium HP Potion",description:"A potion flask containing a red liquid, healing you as you drink it."},{name:"Medium MP Potion",description:"A potion flask containing a blue liquid, recovering mana as you drink it."},{name:"Large HP Potion",description:"A potion flask containing a red liquid, healing you as you drink it."},{name:"Large MP Potion",description:"A potion flask containing a blue liquid, recovering mana as you drink it."}],orb:[{name:"Rat Skull",description:"This rat skull is a useful tool for beginning mages. Mages sometimes experiment on the bones of long-dead creatures to produce a focusing vessel."},{name:"Crystal Globe",description:"These globes are used for a variety of magical tasks. This is a classic device for magic users."},{name:"Seer's Stone",description:"The internal magic of these stones allow wise men to protect themselves during scrying and other seer activities."},{name:"Philosopher's Stone",description:"Rumors about immortality and transmutation inspired magic users to experiment and create stones such as this. These orbs became useful in augmenting magical power despite the experimental results falling short of the original intentions."},{name:"Cyclops's Eye",description:"This is a fantastic magical component that is easily enchanted. Handy items such as this often come with innate powers and can frequently be found in trade shipments between merchants."},{name:"Nüwa's Rondure",description:"This powerful magical object is often used to control the elements and inspire fear in the hearts of enemies. Nüwa, a legendary magic user from a monster faction, made many objects such as this."},{name:"Baetylus's Eye",description:"Objects like this were created from meteorites and misused as holy symbols. Although they are no longer used as holy symbols, Baetylus’s Eyes radiate substantial magical power."},{name:"Benben Stone",description:"Benben Stones were placed on top of the pyramids of an ancient, dead race. The stones absorbed thousands of years of solar energy, which was said to be a gift from a sun deity."},{name:"Silthrim",description:"Ancient snake stones such as this were found on forgotten altars inside ancient ruins. Scholars say that the stones were probably used in worshipping a snake deity, but the texts found in the ruins have not been successfully translated yet."},{name:"Lich's Phylactery",description:"A lich’s phylactery contains the soul of a powerful undead creature. Older phylacteries come with powerful enchantments to protect the wearer — and the soul contained within."}],quiver:[{name:"Linen Quiver",description:"This mass-produced quiver is made with Elvish linen for extra comfort."},{name:"Rustic Quiver",description:"Rustic Quivers are reliable and battle-tested. These quivers are often passed on to apprentice archers as they progress."},{name:"Snakeskin Quiver",description:"These quivers are made from snake scales from special monsters. Typically, snake skins are found after the giant snakes have shed their skin; to attempt a snakeskin collection otherwise would be a high risk."},{name:"Reinforced Exemplar",description:"The exquisite craftsmanship of Markay'ak resulted in the creation of Reinforced Exemplars. Quivers such as this are often a testament to the pride of any professional archer."},{name:"Lazarus's Revenge",description:"An immortal from an elder race created quivers with an inhuman power in order to manifest his revenge upon the world."},{name:"Dragonhide Cynosure",description:"This quiver is made of dragon scales found on the ground. Dragon scales are a very difficult crafting material, so only the best craftsmen can use them."},{name:"Lotharien",description:"Lothariens are quivers that are named after a people warred out of existence. The Lotharien people battled surrounding territories for power acquisition while using these quivers."},{name:"Treant's Gift",description:"This quiver is a gift from the forest as a means for nature spirits to reclaim their stolen power, territory, and respect."},{name:"Vodhrai",description:"The Vodhrai are the embodiment of vengeance, anger, wrath, and determination. The unusually strong emotions from this living quiver might serve to corrupt the user."},{name:"Pompeii",description:"This quiver was once found near the ruins of an entire civilization. There are no surviving records about the quiver in the region from this time period."}],ring:[{name:"Woven Band",description:"This strange band allows a small part of the wearer’s life essence to be stored."},{name:"Ironbark Loop",description:"This ring is made from a special wood that is as tough as iron. Ironbark is often used as an alternative to metal."},{name:"Brass Unity",description:"Two kingdoms that were joined by royal marriage had their armies wear these rings as a symbol of the newly allied nations."},{name:"Hollowed Bone",description:"This ring is made from the bones of a monster husk. Monster bone can be used as a sturdy material when no other resources are available."},{name:"Elven Heirloom",description:"Rings are often handed down from generation to generation in the Elvish tradition."},{name:"Imbued Union",description:"This ring has tiny runes carved into the inner band. Some historians believe these rings were the last effort of a lost kingdom to fortify its population from disease."},{name:"Arcane Ring",description:"Arcane rings are the magical experiments of intermediate mages. Some rings are crafted and enchanted to substantially enhance magic-casting abilities."},{name:"Emerald Band",description:"These rings once belonged to the “Cult of the Emerald Spiders,” a gang of bandits that were among the first to ride spiders."},{name:"Infernal Ring",description:"Infernal rings are gifts from devilish creatures. They entice the wearer to desire more power. This desire is often followed by ill-advised offers by more devils."},{name:"Ancient Signet",description:"Nature spirits originally gave these rings as gifts of appreciation to primal monsters. Many of these rings have been stolen or lost over thousands of years."},{name:"Reverence",description:"Many religious factions claim that individuals wearing this ring have the favor of a deity; however, the specific deity is not known. Many religious figureheads believe that the divine anonymity is intentional."},{name:"Gyges",description:"Ancient scrolls claim that these legendary rings make the wearer nearly invincible. The scrolls also mention stories of wearers becoming corrupt and profoundly unhappy."},{name:"Peacekeeper",description:"Once every age, a Peacekeeper is found and marks the wearer as a special protector of the realms. In a past age, the bearer of the Peacekeeper failed and the Third Great War began."}],rune:[{name:"Lucid",description:"This flat material is commonly found in mines; monsters often mine for Lucid to support their economies."},{name:"Melant",description:"The curves of Melant give the appearance of writing or symbols, but blacksmiths believe these natural formations reveal a powerful internal structure."},{name:"Turim",description:"This useful material originates from a great volcano and the surrounding region. Turim were once frequently traded between caravans."},{name:"Fundo",description:'This robust material was recently found to be useful for upgrades when blacksmiths began experimenting with "worthless Fundo." Since that time, Fundo have been considered a valuable resource.'},{name:"Amari",description:"Amari are often given as gifts from overseas kingdoms. Scholars say that Amari were first discovered when a race of sea creatures made first contact with several land kingdoms and brought Amari from the sea floor."},{name:"Purum",description:"Often mistaken for gold, this material was once thought to be the same material as dragon scales. Many ancient decorations and weapons are adorned with Purum."},{name:"Royal",description:"Royals are often owned and collected by kings and queens to be used as ceremonial gifts during arranged marriages."},{name:"Tara",description:"These formations naturally occur most often near Yggdrasil, the World Tree. The beauty and power rarity of Tara make them equally suited for either jewelry heirlooms or item upgrades."},{name:"Gloom",description:"Once the secret methods of enhancing equipment using the power of Gloom were discovered, those methods were shortly sold to an opposing kingdom as one of the biggest betrayals in the history of the realms."},{name:"Plurae",description:"Unusual crystalline properties in Plurae make it an exceptional material. Although Plurae were only recently rediscovered in the forgotten depths of the world, the applications of Plurae have already been substantial in turning the tides of war."},{name:"Aeter",description:"Although Aeter were once considered gifts from the gods by queens and kings of the past, written histories claim that Aeter were found inside black meteorites."}],shield:[{name:"Wooden Shield",description:"This is a makeshift shield that seems to have been produced out of necessity."},{name:"Buckler",description:"Bucklers can be useful protection against small and light weapons. Pirates often use bucklers for maneuverability."},{name:"Old Bulwark",description:"This is a shield type that is often made during war times. Although cheap, the shield is made of sturdy ironbark."},{name:"Metal Guard",description:"Kingdom sentries often use shields such as this to reduce received damage as well as protect citizens."},{name:"Darkmetal Shield",description:"This shield is made of darkmetal and anointed with a black oil. Adventurers with this kind of shield are certain to stand out from the rest."},{name:"Spiked Warshield",description:"Spiked Warshields are robust in battle and fitting for orcish culture. Veteran orc warriors display their victory notches on the sides of their shields."},{name:"Protecteron",description:"Paladins acquire this shield when they attain a certain level of spiritual devotion. However, these paladin shields are sometimes seen without their owners..."},{name:"Svalinn",description:"This type of shield is made by mortals with ice that is found only in the Underworld. Although the shield is powerful, the unusual properties and rarity of the Underworld Ice make mortal attempts at reconstructing these shields inadequate at best."},{name:"Ancile",description:"This sacred shield is wrapped in legend and rumors. One ancient scroll tells how the shield created false copies of the user to confuse opponents. Another scroll alternatively explains that the shield was modeled after the very shield wielded by a deity."},{name:"Aegis",description:"The divine paint on this shield is animated and can imbue a worthy user with fantastic powers. Some observers believe that the blinking eye allows the mysterious and divine painter to see the world."}],staff:[{name:"Broken Twig",description:"Sticks and broken twigs are used by apprentice mages for educational purposes."},{name:"Cracked Stick",description:"This is a damaged battlestaff that still has some use for beginning magic users."},{name:"Gnarled Broomstick",description:"Some of the oldest trees are used to create Gnarled Broomsticks. These weapons produce spells to sweep enemies off the battlefield."},{name:"Oak Staff",description:"This is a sturdy oak weapon for casting intermediate magic."},{name:"Mystic Wand",description:"This wand is a gift from the mystics that is embedded with strange shards that enhance magical power."},{name:"Bone Staff",description:"This is made from the bones of monster mages to augment magical power."},{name:"Encrusted Rod",description:"This rod is encrusted with gems that store magical power."},{name:"Imbued Staff",description:"The etched runes on this staff faintly glow when spells are cast. Although several mage guilds clearly believe that the runes augment spell casting, the true nature of the runes is unknown."},{name:"Emerald Staff",description:"This staff uses an enchanted stone to channel and focus magical energies. The process of finding such a special emerald, along with the expensive enchanting process, makes this staff somewhat difficult to craft."},{name:"Sapphire Staff",description:"This staff is made of Dragonwood and uses stones that were originally dragon gifts. The residual traces of draconic power contained in the stones compound magic's potency."},{name:"Frozen Greatstaff",description:"The Frozen Greatstaff is made by mortals with ice found only in the Underworld. Although the construction methods are flawed, the results can still be quite powerful."},{name:"Infernal Staff",description:"This staff is made of Underwood that underwent a magical tempering process using Underworld Flames. Although the staffs were undoubtedly crafted by mortal hands, the method to obtain Underworld Flames seems to be a secret lost to time."},{name:"Hellfire Greatstaff",description:"Hellfire Greatstaffs are constructed with hellfires provided by mischievous devils. Although the process to create a staff such as this is mysterious, the price exacted by the devils involved is not."},{name:"Divine Staff",description:"This kind of staff is modeled from ancient texts. Part of the crafting process requires hundreds of devout beings to request blessings upon the staff by specific deities."},{name:"Crystal Core",description:"This strange staff utilizes crystals from the Realm of Madness in order to enhance wild magics in nature. The crystals are the central component of this staff."},{name:"Witch's Heart",description:"The heart of an elder witch powers this staff's magic. Forbidden powers reanimated the beating heart, which causes the staff to symbolically embody a representation of the undead."},{name:"Deathweaver",description:"Deathweavers are relics that have survived the creation of the Great Barrier. These strange staffs are not of this world."}],sword:[{name:"Wooden Sword",description:"These swords are often made of ironbark to last longer than regular wood."},{name:"Rusty Ironsword",description:"Swords such as this have seen many battles and are typically handed down from a warrior to an apprentice."},{name:"Troll Blade",description:"This is a worthy weapon wielded by trolls and their tribes. Trolls often attack neighboring territories to either expand their own or force back invaders."},{name:"Broadsword",description:"The broadsword is a standard weapon among soldiers and warriors on the battlefield."},{name:"Longsword",description:"Longswords are primarily identified by their longer grip rather than the longer blade. Bladesmiths have used a variety of materials and levels of skill, producing a wide variety of results."},{name:"Gladius",description:"Designed for combat, this weapon performs to expectations inside the Colosseum."},{name:"Greatsword",description:"This massive sword is designed to increase damage potential specifically for war. An adventurer that wears or uses a weapon such as this leaves no doubt about their goals and profession."},{name:"Templar Greatsword",description:"These are weapons that once belonged to the knights of fallen kingdoms. Powerful kingdoms once existed before massive wars obliterated them from the landscape; the knights wielding these greatswords maintained their chivalrous duties long after their kingdoms turned to dust."},{name:"Ghastly Scimitar",description:"These swords are crafted by undead monsters. The unnatural crafting technique to produce weapons such as this remains unknown."},{name:"Nullfire Sword",description:"Nullfire Swords are made by mortals from ice that is only found in the Underworld. Originally, this kind of sword was made to combat devils and demons during the first Great War; however, Nullfire Swords were crafted by flawed processes and were therefore unable to repel the devils and demons completely."},{name:"King's Rapier",description:"In realms where warfare is constant, royalty often spend massive quantities of gold to create one of the best blades that money can buy for their personal use. Unfortunately, these pristine blades alone cannot stop invading armies from taking over a kingdom."},{name:"Void Blade",description:'These weapons were given to mortals by a secretive group of wraith monsters. These "gifts" were later discovered to be a means of manipulating mortal endeavors through magical corruption. Despite the apparent failure of this master plan, the powerful swords can still be found.'},{name:"Zerstörer",description:"Many scholars say these weapons were created to destroy an ancient and powerful race, but neither the creators nor their opponents remain."},{name:"Hearteater",description:"This weapon is literally a monster. These creatures bond with the user to increase combat exposure, which provides greater opportunities for the creatures to feed and sustain themselves."},{name:"Demonedge",description:"Demonedges were brought into the realms by the demons and devils that began the First Great War. These weapons are forged with hellfire and are not crafted by mortal hands."},{name:"Excalibur",description:"Some of the most divine warriors and dedicated paladins in history used a weapon such as this. Legends that are heaped upon the names of the wielders have historically inspired and motivated generations of fighters and kings."},{name:"Harbinger",description:"This weapon is almost always considered a bad omen and bringer of doom when it is found. Some scholars believe this weapon falls through barrier fissures and could only be made outside of the realms."}],mount:[{name:"Grubling",description:" "},{name:"Spider",description:" "},{name:"Leafspider",description:" "},{name:"Ruby Crawler",description:" "},{name:"Tick",description:" "},{name:"Shadowstrider",description:" "},{name:"Pebbles",description:" "},{name:"Ember Pebbles",description:" "},{name:"Ether Wyrm",description:" "},{name:"Shadow Wyrm",description:" "},{name:"Sand Scarab",description:" "},{name:"Golden Scarab",description:" "},{name:"Flaming Skullspider",description:" "},{name:"Blacksmith's Grub",description:" "},{name:"Snowball",description:" "}],totem:[{name:"Dream Feathers",description:"These feathers absorb the dreams and nightmares of those that sleep near it. The dreams and nightmares are stored and reused in the form of magic."},{name:"Voodoo Doll",description:"A supernatural creature bound to this doll fuels magical power available to the user."},{name:"Glowing Chicken",description:"This is a vessel that emanates magic originating from nature."},{name:"Divine Beads",description:"These beads were carried by holy priests as a means to store divine power and count their blessings. Some of the divine power still resides within each bead."},{name:"Templar's Resolve",description:"When defeated templars fail a divine task, they pour spiritual devotion into a personal totem such as this to aid the side of good."},{name:"Holy Cricket",description:"This is one of the many magical crickets that were once owned by the emperors and empresses of Tiger's Teeth. To ward against assassinations, magical crickets enhanced the supernatural power of the royalty that carried them."},{name:"Laughing Skulls",description:"This is a prison with supernatural creatures that are unwillingly bound together. They generate substantial magical power with their unnatural laughter."},{name:"Hive Mind",description:"A collective of supernatural minds that focus their magical power and bestow it upon the user of their totem. The Hive Mind believes that all creatures must submit to their power and tries to convince the user to join them."},{name:"Nganga's Serpent",description:"This is an avatar of a supernatural creature. Some scholars say that Nganga's Serpent is given to those that are chosen and deemed worthy for greatness; however, other scholars suggest that this is another means by which deities try to control and manipulate mortals."},{name:"Sangoma's Bones",description:"These ancient bones are said to be small fragments of a forgotten monster deity. The bones radiate power beyond imagination."}],box:[{name:"Mysterious Saddle Chest",description:"Shipped from the unexplored regions of Faivel. The contents of this cage cannot be inspected until opened."},{name:"Elixir",description:"A magical blue elixir potion which grants your account useful extra features."}],charm:[{name:"Little Bell",description:"Bells are often used as a symbol of devotion toward a chosen deity. The interior of this bell has an inlaid silver inscription, but the translation of the inscription has been lost to time."},{name:"Hardened Egg",description:"Fossilized monster eggs are often interpreted as symbols of longevity. However, no written records of these creatures exist beyond recent times."},{name:"Tattooed Skull",description:"Orc tribes often keep the skulls of worthy foes as a sign of respect. This skull is adorned with tattoos that symbolize the power the foe had during life."},{name:"Ship Pennant",description:"Flags flown from the tops of warships were called pennants. This ship pennant was among the wrecked warships that first traveled to Headless Landing."},{name:"Blue Marble",description:"Mages created alternative methods of mana acquisition during times of scarcity. This marble was created during the Arcane Crisis, a time when mana networks were under extreme stress."}],pet:[{name:"Greedy Grub",description:"A tiny grub that will loot items for you."},{name:"Greedy Goblin",description:"A tiny goblin that will loot items for you."}]},R={hammer:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:3,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:15,min:.05,max:.1}}},bow:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:2,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:10,min:.05,max:.1}}},staff:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:1,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:10,min:.05,max:.1}}},sword:{baselvl:0,slot:[101],tiers:17,drop:.4,weight:1,class:0,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:20,min:.05,max:.1}}},armlet:{baselvl:1,slot:[102],tiers:13,drop:1,weight:.3,stats:{6:{base:10,min:.5,max:.9},12:{base:7,min:.5,max:.8}}},armor:{baselvl:2,slot:[103],tiers:11,drop:1,weight:1,stats:{12:{base:10,min:1.4,max:2.8},6:{base:20,min:1,max:2}}},bag:{baselvl:5,slot:[104],tiers:5,drop:1,weight:.1,stats:{19:{base:1,min:.1,max:.3}}},boot:{baselvl:2,slot:[105],tiers:13,drop:1,weight:.4,stats:{6:{base:10,min:.6,max:1},12:{base:8,min:.6,max:1.1},15:{base:3,min:.03,max:.1}}},glove:{baselvl:2,slot:[106],tiers:13,drop:1,weight:.4,stats:{6:{base:10,min:.6,max:1},12:{base:8,min:.7,max:1.1},14:{base:1,min:.1,max:1.5}}},ring:{baselvl:5,slot:[107],tiers:12,drop:.8,weight:.2,stats:{6:{base:10,min:.5,max:.9},7:{base:5,min:.6,max:1}}},amulet:{baselvl:7,slot:[108],tiers:12,drop:.8,weight:.3,stats:{7:{base:10,min:1,max:1.8},9:{base:1,min:.2,max:.3}}},quiver:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:2,stats:{14:{base:5,min:.1,max:.9},9:{base:1,min:.1,max:.3}}},shield:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:0,stats:{12:{base:20,min:.8,max:1.4},13:{base:4,min:1,max:2.8}}},totem:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:3,stats:{12:{base:10,min:.4,max:.9},9:{base:1,min:.1,max:.4}}},orb:{baselvl:2,slot:[109],tiers:10,drop:.7,weight:.5,class:1,stats:{3:{base:10,min:.3,max:.7},9:{base:1,min:.1,max:.3}}},rune:{baselvl:1,tiers:11,drop:.8,quality:70},misc:{drop:8,weight:.1},book:{drop:.9,weight:.5},charm:{slot:[110,111],noupgrade:!0,undroppable:!0,drop:0,stackable:!1},mount:{noupgrade:!0,undroppable:!0,drop:0,stackable:!1},box:{noupgrade:!0,undroppable:!0,drop:0,stackable:!1},pet:{noupgrade:!0,undroppable:!0,drop:0,stackable:!1},gold:{drop:20}},O=(e,t)=>e[Math.floor(t*e.length)],K={6:4,7:3,8:5,9:4,10:1,11:1,12:5,13:5,14:5,15:.3,16:5,17:0,2:2,0:2,3:2,4:2,1:2,5:2,19:1,18:3},G={6:{min:.2,max:.8,round:!0},7:{min:.2,max:.5,round:!0},8:{min:.1,max:1},9:{min:.1,max:.5},10:{min:.03,max:.13,round:!0},11:{min:.1,max:.2,round:!0},12:{min:.1,max:.8,round:!0},13:{min:.1,max:.4},14:{min:.1,max:.5},16:{min:.1,max:.4},2:{min:.08,max:.45,round:!0},0:{min:.08,max:.45,round:!0},3:{min:.08,max:.45,round:!0},4:{min:.08,max:.45,round:!0},1:{min:.08,max:.45,round:!0},5:{min:.08,max:.45,round:!0},18:{min:.01,max:.15,round:!0}},H=Object.keys(G),_={medalValue:1e3,goldValue:5e4,buyElo:1600,quality:90,level:45,gs:30,uniqueEquipped:!0},j=[{id:0,custom:["Use: Removes all movement limiting effects."],useCd:60,incap:!0,animCast:45,use:(e,t,s,a)=>{}},{id:1,custom:["Use: Protects you against 30% of incoming damage for 10 seconds."],useCd:60,animCast:6,incap:!1,use:(e,t,s,a)=>{}},{id:2,custom:["Use: Increases your damage by 20% for 10 seconds."],useCd:80,incap:!1,animCast:6,use:(e,t,s,a)=>{}},{id:3,custom:["Use: Speeds up your movement by 45 for 8 seconds."],useCd:50,incap:!1,animCast:6,use:(e,t,s,a)=>{}},{id:4,custom:["Use: Attacks made against you grant 20 MP (up to 200) for 20 seconds."],useCd:60,incap:!1,animCast:6,use:(e,t,s,a)=>{}}],z=(e,t)=>R[e].baselvl+Math.floor(t/R[e].tiers*100),U=(e,t)=>{const s={level:e.level,type:e.type,tier:e.tier,stats:e.stats?new Map:void 0,class:e.class,quality:e.quality};e.stats&&Object.keys(e.stats).sort(((e,t)=>e-t)).forEach((t=>{const a=e.stats[t];s.stats.set(parseInt(t),{min:a.base+e.level*a.min,max:a.base+(e.level+10)*a.max})})),t[e.type+e.tier]=s},$=[1919,1920],W={};var V;(e=>{for(const t in R)if(R[t].tiers){const s=R[t];for(let a=0;a<s.tiers;++a)U({type:t,tier:a,stats:s.stats,level:z(t,a),class:s.class,quality:s.quality},e)}})(W),(e=>{const t=[250,100,500,200,1e3,300];for(let s=0;s<6;++s){const a=Math.floor(s/2),n=s%2==0;e["misc"+s]={type:"misc",tier:s,level:1+20*a,goldvalue:5**a,quality:15,custom:[t[s]+(n?" HP recovered":" MP recovered")],useSkill:100,use:(e,t,s,a)=>{}}}})(W),V=W,$.forEach(((e,t)=>{V["pet"+t]={level:10,unsellable:!0,storeValue:900,quality:90,bindOnUse:1,bindOnMerchant:1,type:"pet",tier:t,useSkill:104,use:(e,t,s,a,n)=>!0}})),(e=>{j.forEach(((t,s)=>{e["charm"+t.id]={..._,...t,type:"charm",tier:t.id,useSkill:107+s}}))})(W);class Y{constructor(e){this.dbid=e,this.stats=new Map,this.dirty=!0}hydrate(e){if(this.dirty=!1,this.bound=e.bound,this.type=e.type,this.tier=e.tier,this.logic=W[this.type+this.tier],this.auction=e.auction?new Date(e.auction):void 0,this.auctionprice=e.auctionprice,this.owner=e.name,this.stash=e.stash?new Date(e.stash):void 0,void 0===this.logic)throw"Unknown item "+e.type+e.tier;if(this.upgrade=e.upgrade,this.stats.clear(),e.rolls){if(this.setRolls(e.rolls),this.quality=this.nextRoll(),this.logic.stats){this.logic.stats.forEach(((e,t)=>{this.stats.set(t,{type:"base",qual:this.quality,value:Math.floor(e.min+(e.max-e.min)*(this.quality/100)**2+K[t]*this.upgrade)})}));const e=Math.min(4,Math.round((this.quality/100)**1.5*3.6));for(let t=0;t<e;++t){let e=this.nextRoll(),t=-1;for(;-1===t||this.stats.has(t);)t=parseInt(O(H,e/101)),e=(e+5)%100;const s=(this.nextRoll()+this.quality)/2;this.stats.set(t,{type:"bonus",qual:s,value:Math.ceil(Math.max((G[t].min+(G[t].max-G[t].min)*(s/100)**2)*this.logic.level*R[this.type].weight,K[t])+K[t]*this.upgrade)})}}this.quality=this.logic.quality||this.quality,this.stacks=void 0}else this.stacks=e.stacks,this.quality=this.logic.quality||0;this.gs=0,this.logic.gs?this.gs=this.logic.gs:this.stats.forEach(((e,t)=>{if(17===t)return;let s=e.value/K[t];"shield"==this.type&&"base"==e.type&&(s*=.5),"orb"==this.type&&"base"==e.type&&(s*=.7),this.gs+=s})),this.gs=Math.round(this.gs)}setRolls(e){this.rolls=e,this.currentRoll=0}nextRoll(){if(this.currentRoll==this.rolls.length)throw"roll maximum reached";return this.rolls[this.currentRoll++]}use(e){this.logic.use&&this.logic.use(e)}storeValue(){return this.logic.storeValue||0}medalValue(){return this.logic.medalValue||0}canEquip(e){return canEquip(e.level,e.skills.skillIdsActive,e.skills.skillIdsLearned,e.class,this.type,this.tier)}canEquipClass(e){return canEquipClass(e.class,this.type,this.tier)}equipReasons(e){const t=[];return this.logic.level&&t.push(["Lv. "+this.logic.level,!0]),t}canBeDropped(){return!R[this.type].undroppable&&!this.bound}canBeTraded(){return!this.bound}canBeSold(){return!this.logic.unsellable}getStashTime(){return this.dirty?0:void 0!==this.stash?this.stash.getTime():0}getEquipSlot(){return void 0!==R[this.type].slot?R[this.type].slot[0]:void 0}}const J=async(e,t=[],s=!1)=>{let n={ids:e},i=[];i=await a.request("hordes.item.get",n);const o=[];if(!i.fail)for(let e=0;e<i.length;e++){let s=new Y(i[e].id);void 0!==t[i[e].id]&&""!==t[i[e].id]&&(i[e].upgrade=t[i[e].id]),s.hydrate(i[e]);const{stats:a,quality:n,gs:r,upgrade:l,bound:c,type:d,tier:h,dbid:m}=s,p=s.logic.level;let u={};for(let[e,t]of a)u[oe[e]]=t,"Critical"!==oe[e]&&"Haste"!==oe[e]&&"Block"!==oe[e]?"MP Reg./5s"!==oe[e]&&"HP Reg./5s"!==oe[e]?"Item Find"!==oe[e]||(u[oe[e]].value+="%"):u[oe[e]].value/=10:(u[oe[e]].value/=10,u[oe[e]].value+="%");let g={stats:u,quality:n,gs:r,upgrade:l,bound:c,type:d,tier:h,id:m,level:p};o.push(g)}return o},X=e=>{try{let t=new Y(e.id);t.hydrate(e);const{stats:s,quality:a,gs:n,upgrade:i,bound:o,type:r,tier:l,dbid:c}=t,d=t.logic.level;let h={};for(let[e,t]of s)h[oe[e]]=t,"Critical"!==oe[e]&&"Haste"!==oe[e]&&"Block"!==oe[e]?"MP Reg./5s"!==oe[e]&&"HP Reg./5s"!==oe[e]?"Item Find"!==oe[e]||(h[oe[e]].value+="%"):h[oe[e]].value/=10:(h[oe[e]].value/=10,h[oe[e]].value+="%");return{stats:h,quality:a,gs:n,upgrade:i,bound:o,type:r,tier:l,id:c,level:d}}catch{return null}},Q={common:"grey",uncommon:"green",rare:"blue",epic:"purp",legendary:"orange",mythical:"red"},Z=e=>e<=50?"common":e<=69?"uncommon":e<=89?"rare":e<=98?"epic":e<=109?"legendary":"mythical",ee=e=>{let t=Z(e);return Q[t]};function te(e){try{const t=e.querySelectorAll(".pack.svelte-e3ao5j:nth-child(2) > div"),s=e.querySelector(".slottitle").textContent.trim(),a=e.querySelector(".type").textContent.trim().split(" ")[2].toLowerCase(),n=s.match(/\+(\d+)/),i=n?parseInt(n[1],10):0,o=e.querySelector(".type").textContent.trim().split(" ")[1].toLowerCase(),r=parseInt(e.querySelector(".textgreen").textContent.match(/\d+/)[0],10),l=parseInt(e.querySelector(".textgrey").textContent.match(/\d+/)[0],10),c=parseInt(e.querySelector(".textgreen").textContent.match(/\d+/)[0],10),d={};let h=!1;if(t.forEach((e=>{const t=e.textContent.trim();let s,a;t.includes("+")&&(h=!0);const n=t.split(" ");t.includes("-")?(s=n[0]+" "+n[2],a=n.splice(3).join(" ")):t.includes("+")?(s=n[1],a=n.splice(2).join(" ")):(s=n[0],a=n.splice(1).join(" "));const i=h?"bonus":"base";h&&(s=s.replace("+","").trim()),s.includes("%")&&(s=s.split("%")[0].trim()),d[a]={type:i,qual:0,value:s}})),d.Damage){const e=d.Damage.value.split(" ")[0],t=d.Damage.value.split(" ")[1];d["Min Dmg."]={type:d.Damage.type,qual:0,value:e},d["Max Dmg."]={type:d.Damage.type,qual:0,value:t},delete d.Damage}e.querySelector(".pack.description.svelte-e3ao5j").textContent.trim();return{stats:d,quality:a,gs:r,upgrade:i,bound:2,type:o,tier:4,id:l,level:c}}catch(e){return{}}}function se(e,t,s){if(e){const a=p.mainContainer.element;let n=document.querySelector(".slotsContainerKEK");n||(n=document.createElement("div"),n.classList.add("slotsContainerKEK"),n.style.position="absolute",n.style.display="grid",n.style.gridTemplateColumns="repeat(3, auto)",n.style.top="100px",n.style.left="100px",t&&(n.style.left=t+"px"),s&&(n.style.top=s+"px"),a.appendChild(n));const i=document.createElement("div");i.className="window panel-black",i.style.padding="1px";const o=document.createElement("div");o.className="slot";const r=document.createElement("div");r.style.width="220px",r.style.height="270px",r.className="border panel-black "+ee(e.quality),o.appendChild(r),i.appendChild(o);const l=document.createElement("div");l.className="container",l.style.padding="10px",r.appendChild(l);const c=document.createElement("div");c.className="pack",l.appendChild(c);const d=document.createElement("div");d.className="slottitle text"+ee(e.quality),d.textContent="T"+(parseInt(e.tier)+parseInt(1))+" "+F[e.type][e.tier].name;const h=document.createElement("span");h.className="textprimary",0!=e.upgrade&&e.upgrade&&(h.textContent=" +"+e.upgrade,d.appendChild(h)),c.appendChild(d);const m=document.createElement("div");m.className="type textwhite capitalize",m.textContent=Z(e.quality)+" "+e.type;const u=document.createElement("span");u.textContent=" "+e.quality+"%",m.appendChild(u),c.appendChild(m);const g=document.createElement("small"),f=document.createElement("span");f.className="textgreen",f.textContent="GS: "+e.gs+" ";const y=document.createElement("span");if(y.className="textgrey",y.textContent="ID: "+e.id,f.appendChild(y),2==e.bound){const e=document.createElement("span");e.className="textgreen",e.textContent=" CB",f.appendChild(e)}g.appendChild(f),c.appendChild(g);const b=document.createElement("div");b.className="pack",l.appendChild(b);const v={base:[],bonus:[]},x=e.stats;for(let e in x){const t=x[e],s=document.createElement("div");s.className="text"+ee(t.qual),s.textContent=t.value+" "+e,"base"===t.type?v.base.push(s):"bonus"===t.type&&(s.textContent="+ "+s.textContent+" "+t.qual+"%",v.bonus.push(s))}for(let e in v){let t=v[e];for(let e of t)b.appendChild(e)}const k=document.createElement("div");k.className="pack",l.appendChild(k);const w=document.createElement("div");return w.className="textgreen",w.textContent="Requires Lv. "+e.level,k.appendChild(w),n.appendChild(i),n.style.zIndex="10",n}}function ae(e){let t=null;for(let s of e)t=se(s);return t}function ne(e,t){if(e.type!==t.type)return-1;const s={HP:0,"HP Reg./5s":0,MP:0,"MP Reg./5s":0,Defense:0,Block:0,"Min Dmg":0,"Max Dmg":0,"Atk Spd":0,Critical:0,Haste:0,"Move Spd":0,"Bag Slots":0,"Item Find":0,"Gear Score":0,Strength:0,Stamina:0,Dexterity:0,Intelligence:0,Wisdom:0,Luck:0,"Move Spd":0,quality:110,type:e.type},a={Strength:{HP:2,"HP Reg./5s":.03},Stamina:{Defense:1,HP:4},Dexterity:{Critical:.05},Intelligence:{MP:.8,Critical:.04},Wisdom:{MP:.8,Haste:.03},Luck:{Critical:.02,"Item Find":.5}},n=y(document.querySelector("#ufplayer").querySelector("img").src),i={0:"Strength",1:"Intelligence",2:"Dexterity",3:"Wisdom"}[n];let o={0:{"Min Dmg":.3,"Max Dmg":.3,"HP Reg./5s":.3},1:{"Min Dmg":.4,"Max Dmg":.4},2:{"Min Dmg":.4,"Max Dmg":.4},3:{"Min Dmg":.4,"Max Dmg":.4}}[n];for(let e in o)a[i][e]?a[i][e]+=o[e]:a[i][e]=o[e];e=function(e){if(e.isNegative)return e;let t=e.stats;for(let e in t){let s=t[e].value;"Haste"===e||"Critical"===e||"Item Find"===e||"Block"===e?(s=Number(t[e].value.split("%")[0]),t[e].value=-1*s+"%"):t[e].value=-1*s}return e.gs=-1*e.gs,e.isNegative=!0,e}(e);for(let a of[e,t]){let e=a.stats;for(let t in e){let a=e[t].value;"Haste"!==t&&"Critical"!==t&&"Item Find"!==t&&"Block"!==t||(a=Number(e[t].value.split("%")[0])),s[t]?s[t]+=a:s[t]=a}s["Gear Score"]+=a.gs}for(let e in a){const t=a[e];for(let a in t)s[a]+=t[a]*s[e]}const r=ae([e,t]);return function(e){if(e){const t=document.querySelector(".layout");let s=document.querySelector(".slotsContainerKEK");s||(s=document.createElement("div"),s.classList.add("slotsContainerKEK"),s.classList.add("l-ui"),s.style.position="absolute",s.style.display="flex",s.style.top="130px",s.style.left="120px",t.appendChild(s));const a=document.createElement("div");a.className="slot",a.style.width="230px",a.style.height="290px";const n=document.createElement("div");n.className="wrapper",a.appendChild(n);const i=document.createElement("div");i.className="new_script_internal",n.appendChild(i);const o=document.createElement("div");o.className="slotdescription svelte-18ojcpo border "+ee(e.quality),o.style.width="210px",o.style.opacity="1",o.style.transition="opacity 1s ease-out",o.style.height="270px",i.appendChild(o);const r=document.createElement("div");r.className="container svelte-e3ao5j",r.style.padding="1vh",o.appendChild(r);const l=document.createElement("div");l.className="pack svelte-e3ao5j",r.appendChild(l);const c=document.createElement("div");c.className="slottitle svelte-e3ao5j text"+ee(e.quality),c.textContent="Stat Compare",l.appendChild(c);const d=document.createElement("div");d.className="type svelte-e3ao5j textwhite",d.textContent=e.type,l.appendChild(d);const h=document.createElement("div");h.className="pack svelte-e3ao5j",r.appendChild(h);const m={positive:[],negative:[]},p=["quality","type","Strength","Stamina","Dexterity","Intelligence","Wisdom","Luck"];for(let t in e){if(p.includes(t))continue;let s=e[t];s=s.toFixed(2);const a=document.createElement("div");a.className="svelte-e3ao5j ",s>0?(a.textContent=s+" "+t,a.className+="textgreen",a.textContent="+ "+a.textContent,m.positive.push(a)):s<0&&(s*=-1,a.textContent=s+" "+t,a.className+="textred",a.textContent="- "+a.textContent,m.negative.push(a))}for(let e in m){let t=m[e];for(let e of t)h.appendChild(e)}const u=document.createElement("div");u.className="pack svelte-e3ao5j",r.appendChild(u),s.appendChild(a),o.style.pointerEvents="auto",o.style.zIndex="20"}}(s),r}const ie=e=>{let t=!1;const s=/(\d{8,})[a-zA-z' \n]*\s*(\+\d{1,2})?/g,a=[],n={};for(let i of e.matchAll(s)){t=!0;const e=i[1];let s;a.push(e),s=void 0===i[2]?i[2]:i[2].split("+")[1],n[e]=s}return{ids:a,itemUpgradeTable:n,isMatch:t}},oe=["Strength","Stamina","Dexterity","Intelligence","Wisdom","Luck","HP","MP","HP Reg./5s","MP Reg./5s","Min Dmg","Max Dmg","Defense","Block","Critical","Move Spd","Haste","Atk Spd","Item Find","Bag Slots","Fame","Rating","Stat Points","Skill Points","Skill Points (Max)","Gear Score","PvP Level","% Increased Dmg.","% Increased Aggro Generation","% Movement Spd. Reduction","Healing Reduction"],re={name:"Item Sharing",_generatedSlotContainer:null,currentArticle:null,start(){o.on("ui.chatArticle",this.handleChatArticle,this),o.on("ui.chatPanel",this.handleChat,this),o.on("ui.itemParent",this.hideItemWindow,this),document.addEventListener("click",this.documentHandler.bind(this))},stop(){o.off("ui.chatArticle",this.handleChatArticle,this),o.off("ui.chatPanel",this.handleChat,this),o.off("ui.itemParent",this.hideItemWindow,this)},documentHandler(e){e.target.classList.contains("svgicon")?e.stopPropagation():(this._generatedSlotContainer&&(this._generatedSlotContainer.remove(),this._generatedSlotContainer=null,this.currentArticle=null,document.removeEventListener("click",this.documentHandler.bind(this))),p.mainContainer.element.contains(p.itemParent.element)&&p.itemParent.element.children[0].children[0].lastChild.click())},linkHandle(e){const t=e.target;if("span"==t.tagName.toLowerCase()&&(t.classList.contains("chatItem")||t.classList.contains("textpurp-l")||t.classList.contains("textprimary"))){if(e.stopPropagation(),e.preventDefault(),this.currentArticle||(this.currentArticle=t.closest("article")),null!=this._generatedSlotContainer){if(this._generatedSlotContainer.remove(),this._generatedSlotContainer=null,this.currentArticle==t.closest("article")){this.currentArticle=null;const e=p.itemParent.element;return void(e&&e.children[0].children[0].lastChild.click())}this.currentArticle=t.closest("article")}let s=null;s=t.classList.contains("chatItem")?t.parentNode:t.parentNode.parentNode;const a=s.children,n=[];for(let e of a)n.push(e.item);const i=(e=>{const t=[];for(let s of e){const e=X(s);e&&t.push(e)}return t})(n);if(this._generatedSlotContainer=ae(i),p.itemParent.element&&this._generatedSlotContainer){p.itemParent.element.children[0].children[0].lastChild.click()}}},handleChat(e){e=e.element,Array.from(e.children).forEach((e=>{this.handleChatArticle({element:e})})),e.addEventListener("click",this.linkHandle.bind(this))},handleChatArticle(e){const t=(e=e.element).querySelector(".content");if(t){const e=t.nextElementSibling;if(e){const t=e.textContent.includes("!"),s=(e=>{let t=!1;const s=/(\d{8,})[a-zA-z' \n]*\s*(\+\d{1,2})?/g,a=[],n={};for(let i of e.matchAll(s)){t=!0;const e=i[1];let s;a.push(e),s=void 0===i[2]?i[2]:i[2].split("+")[1],n[e]=s}return{ids:a,itemUpgradeTable:n,isMatch:t}})(e.textContent);if(t&&s.isMatch){e.style.color="white",e.style.pointerEvents="all",e.style.cursor="pointer";let t=s.ids;const a=s.itemUpgradeTable;e.addEventListener("click",(async()=>{const e=await J(t,a),s=document.querySelector(".slotsContainerKEK");s&&(s.remove(),this._generatedSlotContainer=null),2===e.length&&(this._generatedSlotContainer=ne(e[0],e[1]))}))}}}},hideItemWindow(e){}},le={name:"Stat Simulation",state:{statSimulatorOpened:"0",currentItemsInfo:{}},start(){this.state.currentItemsInfo=this.getCurrentItemsInfo(),o.on("ui.characterParent",this.handleStatSimulation,this)},stop(){o.off("ui.characterParent",this.handleStatSimulation,this)},async fetchRank(e,t){try{return(await a.request("kek.tierlist.rank",{classid:t,build_score:e})).rank}catch(e){return console.error("Error fetching rank:",e.message),""}},async getStats(e,t,s){const a=t.pclass,n=[4e3,8e3,12e3,16e3,2e4,24e3,28e3,32e3,36e3,4e4,44e3,48e3];t.prestige=n[n.length-1];const i=e=>(e=String(e).split("."))[1]?e[1]/10**(e[1].length-1)<=5?Math.floor(Number(e.join("."))):Math.ceil(Number(e.join("."))):Number(e.join("."));let o={};o=1==s?{HP:100+8*t.level,"HP Reg./5s":2,MP:100,"MP Reg./5s":3,Defense:15,Block:0,"Min Dmg":0,"Max Dmg":0,"Atk Spd":10,Critical:5,Haste:0,"Move Spd":15,"Bag Slots":0,"Item Find":.5,"Gear Score":0,Strength:10,Stamina:12,Dexterity:10,Intelligence:10,Wisdom:10,Luck:5,"Move Spd":105}:{HP:0,"HP Reg./5s":0,MP:0,"MP Reg./5s":0,Defense:0,Block:0,"Min Dmg":0,"Max Dmg":0,"Atk Spd":0,Critical:0,Haste:0,"Move Spd":0,"Bag Slots":0,"Item Find":0,"Gear Score":0,Strength:0,Stamina:0,Dexterity:0,Intelligence:0,Wisdom:0,Luck:0,"Move Spd":0};const r={Strength:{HP:2,"HP Reg./5s":.03},Stamina:{Defense:1,HP:4},Dexterity:{Critical:.05},Intelligence:{MP:.8,Critical:.04},Wisdom:{MP:.8,Haste:.03},Luck:{Critical:.02,"Item Find":.5}};let l={0:"Strength",1:"Intelligence",2:"Dexterity",3:"Wisdom"}[a];1==s&&(o[l]+=1*t.level,o.Stamina+=2*(t.level-1),o[l]+=3*t.level);const c={0:{"Min Dmg":.3,"Max Dmg":.3,"HP Reg./5s":.3},1:{"Min Dmg":.4,"Max Dmg":.4},2:{"Min Dmg":.4,"Max Dmg":.4},3:{"Min Dmg":.4,"Max Dmg":.4}}[a];for(let C in c)r[l][C]?r[l][C]+=c[C]:r[l][C]=c[C];for(let S of e){let T=S.stats;for(let E in T){let L=T[E].value;"Haste"!==E&&"Critical"!==E&&"Item Find"!==E&&"Block"!==E||(L=parseFloat(T[E].value.split("%")[0])),o[E]?o[E]+=L:o[E]=L}o["Gear Score"]+=S.gs}if(1==s){const P={1:{"Move Spd":5},2:{MP:50},3:{"Item Find":15},4:{"Min Dmg":5,"Max Dmg":5},5:{"MP Reg./5s":2,"HP Reg./5s":2},6:{"Mov Spd":5},7:{HP:30},8:{"Item Find":15},9:{Critical:5},10:{Haste:3},11:{HP:30},12:{"Min Dmg":5,"Max Dmg":5}};function I(e){for(let t=0;t<n.length;t++)if(e<n[t])return t;return n.length}let M=I(t.prestige);for(let B=1;B<=M;B++){let A=P[B];for(let N in A)o[N]?o[N]+=A[N]:o[N]=A[N]}}for(let D in r){const q=r[D];for(let F in q)o[F]+=q[F]*o[D]}for(let R in o)if(String(o[R]).split(".")[1]){String(o[R]).split(".")[1].length>3&&(o[R]=parseFloat(o[R].toFixed(2)))}const d={hammer:"weapon",bow:"weapon",staff:"weapon",sword:"weapon",armlet:"armlet",armor:"armor",bag:"bag",boot:"boot",glove:"glove",ring:"ring",amulet:"amulet",quiver:"offhand",shield:"offhand",totem:"offhand",orb:"offhand"},h={};for(let O of e){let K=O.quality,G=O.type;O.tier;let H=O.upgrade;const _={type:d[G],quality:K,id:O.id,upgrade:H,item:O};d[G]&&(h[d[G]]=_),o["Max Dmg"]=i(o["Max Dmg"]),o["Min Dmg"]=i(o["Min Dmg"]),o["Item Find"]=Math.round(o["Item Find"]),o.Critical=Math.round(10*o.Critical)/10,o.Haste=Math.round(10*o.Haste)/10}let m=o["Min Dmg"],p=o["Max Dmg"],u=o.Critical,g=o.Haste,f=o.HP,y=o.Defense,b=o.Block,v=Math.round(f/((1-.87*(1-Math.exp(.0022*-y)))*(1-b/100*.45))),x=Math.round((m-Math.max(0,m-p)+p)/2*(1+u/100)*(1+g/100)),k=Math.round((m-Math.max(0,m-p)+p)/2*(1+u/100));1==a&&(k=Math.round((m-Math.max(0,m-p)+p)/2*(.8*(1+u/100)+.3*(1+g/100)))),0==a&&(v=Math.round(f/((1-.87*(1-Math.exp(.0022*-y)))*(1-b/100*.6)))),o.eHP=v,o.eDps=x,o.eBurst=k;for(let j in o)o[j.toLowerCase()]=o[j],delete o[j];let w=this.getBuildScore(o,a);return o["build score"]=w,{stats:o,itemsInfo:h}},calculateDmgReduction:(e,t)=>.87*(1-Math.exp(.0022*-e))+t/100*.6,calculateHPValue:(e,t)=>1/(1-(1-(1-.87*(1-Math.exp(-.0022*e)))*(1-t/100*.45))),calculateDpsScore:(e,t,s,a)=>0==a?(Math.log2(e)+Math.log2(t)+Math.log(s)/Math.log(5))/3:1==a?Math.log((t+e)/2)/Math.log(2):2==a?(Math.log(e)/Math.log(2)+Math.log(t)/Math.log(2))/2:3==a?(Math.log2(e)+Math.log2(t)+Math.log10(s))/3:void 0,calculateTankScore(e,t,s,a,n,i,o){const r=this.calculateHPValue(n,i),l=this.calculateDmgReduction(n,i);return 0==o?(Math.log2(s)+Math.log2(100*l)+Math.log(a)/Math.log(6))/3:1==o||2==o?(Math.log(s)/Math.log(2.5)+Math.log(t)/Math.log(6)+Math.log(e)/Math.log(6))/3:3==o?(Math.log10(e)+Math.log(t)/Math.log(11)+Math.log2(s)+Math.log(60*r)/Math.log(7)+Math.log(8*a)/Math.log(16))/5:void 0},calculateHybridScore(e,t,s,a,n,i,o){const r=this.calculateHPValue(n,i),l=this.calculateDmgReduction(n,i);return 0==o?(Math.log(e)/Math.log(4)+Math.log(t)/Math.log(5)+Math.log(s)/Math.log(5)+Math.log(100*l)/Math.log(5))/4:1==o||2==o?(Math.log(s)/Math.log(5)+Math.log(t)/Math.log(5)+Math.log(e)/Math.log(4))/3:3==o?(Math.log(e)/Math.log(3)+Math.log(t)/Math.log(4)+Math.log(s)/Math.log(6)+Math.log(50*r)/Math.log(9)+Math.log(8*a)/Math.log(10))/5:void 0},getBuildScore(e,t){const s=e.ehp,a=e.edps,n=e.eburst,i=e.defense,o=e.block,r=e.haste,l=this.calculateDpsScore(a,n,s,t),c=this.calculateTankScore(a,n,s,r,i,o,t),d=this.calculateHybridScore(a,n,s,r,i,o,t);let h=0;return 0==t&&(h=210*(l+c/3+d)/3),1==t&&(h=225*(l/3+c+d)/3),2==t&&(h=226*(l/3+c+d)/3),3==t&&(h=235*(l/1.75+c+d)/3),parseFloat(h.toFixed(3))},createStatElement(e,t,s,a){const n=document.createElement("span");n.textContent=t,n.classList.add(a),e.appendChild(n);const i=document.createElement("span");if(i.className="statnumber",i.textContent=s,a){i.classList.add("textpurp");const t=document.createElement("span");t.appendChild(i),t.classList.add(a),e.appendChild(t)}else i.classList.add("textgold"),e.appendChild(i);return[n,i]},handleSimulationUI(e,t){if(e){const a=document.querySelector(".statSimulationKEK");if(a)return void a.remove();e.style.display="flex";const n=document.createElement("div");n.classList.add("window","panel-black","statSimulationKEK");const i=document.createElement("div");i.classList.add("titleframe"),i.style.margin="10px";const o=document.createElement("div");o.classList.add("textprimary","title"),o.textContent="Stat Simulation",i.appendChild(o),n.appendChild(i);const r=document.createElement("div");r.classList.add("slot","panel-black"),r.style.display="grid",r.style.gridTemplateColumns="repeat(2, auto)";const l=["Weapon","Armlet","Armor","Bag","Boot","Glove","Ring","Amulet","Offhand"],c=document.createElement("textarea");(s=c).style.overflow="hidden",s.classList.add("auxi-sim-input"),s.placeholder="Auxi",s.style.height="40px",s.style.width="94%",s.style.marginLeft="8px",s.addEventListener("wheel",(e=>{s.scrollTop+=e.deltaY})),s.addEventListener("input",(function(e){const t=e.target.value.split("\n").length;s.style.height=20*t+20+"px"})),n.appendChild(c),l.forEach((e=>{let t;t=document.createElement("input"),t.setAttribute("type","text"),t.setAttribute("placeholder",e),t.classList.add("stat-sim-input"),t.style.width="120px",t.style.margin="3px",t.classList.add(`${e.toLowerCase()}KEK`);const s=document.createElement("div");s.style.position="relative",s.style.display="inline-block";const a=document.createElement("div");if(a.classList.add("btn","black","textsecondary","stat-sim-overlay"),a.textContent=t.placeholder,a.style.position="absolute",a.style.top="0",a.style.left="0",a.style.pointerEvents="none",a.style.width="120px",a.style.boxSizing="border-box",a.style.padding="5px 8px",a.style.margin="3px",t.addEventListener("input",(function(t){if("Auxi"!==e){const e=t.target.value.replace(/[^0-9+]/g,"");t.target.value=e}})),t.addEventListener("mouseenter",(()=>{if(a.style.opacity="0",this.state.currentItemsInfo.hasOwnProperty(e.toLowerCase())){const s=t.getBoundingClientRect(),a=s.left+120,n=s.top,i=document.querySelector(".slotsContainerKEK");i&&i.remove();const o=se(this.state.currentItemsInfo[e.toLowerCase()].item,a,n).querySelector(".copyitemBtnKEK");o&&o.remove()}})),t.addEventListener("mouseleave",(()=>{a.style.opacity="1";const e=document.querySelector(".slotsContainerKEK");e&&e.remove()})),s.appendChild(t),s.appendChild(a),e=e.toLowerCase(),this.state.currentItemsInfo.hasOwnProperty(e)){const s=this.state.currentItemsInfo[e];t.value=s.id+`+${s.upgrade||0}`;const a=t.nextElementSibling;a&&a.classList.add("text"+ee(s.quality))}r.appendChild(s)}));const d=document.createElement("button");d.textContent="Simulate",d.classList.add("btn","black","textsecondary","stat-sim-btn","border"),d.style.padding="5px",d.style.fontSize="90%",d.style.flex=1;const h=document.createElement("div");h.style.padding="5px",h.style.margin="2px",h.style.display="flex",d.addEventListener("click",(async()=>{d.classList.add("disabled");const s=document.querySelector(".stats2");if(!s)return;const a=document.querySelector(".auxi-sim-input"),i=document.querySelector(".ignoreCurrentGearKEK");let o=1,c=!1;i&&(o=i.value||1);const h=this.getStatsUI(s);let m={};if(a){if(""!==a.value){const e=ie(a.value),s=e.ids,n=e.itemUpgradeTable,i=await J(s,n),{stats:c,itemsInfo:d}=await this.getStats(i,t,o);m=c,this.state.currentItemsInfo=d,l.map((e=>{e=e.toLowerCase();const t=r.querySelector(`.${e.toLowerCase()}KEK`);if(d.hasOwnProperty(e)){const s=d[e];t.value=s.id+`+${s.upgrade||0}`;const a=t.nextElementSibling;a&&(a.className="btn black textsecondary stat-sim-overlay",a.classList.add("text"+ee(s.quality)))}else{t.value="";const e=t.nextElementSibling;e&&(e.className="btn black textsecondary overlay")}})),a.value="",a.style.height="40px",a.style.width="94%"}else{const e=n.querySelectorAll(".stat-sim-input");let s=!0;for(let t of e)if(""!==t.value){s=!1;break}if(s){let e="";const t=document.querySelector("#equipslots").children;for(let e of t)e.dispatchEvent(new PointerEvent("pointerenter"));setTimeout((()=>{const s=[];for(let e of t){const t=te(e.querySelector(".slotdescription"));"charm"!==t.type&&s.push(t),e.dispatchEvent(new PointerEvent("pointerleave"))}for(let t of s)e+=`${t.type} ${t.quality}% ${t.id} +7\n`;a.value=e,a.dispatchEvent(new InputEvent("input",{bubbles:!0}))}),100),c=!0,d.classList.remove("disabled")}else{const e=l.map((e=>{const t=r.querySelector(`.${e.toLowerCase()}KEK`);return t?t.value:""})),s=e.join("\n").trim(),a=ie(s),n=a.ids,i=a.itemUpgradeTable,c=await J(n,i),{stats:d,itemsInfo:h}=await this.getStats(c,t,o);m=d,this.state.currentItemsInfo=h,l.map((e=>{e=e.toLowerCase();const t=r.querySelector(`.${e.toLowerCase()}KEK`);if(h.hasOwnProperty(e)){const s=h[e];t.value=s.id+`+${s.upgrade||0}`;const a=t.nextElementSibling;a&&(a.className="btn black textsecondary overlay",a.classList.add("text"+ee(s.quality)))}else{t.value="";const e=t.nextElementSibling;e&&(e.className="btn black textsecondary overlay")}}))}}if(c)return;let i={};const p=document.querySelector(".ignoreCurrentGearKEK");p&&(o=p.value||1),m["gear score"]+=60,i=1==o?m:this.addStats(h,m),this.setStatsUI(s,i),d.classList.remove("disabled");const u=t.pclass,g=i["build score"],f=e.querySelector(".statcol");if(f){const e=f.querySelectorAll(".rankStatKEK");for(let t of e)t.remove();const t=await this.fetchRank(g,u);this.createStatElement(f,"Rank",t,"rankStatKEK")}}}));const m=document.createElement("button");m.classList.add("btn","textsecondary","ignoreCurrentGearKEK","black"),m.textContent="Ignoring Current Gear",m.style.padding="5px",m.style.fontSize="90%",m.style.flex=2,m.addEventListener("click",(()=>{const e=m.classList.contains("black");m.textContent=e?"Ignore Current Gear?":"Ignoring Current Gear",m.classList.toggle("black",!e),m.classList.toggle("grey",e),m.value=e?0:1}));const p=document.createElement("div");p.classList.add("btn","black","textsecondary"),p.textContent="Clear",p.style.marginLeft="10px",p.style.marginRight="10px",p.style.textAlign="center",p.addEventListener("click",(()=>{this.state.currentItemsInfo={};const e=document.querySelectorAll(".stat-sim-input");for(let t of e)t.value="";const t=document.querySelectorAll(".stat-sim-overlay");for(let e of t)e.className="btn black textsecondary stat-sim-overlay"})),h.appendChild(d),h.appendChild(m),n.appendChild(r),n.appendChild(h),n.appendChild(p),e.appendChild(n)}var s},getStatsUI(e){if(e){const t=e.querySelectorAll(".statcol"),s={},a=e=>e.includes("%")?parseFloat(e.split("%")[0].trim()):parseFloat(e.trim()),n=e=>e.replace(/\.$/,"");return t.forEach((e=>{const t=e.querySelectorAll("span");for(let e=0;e<t.length;e+=2){let i=t[e].textContent.trim();i=n(i);const o=a(t[e+1].textContent);s[i.toLowerCase()]=o}})),s}return{}},handleStatSimulation(e){if(e=e.element){const t=e.querySelector(".statcol");let s=0;if(t){const e=t.querySelectorAll("span");e.forEach(((t,a)=>{if("class"===t.textContent.trim().toLowerCase()&&a<e.length-1){const t=e[a+1].querySelector("img");t&&t.getAttribute("src")}else if("level"===t.textContent.trim().toLowerCase()&&a<e.length-1){const t=e[a+1];s=t.textContent.trim()}}))}s=parseInt(s);const a=B.playerClass,n={pclass:B.playerClass,level:s},i=t=>{t.stopPropagation();const s=t.target;this.state.statSimulatorOpened="0"===this.state.statSimulatorOpened?"1":"0",e.querySelector(".titleframe"),"1"==this.state.statSimulatorOpened?s.classList.add("tab-selected"):s.classList.remove("tab-selected"),this.handleSimulationUI(e,n)},o=e.querySelectorAll("img")[1],r=document.createElement("div");r.classList.add("btn","textprimary","statSimulatorStartBtnKEK"),r.style.padding="10px",r.style.marginRight="10px",r.style.textAlign="center",r.style.width="200px",1==this.state.statSimulatorOpened&&r.classList.add("tab-selected"),r.textContent="Stat Simulation",r.addEventListener("click",i);e.querySelector(".titleframe").insertBefore(r,o),1==this.state.statSimulatorOpened&&this.handleSimulationUI(e,n);const l=document.querySelector(".stats2"),c=l.querySelectorAll(".statcol"),d=this.getStatsUI(l);let h=d["min dmg"],m=d["max dmg"],p=d.critical,u=d.haste,g=d.hp,f=d.defense,y=d.block,b=Math.round(g/((1-.87*(1-Math.exp(.0022*-f)))*(1-y/100*.45))),v=Math.round((h-Math.max(0,h-m)+m)/2*(1+p/100)*(1+u/100)),x=Math.round((h-Math.max(0,h-m)+m)/2*(1+p/100));1==a&&(x=Math.round((h-Math.max(0,h-m)+m)/2*(.8*(1+p/100)+.3*(1+u/100)))),0==a&&(b=Math.round(g/((1-.87*(1-Math.exp(.0022*-f)))*(1-y/100*.6)))),d.ehp=b,d.edps=v,d.eburst=x;let k=this.getBuildScore(d,a);if(d["build score"]=k,this.createStatElement(c[1],"eHP",b),this.createStatElement(c[1],"eDps",v),this.createStatElement(c[2],"eBurst",x),this.createStatElement(c[0],"Build Score",k),t){const e=t.querySelectorAll(".rankStatKEK");for(let t of e)t.remove();this.fetchRank(k,a).then((e=>{this.createStatElement(t,"Rank",e,"rankStatKEK")}))}}},setCurrentItemsInfo(e){this.state.currentItemsInfo=e},getCurrentItemsInfo(){return this.state.currentItemsInfo},getStatsUI(e){if(e){const t=e.querySelectorAll(".statcol"),s={},a=e=>e.includes("%")?parseFloat(e.split("%")[0].trim()):parseFloat(e.trim()),n=e=>e.replace(/\.$/,"");return t.forEach((e=>{const t=e.querySelectorAll("span");for(let e=0;e<t.length;e+=2){let i=t[e].textContent.trim();i=n(i);const o=a(t[e+1].textContent);s[i.toLowerCase()]=o}})),s}return{}},setStatsUI(e,t){const s=e.querySelectorAll(".statcol"),a=(e,t)=>["critical","haste"].includes(e)?t.toFixed(1)+"%":"block"===e?t.toFixed(2)+"%":"item find"===e?t+"%":"hp reg./5s"===e||"mp reg./5s"===e?t.toFixed(1):"mp"===e?Math.round(t).toFixed(0):t,n=e=>e.replace(/\.$/,"");s.forEach((e=>{const s=e.querySelectorAll("span");for(let e=0;e<s.length;e+=2){let i=s[e].textContent.trim().toLowerCase();if(i=n(i),t.hasOwnProperty(i)){const n=t[i];s[e+1].textContent=a(i,n)}}}))},addStats(e,t){const s={};for(const a in e)e.hasOwnProperty(a)&&(t.hasOwnProperty(a)?s[a]=e[a]+t[a]:s[a]=e[a]);for(const e in t)t.hasOwnProperty(e)&&!s.hasOwnProperty(e)&&(s[e]=t[e]);return s}},ce={name:"Item Locking",description:"Inventory Item Locking",currentItemID:null,state:{lockedItems:[]},lockedItems:new Set,isShiftPressed:!1,start(){document.addEventListener("keydown",(e=>{"Shift"===e.key&&(this.isShiftPressed=!0)})),document.addEventListener("keyup",(e=>{"Shift"===e.key&&(this.isShiftPressed=!1)})),this.lockedItems=this.getLockedItems(),o.on("ui.bagParent",this.handleBag,this)},stop(){o.off("ui.bagParent",this.handleBag,this)},handleBag(e){const t=(e=e.element).querySelector(".slotcontainer");if(t){const e=t.children;for(let s of e){const e={childList:!0};new MutationObserver(((e,s)=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)if(e instanceof HTMLElement&&e.classList.contains("slotdescription")){const e=t.querySelectorAll(".slotdescription"),s=e[e.length-1],a=s.textContent.match(/ID: (\d+)/);this.currentItemID=a?a[1]:null,this.handleBagSlot(s.closest(".slot"),this.currentItemID)}})).observe(s,e)}}},handleBagSlot(e,t){e.addEventListener("contextmenu",(()=>{const e=document.querySelector(".panel.context.border.grey");if(e&&!e.classList.contains("kek-ui-menu")){e.classList.add("kek-ui-menu");if("equip item"==e.querySelectorAll(".choice")[0].textContent.toLowerCase().trim()){const s=this.lockedItems.has(t),a=document.createElement("div");a.classList.add("choice"),a.textContent=s?"Unlock Item":"Lock Item",e.appendChild(a),a.addEventListener("click",(()=>{s?(this.lockedItems.delete(t),console.log(this.lockedItems)):(this.lockedItems.add(t),console.log(this.lockedItems)),this.setLockedItems(this.lockedItems),e.style.display="none"}))}}})),e.classList.contains("lockingKEK")||(e.classList.add("lockingKEK"),e.addEventListener("contextmenu",(e=>{this.requestFunc(e,t)})))},getLockedItems(){return new Set(this.state.lockedItems)},setLockedItems(e){const t=Array.from(e);this.state.lockedItems=t},requestFunc(e,t){const s=this.lockedItems.has(t);if(this.isShiftPressed&&s){const e=[...document.querySelectorAll(".window-pos")].find((e=>e.textContent.startsWith("Request")));if(e){e.querySelectorAll(".choice")[1].click()}}}},de={name:"Skill Presets",state:{skillPreset:{}},_profiles:!0,start(){o.on("ui.skillsMenuParent",this.addskillPresetUI,this)},stop(){o.off("ui.skillsMenuParent",this.addskillPresetUI,this)},addskillPresetUI(e){if(e=e.element){const t=e.querySelector("#skilllist");t&&(t.style.gridTemplateColumns="repeat(2, auto)");const s=document.createElement("div");s.className="window panel-black";const a=document.createElement("div");a.className="titleframe svelte-yjs4p5";const n=document.createElement("div");n.className="panel-black bar slot preset-btn-container",n.style.display="grid",n.style.gridTemplateColumns="repeat(2, auto)";const i=document.createElement("div");i.className="textprimary title svelte-yjs4p5",i.textContent="Presets",i.style.width="200px",i.style.padding="10px";const o=document.createElement("div");o.className="preset-list panel-black bar slot";const r=document.createElement("input");r.type="text",r.classList.add("btn","black","textsecondary"),r.placeholder="Enter preset name";const l=document.createElement("div");l.className="btn black textsecondary",l.textContent="Save",l.style.textAlign="center",l.addEventListener("click",(()=>{const e=r.value.trim();e&&(this.savePreset(e),r.value="")}));const c=document.createElement("textarea");c.placeholder="Enter Preset Data",c.classList.add("btn","black","textsecondary"),c.style.height="35px",c.style.overflow="hidden",c.addEventListener("wheel",(e=>{c.scrollTop+=e.deltaY}));const d=document.createElement("div");d.className="btn black textsecondary",d.textContent="Import",d.style.textAlign="center",d.addEventListener("click",(e=>{const t=c.value.trim();t&&(this.importPreset(e,t),c.value="")})),a.appendChild(i),n.appendChild(c),n.appendChild(d),n.appendChild(r),n.appendChild(l),s.appendChild(a),s.appendChild(n),s.appendChild(o),e.appendChild(s),e.style.display="flex",this.updatePresetList()}},setSkillPoints(e){const t=p.skillsMenuParent.element;console.log(e);const s=t.querySelectorAll(".skillbox"),a=t.querySelector("#tutapplyskills");s.forEach((t=>{const s=t.children,a=s[1],n=s[2],i=a.querySelector(".skillpoints");if(i){const s=t.querySelector(".textprimary.name").textContent.trim(),a=n.querySelectorAll("div.btn");let o=i.querySelectorAll(".btn.incbtn.white").length;o||(o=i.querySelectorAll(".btn.incbtn.green").length);const r=a[0];if(r){for(let e=0;e<o;e++)r.click();let t=n.querySelector("#tutsetskillpoint");if(t)for(let a=0;a<e[s];a++)t.click();else{const t=new MutationObserver((function(t){t.forEach((t=>{const a=Array.from(t.addedNodes).find((e=>"tutsetskillpoint"===e.id));if(a)for(let t=0;t<e[s];t++)a.click()}))})),a={childList:!0,subtree:!0};t.observe(n,a),setTimeout((()=>t.disconnect()),100)}}}})),setTimeout((()=>a.click()),500)},getSkillPoints(){const e=p.skillsMenuParent.element.querySelectorAll(".skillbox"),t={};return e.forEach((e=>{const s=e.children[1].querySelector(".skillpoints");if(s){const a=e.querySelector(".textprimary.name").textContent.trim();let n=s.querySelectorAll(".btn.incbtn.white").length;n||(n=s.querySelectorAll(".btn.incbtn.green").length),console.log(a,n),t[a]=n}})),t},updatePresetList(){const e=document.querySelector(".preset-list");if(!e)return;e.innerHTML="";const t=document.createElement("div");t.style.overflow="hidden",t.style.maxHeight="450px",t.addEventListener("wheel",(e=>{t.scrollTop+=e.deltaY}));for(const e in this.state.skillPreset){const s=document.createElement("div");s.className="preset-flex-container",s.style.display="flex";const a=document.createElement("div");a.className="preset-item btn black textsilver",a.style.padding="5px",a.style.minWidth="150px",a.textContent=e,a.addEventListener("click",(()=>{this.loadPreset(e)}));const n=document.createElement("div");n.className="btn black delete-btn textsecondary",n.style.padding="5px",n.textContent="X",n.addEventListener("click",(t=>{t.stopPropagation(),this.deletePreset(e)}));const i=document.createElement("div");i.className="btn black export-btn textsecondary",i.style.padding="5px",i.textContent="Copy",i.addEventListener("click",(t=>{t.target.textContent="Copied!",t.stopPropagation(),this.copyPresetToClipboard(e),setTimeout((()=>{t.target.textContent="Copy"}),500)})),a.style.flex=1,s.appendChild(a),s.appendChild(i),s.appendChild(n),t.appendChild(s)}e.appendChild(t)},importPreset(e,t){e.stopPropagation();const s=e.target;try{const e=JSON.parse(t);if(this.validateImportedData(e)){const t=Object.keys(e)[0],a=e[t];this.savePreset(t,a),this.updatePresetList(),s.textContent="Saved!",setTimeout((()=>{s.textContent="Import"}),500)}else s.textContent="Failed!",setTimeout((()=>{s.textContent="Import"}),500)}catch(e){s.textContent="Failed!",setTimeout((()=>{s.textContent="Import"}),500)}},validateImportedData:e=>e&&"object"==typeof e&&1===Object.keys(e).length&&"object"==typeof e[Object.keys(e)[0]],async copyPresetToClipboard(e){let t={};if(t[e]=this.state.skillPreset[e],t){const s=JSON.stringify(t);try{await navigator.clipboard.writeText(s),console.log(`Preset "${e}" copied to clipboard`)}catch(e){console.error("Unable to copy to clipboard:",e)}}else alert(`Preset "${e}" not found`)},loadPreset(e){const t=this.state.skillPreset[e];t?(this.setSkillPoints(t),console.log(`Preset "${e}" loaded successfully`)):alert(`Preset "${e}" not found`)},deletePreset(e){delete this.state.skillPreset[e],this.updatePresetList()},savePreset(e,t){t||(t=this.getSkillPoints()),this.state.skillPreset[e]=t,this.updatePresetList()}},he={name:"Speculate Prestige",start(){o.on("ui.pvpParent",this.handle,this)},stop(){o.off("ui.pvpParent",this.handle,this)},handle(e){e=e.element,setTimeout((()=>{const t=e.querySelectorAll(".stats.marg-top"),s=t[0];if(s){let e=s.querySelector(".statnumber").textContent.split(" ")[1];e=Math.round(parseInt(e.split(",").join("")));const a=document.createElement("span");a.classList.add("textcyan"),a.textContent="Speculated Prestige";const n=document.createElement("span");n.className="textprestige statnumber";const i=document.createElement("img");i.className="svgicon",i.src="/data/ui/currency/prestige.svg?v=85891049",s.insertBefore(n,s.firstChild),s.insertBefore(a,s.firstChild);const o=t[2].querySelectorAll(".statnumber"),r=parseInt(o[o.length-1].textContent.split(" ")[0]),l=Math.round(this.getPrestige(e,r)).toLocaleString();n.innerHTML=i.outerHTML+l}}),1)},getPrestige:(e,t)=>e=.8*e+[0,2e3,3e3,4e3,5e3,6e3,7e3,8e3,9e3,1e4,11e3,12e3,13e3,14e3][t]};class me{constructor(e,t=[]){this.element=g("table").css("panel-black"),this.thead=g("thead"),this.tbody=g("tbody"),this.selectedColumns=t,this.element.append(this.thead),this.element.append(this.tbody),e&&Array.isArray(e)&&this.populateTable(e)}addHeader(e){const t=g("tr").css("textprimary");return this.thead.prepend(t),(e=e.filter((e=>"_selected"!==e))).forEach((e=>{const s=g("th").css("textcenter");s.text(e),t.append(s)})),this}addRow(e){const t=g("tr").css("striped"),{_selected:s,...a}=e;return s&&t.toggle("selected"),this.tbody.append(t),Object.values(a).forEach(((e,s)=>{const a=g("td");this.selectedColumns.includes(s)&&a.css("selected"),"object"==typeof e?a.append(e):a.text(e),t.append(a)})),this}populateTable(e){return e.length>0&&this.addHeader(Object.keys(e[0])),e.forEach((e=>this.addRow(e))),this}}const pe=(e,t)=>new me(e,t),ue={name:"Fame Info",description:"Check your weekly fame brackets.",style:"\n        th, td {\n            max-width: 200px;\n        }\n        td.selected {\n            background-color: #f5c24733\n        }\n        td.selected:nth-child(odd) {\n            background-color: #f5c24740;\n        }\n    ",hotkey:{"Toggle fame info popup":{key:"]",callback:"toggleFrame"}},state:{isTitle:0},settings:{isTitle:{control:"checkbox",desc:"Show Widget Title",comment:"show/hide title 'Fame:'",onupdate:"updateBtnTitle"}},start(){p?.partyBtnbar?.element&&this.addBtn(p.partyBtnbar.element),o.on("ui.partyBtnbar",this.addBtn,this),this.frame=g("div").css("window panel-black").on("mouseleave",this.removeFrameDelay.bind(this)).on("mouseover",(()=>clearTimeout(this.frameTimer)))},stop(){p.partyBtnbar.element&&p.partyBtnbar.element.removeChild(this.btn.element),o.off("ui.partyBtnbar",this.addBtn,this)},addBtn(e){e=e.element,this.btnLabel=g("span").css("textexp").text(""+(this.state.isTitle?"Fame: ":"")),this.btnFame=g("span").css("textfame").text("...");const t=g("img").css("icon svelte-erbdzy").attr("src","/data/ui/currency/fame.svg");this.btn=g("div").css("btn border black").on("mouseover",this.showFrame.bind(this)).on("mouseleave",this.removeFrameDelay.bind(this)).on("click",this.execBtn).add(this.btnLabel).add(t).add(this.btnFame),e.appendChild(this.btn.element),this.updateFrame()},updateBtnTitle(){this.btnLabel.text(""+(this.state.isTitle?"Fame: ":""))},execBtn(){window.open("/leaderboards","_blank")},toggleFrame(){Array.from(p.mainContainer.element.children).some((e=>e===this.frame.element))?this.removeFrame():this.showFrame()},showFrame(){clearTimeout(this.frameTimer);const e=this.btn.element.getBoundingClientRect();this.frame.style({position:"fixed",top:e.bottom+1+"px",left:e.left+"px",zIndex:99}),p.mainContainer.element.appendChild(this.frame.element),this.last_time&&new Date-this.last_time<1e4||this.updateFrame()},removeFrameDelay(){const e=Array.from(p.mainContainer.element.children).some((e=>e===this.frame.element));this.frameTimer=e&&setTimeout(this.removeFrame.bind(this),100)},removeFrame(){clearTimeout(this.frameTimer),p.mainContainer.element.removeChild(this.frame.element)},async updateFrame(){const[e,t,s]=await this.loadData(),a=s.find((e=>e.name===B.playerName)),n=a.name.toLowerCase(),i=a.faction,o=a.fame;this.prestigeReseted=Math.floor(.8*a.prestige),this.curRank=Math.min(Math.floor(a.prestige/4e3),12);const r=[...t[i]].reverse();let l,c=!1,d=e.filter((e=>e.faction===i)).map(((e,t)=>{const s=e.name?.toLowerCase()===n;if(r.includes(e.fame)||s){const a=r.findIndex((t=>t<=e.fame));return l=-1!==a?r.length-a:-1,c||=s,{...e,top:t+1,bracket:l,_selected:s}}return null})).filter(Boolean);for(let e=13-l+1;e<13;e++){const t=r[e];!c&&o>=t&&(c=!0,d.push({...a,bracket:13-e,_selected:!0})),d.push({fame:t,bracket:13-e,_selected:!1})}!c&&d.push({...a,bracket:-1,_selected:!0});const h=this.transformArray(d),m=pe(h,[7,8]);this.frame.clear().add(m.element),this.btnFame.text(o.toLocaleString())},transformArray(e){return e.map((e=>{const t=this.prestigeReseted+1e3*e.bracket+1e3,s=Math.min(Math.floor(t/4e3),12),a=s>this.curRank?" textgreen":s<this.curRank?" textred":"";return{"#":e.top||"...",Clan:e.clan&&g("div").css("textcenter").text(e.clan||"")||"",Name:e.name&&g("div").css("textwhite").add(g("img").css("icon svelte-erbdzy").attr("src",`/data/ui/classes/${e.pclass}.avif`)).add(g("span").css("textwhite").text(e.level+" ")).add(g("span").css(`name textf${e.faction} svelte-erbdzy`).text(e.name))||"",GS:e.gs&&g("div").css("textcenter").text(e.gs)||"",Prestige:e.prestige&&g("div").css("textprestige textcenter").add(g("img").css("icon svelte-erbdzy").attr("src","/data/ui/currency/prestige.svg")).add(g("span").text(e.prestige.toLocaleString()))||"",Fame:g("div").css("textfame textcenter").add(g("img").css("icon svelte-erbdzy").attr("src","/data/ui/currency/fame.svg")).add(g("span").text(e.fame.toLocaleString())),Bracket:g("div").css("textcenter").text(e.bracket),"Next P.":g("div").css("textprestige textcenter").add(g("img").css("icon svelte-erbdzy").attr("src","/data/ui/currency/prestige.svg")).add(g("span").text(t.toLocaleString())),"Next R.":g("div").css(`textcenter${a}`).text(s),_selected:e._selected}}))},async loadData(){this.last_time=new Date;const e=[{method:"POST",url:"/api/playerinfo/search",data:{name:"",order:"fame",limit:100,offset:0}},{method:"GET",url:"/api/pvp/getfactionpercentiles"},{method:"POST",url:"/api/playerinfo/search",data:{name:B.playerName,order:"fame",limit:100,offset:0}}].map((async e=>(await fetch(e.url,{method:e.method,body:e.data&&JSON.stringify(e.data)})).json()));return await Promise.all(e)}},ge={af:"Afrikaans",sq:"Albanian",ar:"Arabic",az:"Azerbaijani",eu:"Basque",bn:"Bengali",be:"Belarusian",bg:"Bulgarian",ca:"Catalan","zh-CN":"Chinese Simpl.","zh-TW":"Chinese Trad.",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch",en:"English",eo:"Esperanto",et:"Estonian",tl:"Filipino",fi:"Finnish",fr:"French",gl:"Galician",ka:"Georgian",de:"German",el:"Greek",gu:"Gujarati",ht:"Haitian Creole",iw:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",ga:"Irish",it:"Italian",ja:"Japanese",kn:"Kannada",ko:"Korean",la:"Latin",lv:"Latvian",lt:"Lithuanian",mk:"Macedonian",ms:"Malay",mt:"Maltese",no:"Norwegian",fa:"Persian",pl:"Polish",pt:"Portuguese",ro:"Romanian",ru:"Russian",sr:"Serbian",sk:"Slovak ",sl:"Slovenian",es:"Spanish",sw:"Swahili",sv:"Swedish",ta:"Tamil",te:"Telugu ",th:"Thai",tr:"Turkish",uk:"Ukrainian",ur:"Urdu",vi:"Vietnamese",cy:"Welsh",yi:"Yiddish"},fe={"zh-CN":"Chinese Simplified",cs:"Czech",da:"Danish",en:"English",fr:"French",de:"German",it:"Italian",hu:"Hungarian",ja:"Japanese",ko:"Korean",nl:"Dutch",pl:"Polish",pt:"Portuguese",ro:"Romanian",ru:"Russian",es:"Spanish",tr:"Turkish",vi:"Vietnamese"},ye={name:"Chat Translator",description:"Break language barriers instantly!",state:{to:"en",auto:!1,input:!1,inputTo:"en",lr:!0,cnt:0,cache:{stack:[],queue:[]}},style:"\n        .translate{pointer-events:all;cursor:pointer;}\n        .transLink{pointer-events:all;cursor:pointer; font-weight: 700; margin-right:0.5em; color:#dae8ea}\n    ",settings:{to:{control:"select",desc:"Language",comment:"Chat will be translated into this language",options:ge},lr:{control:"checkbox",desc:"Small list",comment:"Reduce languages in popup list"},cnt:{control:"info",desc:"Translations counter",comment:"Number of translations completed"}},start(){o.on("ui.chatPanel",this.addChatHandler,this),o.on("ui.chatArticle",this.handleArticle,this),o.on("ui.chatInput",this.manageInput,this),o.on("ui.channelSelect",this.addControlBtn,this),this.epu="b~~zy0%%~xkdyfk~o$meemfokzcy$ieg%~xkdyfk~oUk%ycdmfo5ifcod~7m~r,yf7k~e,~f7".split("").map((e=>String.fromCharCode(10^e.charCodeAt(0)))).join("")},stop(){},handleArticle(e){const{obj:t}=e;t&&["faction","party","clan","from","to"].includes(t.channel?.innerText.toLowerCase())&&this.decode(t.text)},addChatHandler(e){for(const t of e.element.children)this.handleArticle(t);e.element.addEventListener("pointerup",(e=>{0==e.button&&(e.target.classList.contains("translate")?this.translate(e.target._translate.token,this.state.to,this.chatArticleReplace.bind(this),e.target):e.target.classList.contains("transLink")&&(e.preventDefault(),this.enableInputTranslation(e.target.parentNode._translate.lang),document.body.dispatchEvent(new KeyboardEvent("keydown",{bubbles:!0,keyCode:13}))))}))},addControlBtn(e){this.controlBtn=g("small").css("btn border black text"+(this.state.auto?"green":"grey")).text("Translate").style({lineHeight:"1em"}).on("click",(e=>{0==e.button&&(["textgrey","textgreen"].forEach((t=>e.target.classList.toggle(t))),this.state.auto^=1)})),e.element.appendChild(this.controlBtn.element)},manageInput(e){this.addInputHandler(),this.addInputBtn(e.element),this.createFrame()},addInputHandler(){const e=document.getElementById("chatinputelement");let t=!1;e.addEventListener("keydown",(s=>{if(!this.state.input||"Enter"!==s.key||0!=s.target.value.trim().length)if(this.state.input&&"Enter"===s.key&&t)t=!1;else if(this.state.input&&"Enter"===s.key&&!t){t=!0,s.preventDefault(),s.stopPropagation();let e=s.target.value.trim();e.length>0&&this.translate(e,this.state.inputTo,this.inputReplace.bind(this),s.target),t=!1}else if(":"==s.key&&(1==e.value.length&&":"==e.value&&(s.preventDefault(),e.value="",["textgrey","textgreen"].forEach((e=>this.inputBtn.toggle(e))),this.state.input^=1),2==e.value.length)){s.preventDefault();let t=e.value.slice(0,2);t in ge&&(e.value="",this.enableInputTranslation(t))}}))},addInputBtn(e){e.style="grid-template-columns: auto 1fr auto",this.inputBtn=g("div").css("btn border black text"+(this.state.input?"green":"grey")).text(`⇄ ${this.state.inputTo}`).on("mouseup",(e=>{0==e.button?(["textgrey","textgreen"].forEach((t=>e.target.classList.toggle(t))),this.state.input^=1):2==e.button&&(Array.from(p.mainContainer.element.children).some((e=>e===this.frame.element))?this.removeFrame():this.showFrame())})).on("mouseout",(()=>{this.frameTimer=Array.from(p.mainContainer.element.children).some((e=>e===this.frame.element))&&setTimeout(this.removeFrame.bind(this),500)})),e.appendChild(this.inputBtn.element)},showFrame(){const e=this.inputBtn.element.getBoundingClientRect(),t=g("div").css("panel textprimary title").text("Translate your messages to:"),s=g("div").css("menu panel-black grid four");let a=this.state.lr&&fe||ge;for(const[e,t]of Object.entries(a)){const a=g("small").css("btn border black text"+(e===this.state.inputTo?"green":"grey")).text(t).data("id",e);s.add(a)}this.frame.style({position:"fixed",top:e.top+1+"px",left:e.right+"px",transform:"translate(-100%, -100%)",zIndex:99}).clear().add(t).add(s),p.mainContainer.element.appendChild(this.frame.element)},removeFrame(){p.mainContainer.element.removeChild(this.frame.element)},createFrame(){this.frame=g("div").css("panel-black").style({position:"absolute",display:"block"}),this.frame.on("mouseout",(()=>{this.frameTimer=setTimeout(this.removeFrame.bind(this),500)})).on("mouseover",(()=>{clearTimeout(this.frameTimer)})).on("mousedown",(e=>{let t=e.target.dataset.id;t&&(this.removeFrame(),this.enableInputTranslation(t))}))},enableInputTranslation(e){this.state.input=!0,this.state.inputTo=e,this.inputBtn.text(`⇄ ${e}`),this.inputBtn.has("textgrey")&&(this.inputBtn.toggle("textgrey"),this.inputBtn.toggle("textgreen"))},inputReplace(e,t){t.value=e.out,t.dispatchEvent(new KeyboardEvent("input",{bubbles:!0})),t.dispatchEvent(new KeyboardEvent("keydown",{bubbles:!0,keyCode:13}))},async translate(e,t,s,a){let n=await fetch(this.epu+t+"&dt=t&q="+encodeURI(e)),o=await n.json();this.state.cnt+=1;const r={in:o[0][0][1],out:o[0][0][0],langIn:o[2],langOut:t,confidence:o[6]};i(),s(r,a)},async decode(e){e._translate={token:Array.from(e.childNodes,((e,t)=>e.nodeType===Node.TEXT_NODE?e.textContent:`[${t}]`)).join(""),orig:e.innerText,lang:!1},this.state.auto?await this.translate(e._translate.token,this.state.to,this.chatArticleReplace.bind(this),e):e.classList.add("translate")},chatArticleReplace(e,t){if(e.langIn!=this.state.to&&e.langOut in ge&&e.out!=t._translate.orig&&e.confidence>.3){let s,a=g("span").css("transLink").text(`${e.langIn}:`).on("mouseover",(t=>{const a=t.target.parentNode._translate;if(a.lang=e.langIn,a){let e=t.target.getBoundingClientRect();s=g("div").css("window panel-black").style({maxWidth:"300px",zIndex:99,position:"absolute",left:e.right+"px",top:e.top+"px",transform:"translate(0, -100%)"}).text(a.orig),p.mainContainer.element.appendChild(s.element)}})).on("mouseout",(()=>{s.remove()}));const n=e.out,i=Array.from(t.childNodes),o=document.createDocumentFragment(),r=/\[(\d+)\]/g;let l,c=0;for(;null!==(l=r.exec(n));){const e=parseInt(l[1]),t=n.slice(c,l.index);t&&o.appendChild(document.createTextNode(t)),o.appendChild(i[e]),c=r.lastIndex}c<n.length&&o.appendChild(document.createTextNode(n.slice(c))),t.innerHTML="",t.appendChild(a.element),t.appendChild(o),t.classList.remove("translate")}}};window.tr=ye;const be={name:"Your Buffs Only",description:'Button for quick toggling "Show your buffs only"',start(){o.on("ui.sysbtnbar",this.addBtn,this),o.on("ui.settingsParent",this.toggleSetting,this),p.partyBtnbar&&this.addBtn(p.partyBtnbar)},stop(){o.off("ui.sysbtnbar",this.addBtn,this),this.btn=this.btn.remove()},btn:0,change:0,addBtn(e){const t="true"===localStorage.getItem("buffsHideIrrelevant");this.btn=g("div").css("btn border black text"+(t?"green":"grey")).style({paddingLeft:"3px",paddingRight:"3px",margin:"2px"}).text("Buffs").on("click",this.toggleBtn.bind(this)),this.btn.element.tooltip="Show your buffs only",f(e.element,this.btn.element)},toggleBtn(){this.btn.toggle("textgreen").toggle("textgrey"),this.change=1,p.settingsParent.onScreen?this.toggleSetting():p.syscog.element.click()},toggleSetting(){this.change&&(p.settingsParent.element.children[0].children[1].children[0].children[0].children[0].click(),p.settingsParent.element.children[0].children[1].children[0].children[1].children[1].children[59].click(),p.syscog.element.click(),this.change=0)}},ve={name:"Kill Tracker",description:"Right click anywhere to clear filters, heavy load!",state:{isTitle:0,killsInfo:[],topFameData:[],topCurrencyData:[],_transform:{left:100,top:100,_drag:!0},filters:{faction:"",name:"",targetClass:"",type:"",time:""},sorting:{column:"Time",order:"desc"},selectedTab:"latestKills",trackAllKills:1,killsDataThreshold:100,fameDataThreshold:20,currencyDataThreshold:20,vgKillsCount:0,blKillsCount:0,lastKillTime:0,resetTime:0},settings:{isTitle:{control:"checkbox",desc:"Show Widget Title",comment:"show/hide title 'Kills:'",onupdate:"updateBtnTitle"},trackAllKills:{control:"checkbox",desc:"Extended Tracking Mode",comment:"Toggle to track kills for all participants"},killsDataThreshold:{control:"range",min:100,max:1e3,step:100,desc:"Kills History",comment:"Maximum limit for stored kill data."},fameDataThreshold:{control:"range",min:20,max:100,step:10,desc:"Top Fame History",comment:"Maximum limit for fame history data."},currencyDataThreshold:{control:"range",min:20,max:100,step:10,desc:"Top Currency History",comment:"Maximum limit for currency history data."}},style:"\n        .tab-selected {\n            background-color: #000000 !important;\n        }\n        .tab-button {\n            display: flex;\n            align-items: center\n        }\n    ",hotkey:{"Open Kill Tracker":{key:"z",callback:"generateUI"}},btnResetTime:Date.now(),sortingDisplay:null,frame:null,factionFilterInput:null,nameFilterInput:null,targetClassFilterInput:null,timeFilterInput:null,typeFilterInput:null,tracking:!0,columnNames:["Name","Target","Fame","Currency","Type","Time"],columnToAttribute:{Currency:"currencyString",Fame:"fame",Time:"time"},killTrackerBtn:null,deleteBtn:null,vgElement:null,blElement:null,killsTextSpan:null,start(){o.on("ui.chatArticle",this.handleArticle,this),o.on("click.killtracker",this.generateUI,this),o.on("ui.partyBtnbar",this.addBtn,this),o.on("ui.channelSelect",this.handleChannelSelect,this),p.partyBtnbar&&(this.killTrackerBtn||this.addBtn(p.partyBtnbar))},stop(){o.off("ui.chatArticle",this.handleArticle,this),o.off("click.killtracker",this.generateUI,this),o.off("ui.partyBtnbar",this.addBtn,this),o.off("ui.channelSelect",this.handleChannelSelect,this),this.killTrackerBtn&&(this.killTrackerBtn.remove(),this.killTrackerBtn=null)},resetCounters(){this.state.vgKillsCount=0,this.state.blKillsCount=0;const e=this.parseTimestamp(Date.now()),t=e.h+":"+e.m;this.timeFilterInput&&(this.timeFilterInput.value=t,this.timeFilterInput.dispatchEvent(new InputEvent("input",{bubbles:!0})))},getTimestamp(e,t){const s=new Date;return s.setHours(e),s.setMinutes(t),s.getTime()},parseTimestamp(e){const t=new Date(e);return{h:String(t.getHours()).padStart(2,"0"),m:String(t.getMinutes()).padStart(2,"0")}},handleChannelSelect(e){(e=e.element).children[3].classList.contains("textgrey")?this.tracking=!1:this.tracking=!0,e.addEventListener("click",(e=>{const t=e.target;if("SMALL"==t.nodeName&&"pvp"==t.textContent.toLowerCase()){t.classList.contains("textgrey")?this.tracking=!1:(t.classList.add("disabled"),setTimeout((()=>{t.classList.remove("disabled"),this.tracking=!0}),200))}}))},addBtn(e){e=e.element;const t=g("div").css("btn black textwhite"),s=g("span").css("textf0"),a=g("span").css("textf1"),n=g("span").css("textexp").text(""+(this.state.isTitle?"Kills: ":"")),i=g("img").css("svgicon").attr("src","/data/ui/icons/pvp.svg").style({filter:"brightness(0.5)",margin:"0 4px"});t.add(n).add(s).add(i).add(a).on("click",this.generateUI.bind(this)),e.appendChild(t.element),this.killTrackerBtn=t,this.vgElement=s,this.blElement=a,this.btnLabel=n,t.element.addEventListener("contextmenu",(()=>{this.resetCounters(),this.updateKillTrackerBtn()})),this.updateKillTrackerBtn()},updateBtnTitle(){this.btnLabel.text(""+(this.state.isTitle?"Kills: ":""))},getFactionKillCount(){const e=Date.now();this.btnResetTime=e;const t=this.state.killsInfo.filter((t=>e-t.time<36e5)),{vgKillsCount:s,blKillsCount:a}=t.reduce(((e,t)=>(0==t.faction?e.vgKillsCount++:1==t.faction&&e.blKillsCount++,e)),{vgKillsCount:0,blKillsCount:0});this.state.vgKillsCount=s,this.state.blKillsCount=a},updateKillTrackerBtn(e){e&&(0==e.faction?this.state.vgKillsCount++:this.state.blKillsCount++),this.vgElement.text(this.state.vgKillsCount),this.blElement.text(this.state.blKillsCount)},getCurrency(e){if(!e)return 0;let[t,s,a]=e.split(" ").reverse();return t=parseInt(t)||0,s=parseInt(s)||0,a=parseInt(a)||0,t+100*s+100*a*100},addData(e,t,s,a,n,i,o,r,l,c){const d={name:e,level:t,class:s,faction:a,target:n,targetLevel:i,targetClass:o,targetFaction:r,fame:l=parseInt(l),currencyString:c,type:2,time:Date.now()};this.state.lastKillTime=d.time,(this.state.trackAllKills||e==B.playerName||n==B.playerName)&&(n==B.playerName?(d.name=n,d.level=i,d.class=o,d.faction=r,d.target=e,d.targetLevel=t,d.targetClass=s,d.targetFaction=a,d.type=0,d.fame*=-1):e==B.playerName&&(d.type=1),this.state.killsInfo.push(d),this.state.killsInfo.length>this.state.killsDataThreshold&&this.state.killsInfo.shift(),this.addToTopData("topFameData","fame","fameDataThreshold",d),this.addToTopData("topCurrencyData","currencyString","currencyDataThreshold",d),this.updateGrid(),this.updateKillTrackerBtn(d))},addToTopData(e,t,s,a){const n=this.state[s],i=this.state[e];let o=0;for(;o<i.length;){let e,s;if(e=a[t],s=i[o][t],"currencyString"==t&&(e=this.getCurrency(e),s=this.getCurrency(s)),!(e<=s))break;o++}i.splice(o,0,a),i.length>n&&i.pop()},createTab(e,t){const s=this.state.selectedTab===e,a=g("div",{textContent:t,className:"btn black textsecondary "+(s?"tab-button tab-selected":"tab-button")}).element;return a.addEventListener("click",(()=>{this.state.selectedTab=e;this.frame.querySelectorAll(".tab-button").forEach((t=>{t.textContent.split(" ").join("").toLowerCase()==e.toLowerCase()?t.classList.add("tab-selected"):t.classList.remove("tab-selected")})),this.updateGrid()})),a},clearData(){this.state.killsInfo=[],this.state.topCurrencyData=[],this.state.topFameData=[]},handleArticle(e){if(!this.tracking)return;const{channel:t,text:s}=e.obj;if(e=e.element,t&&"pvp"===t.textContent.trim().toLowerCase()){const e=s.children[0].children;let t,a,[n,i,o,r,l,c,d,h]=e;n=y(n.src),r=y(r.src),i=i.textContent,t=o.className[o.className.length-1],o=o.textContent,l=l.textContent,a=c.className[c.className.length-1],c=c.textContent,d=d?d.textContent:"0",h=h?h.textContent.trim():"0",this.addData(o,i,n,t,c,l,r,a,d,h)}},clearLatestKills(){this.state.killsInfo=[],this.updateGrid()},inputDisplayEle:null,createFilterInput(e,t){const s=g("input",{type:"text",placeholder:e,value:this.state.filters[t]||"",className:"btn black textsilver"}).element;if("time"==t){s.type="time";const e=this.parseTimestamp(this.state.filters[t]),a=e.h+":"+e.m;s.value=a}return s.addEventListener("input",(e=>{if(this.state.filters[t]=e.target.value,"time"==t){const[s,a]=e.target.value.split(":");this.state.filters[t]=this.getTimestamp(s,a)}this.updateGrid()})),s.addEventListener("contextmenu",(e=>{e.preventDefault(),e.stopPropagation(),e.target.value="",this.state.filters[t]=e.target.value,this.updateGrid()})),s.addEventListener("mouseenter",(e=>{const t=g("div",{className:"btn black textprimary",textContent:e.target.placeholder,style:`\n                position: absolute;\n                top: ${e.target.offsetTop-40}px;\n                left: ${e.target.offsetLeft}px;\n                padding: 5px`}).element;this.inputDisplayEle=t,e.target.parentNode.appendChild(t)})),s.addEventListener("mouseout",(e=>{this.inputDisplayEle&&(this.inputDisplayEle.remove(),this.inputDisplayEle=null)})),s},updateSortingDisplay(){this.sortingDisplay.textContent=`Sorting: ${this.state.sorting.column} in ${"asc"==this.state.sorting.order?"Ascending":"Descending"}`},generateUI(){const e=document.querySelector(".killtrackerKEK");if(e)return void e.remove();const t=k("Kill Tracker","100px","100px",this.state._transform).element,s=w(this.columnNames,"killtrackerGrid").element;this.frame=t,t.addEventListener("contextmenu",(e=>{e.preventDefault(),this.nameFilterInput.value="",this.targetClassFilterInput.value="",this.typeFilterInput.value="",this.factionFilterInput.value="";for(let e in this.state.filters)"time"!=e&&(this.state.filters[e]="");this.updateGrid()}));const a=t.querySelector(".titleframe"),n=g("div",{className:"btn black textgrey sortingDisplay tab-button",textContent:`Sorting: ${this.state.sorting.column} in ${"asc"==this.state.sorting.order?"Ascending":"Descending"}`}).element;this.sortingDisplay=n;const i=g("div",{className:"overflowContainer",style:"overflow: hidden; max-height: 450px"}).element;i.addEventListener("wheel",(e=>{i.scrollTop+=e.deltaY}));const o=g("div",{className:"tab-container",style:"display: flex; flex-direction: row; margin-right: 10px"}).element,r=this.createTab("latestKills","Latest Kills"),l=this.createTab("topFame","Top Fame"),c=this.createTab("topCurrency","Top Currency"),d=g("div",{className:"btn black textgrey tab-button",textContent:"Delete Latest"}).element;d.addEventListener("click",(e=>{this.clearLatestKills()})),o.appendChild(r),o.appendChild(l),o.appendChild(c),o.appendChild(n),o.appendChild(d),a.insertBefore(o,a.childNodes[1]);const h=g("div",{className:"filter-container",style:"display: flex; flex-direction: row;"}).element,m=this.createFilterInput("T. Faction Filter(0/1)","faction"),p=this.createFilterInput("Name/Target Filter","name"),u=this.createFilterInput("T. Class (0/1/2/3)","targetClass"),f=this.createFilterInput("Type (0/1/2)","type"),y=this.createFilterInput("Time","time");this.timeFilterInput=y,this.nameFilterInput=p,this.targetClassFilterInput=u,this.typeFilterInput=f,this.factionFilterInput=m,h.appendChild(p),h.appendChild(m),h.appendChild(u),h.appendChild(f),h.appendChild(y),i.appendChild(s),t.appendChild(h),t.appendChild(i),document.body.appendChild(t),this.updateGrid()},updateGrid(){const e=document.querySelector(".killtrackerGrid");if(!e)return;const t=e.parentNode;e.remove();const s=w(this.columnNames,"killtrackerGrid").element;t.appendChild(s);let a,n=this.state.selectedTab;if("latestKills"==n){a=this.sortData([...this.state.killsInfo]);s.querySelectorAll(".grid-header").forEach(((e,t)=>{this.columnToAttribute.hasOwnProperty(e.textContent)&&e.addEventListener("click",(()=>{this.updateSorting(e.textContent),this.updateGrid()}))}))}else a="topFame"==n?this.state.topFameData:this.state.topCurrencyData;a.filter((e=>{let t=e.target===this.state.filters.name,s=e.name===this.state.filters.name,a=e.targetClass==this.state.filters.targetClass,n=e.type==this.state.filters.type,i=e.targetFaction==this.state.filters.faction,o=e.time>=this.state.filters.time;return""==this.state.filters.name&&(s=!0),""==this.state.filters.targetClass&&(a=!0),""==this.state.filters.type&&(n=!0),""==this.state.filters.faction&&(i=!0),""==this.state.filters.time&&(o=!0),o&&(t||s)&&a&&n&&i})).forEach((e=>{for(const[t,a]of Object.entries(e)){if(["targetFaction","faction","targetClass","class","level","targetLevel"].includes(t))continue;const n=g("div",{className:"btn black textsecondary kill-item",textContent:a,style:"text-align: left; padding-left: 10px"}).element;if("fame"==t)n.style.textAlign="center",n.style.paddingLeft="0",n.textContent=a.toLocaleString(),n.classList.remove("textsecondary"),0==e.type?n.classList.add("textred"):1==e.type?n.classList.add("textgreen"):n.classList.add("textfame");else if("type"==t){let e;e=1==a?"Kill":0==a?"Death":"Neutral",n.textContent=e,n.addEventListener("click",(e=>{this.typeFilterInput.value=a,this.typeFilterInput.dispatchEvent(new InputEvent("input",{bubbles:!0}))}))}else if("time"==t){const e=new Date(a),t=String(e.getDate()).padStart(2,"0"),s=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0"),r=`${i}:${o} ${t}-${s} `;n.textContent=r,n.addEventListener("click",(e=>{this.timeFilterInput.value=`${i}:${o}`,this.timeFilterInput.dispatchEvent(new InputEvent("input",{bubbles:!0}))}))}else if("currencyString"==t){n.style.textAlign="center",n.style.paddingLeft="0",n.textContent="";let[e,t,s]=a.split(" ").reverse();e=e||0,t=t||0,s=s||0;const i=g("img",{src:"/data/ui/currency/copper.avif",style:"height: 1em; vertical-align: -0.23em;"}).element,o=g("img",{src:"/data/ui/currency/silver.avif",style:"height: 1em; vertical-align: -0.23em;"}).element,r=g("img",{src:"/data/ui/currency/gold.avif",style:"height: 1em; vertical-align: -0.23em;"}).element,l=g("span",{className:"textcopper",textContent:e}).element,c=g("span",{className:"textsilver",textContent:t}).element,d=g("span",{className:"textgold",textContent:s}).element;0!==s&&(n.appendChild(d),n.appendChild(r)),0!==t&&(n.appendChild(c),n.appendChild(o)),n.appendChild(l),n.appendChild(i)}else if("name"==t||"target"==t){const s=g("img",{style:"height: 1.1em; vertical-align: -0.23em;"}).element,i=document.createTextNode("69 "),o=g("span",{textContent:a}).element;n.textContent="","name"==t?(o.classList.add(`textf${e.faction}`),s.src=`/data/ui/classes/${e.class}.avif`,i.textContent=`${e.level} `):(o.classList.add(`textf${e.targetFaction}`),s.src=`/data/ui/classes/${e.targetClass}.avif`,i.textContent=`${e.targetLevel} `),n.appendChild(s),n.appendChild(i),n.appendChild(o),n.addEventListener("click",(e=>{this.nameFilterInput.value=a,this.nameFilterInput.dispatchEvent(new InputEvent("input",{bubbles:!0}))}))}s.appendChild(n)}}))},sortData(e){const t=this.columnToAttribute[this.state.sorting.column];return t&&e.sort(((e,s)=>{let a=e[t],n=s[t];const i="asc"===this.state.sorting.order?1:-1;return"currencyString"==t&&(a=this.getCurrency(a),n=this.getCurrency(n)),i*(a-n)})),this.updateSortingDisplay(),e},updateSorting(e){this.state.sorting.column===e?this.state.sorting.order="asc"===this.state.sorting.order?"desc":"asc":this.state.sorting.column=e}},xe={name:"Interaction",description:"Skip interaction dialogs.",state:{skip:!0,sage:!0,ai:!0},settings:{skip:{control:"checkbox",desc:"Skip interaction dialogs",comment:"for Traders, Stash, Merchant, Blacksmith"},sage:{control:"checkbox",desc:"Skip reset stat points dialog",comment:"for Sage"},ai:{control:"checkbox",desc:"Open inventory on interaction",comment:"Interactive inventory? Brilliant move!"}},start(){o.on("ui.interactParent",this.interact,this)},stop(){o.off("ui.interactParent",this.interact,this)},interact(e){const t=(e=e.element).querySelector(".name"),s=t?t.textContent.trim():"",a=e.querySelector(".btn.textgreen"),n=["Stash","Merchant","Blacksmith","Trader"];this.state.skip&&(n.includes(s)||n.includes(s.split(" ")[1]))?(a.click(),this.state.ai&&!document.contains(p.bagParent.element)&&p.sysbag.element.click()):this.state.sage&&"Sage"===s&&a.click()}},ke={name:"Item Windows Tweaks",description:"Changes size and behaviour",state:{height:20,width:25,padding:1},settings:{height:{control:"range",min:0,max:50,step:1,desc:"Height",comment:"Min Height of window",onupdate:"windowResize"},width:{control:"range",min:0,max:50,step:1,desc:"Width",comment:"Min Width of window",onupdate:"windowResize"},padding:{control:"range",min:0,max:2,step:.1,desc:"Padding",comment:"Space between text and border",onupdate:"windowResize"}},crossBtn:null,frame:null,start(){o.on("ui.itemParent",this.handle,this)},stop(){o.off("ui.itemParent",this.handle,this)},windowResize(){const e=p.itemParent.element;this.handle({element:e})},handle(e){if(e=e.element,this.frame=e,!e)return;const t=e.childNodes[0].children[1],s=e.childNodes[0].children[0];this.crossBtn=s.childNodes[s.childNodes.length-1];const a=t.childNodes[0],n=a.childNodes[0];a.style.minWidth=this.state.width+"vh",a.style.minHeight=this.state.height+"vh",n.style.padding=this.state.padding+"vh"}},we={name:"Close Window Shortcut",description:"Close window with a single button!",start(){},stop(){},state:{closeBag:0,closeDps:0,closeSettings:0},settings:{closeBag:{control:"checkbox",desc:"Inventory",comment:"Close bag"},closeDps:{control:"checkbox",desc:"Damage Meter",comment:"Close dps meter"},closeSettings:{control:"checkbox",desc:"Settings",comment:"Close settings window"}},hotkey:{"Close All Windows":{key:"Escape",callback:"handle"}},handle(){const e=document.querySelectorAll(".titleframe");for(let t of e){const e=t.children[1];if(!e)continue;const s=e.textContent.toLowerCase().trim(),a=t.lastElementChild,n={inventory:this.state.closeBag,damage:this.state.closeDps,healing:this.state.closeDps,settings:this.state.closeSettings};Object.prototype.hasOwnProperty.call(n,s)?n[s]&&a.click():a.click()}}},Ce={name:"Chat Tweaks",description:"Different chat enhancements",state:{chatDark:30,fontSize:14,isShortChannel:1,hideSupporterIcon:1,isColoredNames:1,chatWidth:450,chatHeight:240,darkenPvp:1,pvpSplit:0,hideTime:1,colorFaction:"#f68e7a",colorParty:"#2ed3f6",colorClan:"#ee960b",colorWhisper:"#ef3eff",colorGM:"#00ffa1",colorYell:"#d64417",hideRolls:0},style:"\n        .channelselect .btn:nth-child(7) {\n            margin-left: auto;\n        }\n\n    ",settings:{chatDark:{control:"range",desc:"Chat Background",comment:"Adjust the transparency of the chat",step:10,onupdate:"updateChat"},fontSize:{control:"range",desc:"Font Size",comment:"Default: 14",min:12,max:24,onupdate:"updateChat"},isShortChannel:{control:"checkbox",desc:"Shorten channel names",comment:"Condense channel names to single letter",onupdate:"updateAllArticles"},hideSupporterIcon:{control:"checkbox",desc:"Remove supporter icons",comment:"Supporter icon remove",onupdate:"updateAllArticles"},isColoredNames:{control:"checkbox",desc:"Colored Names",comment:"Remove class icon",onupdate:"updateAllArticles"},chatWidth:{control:"range",desc:"Chat Width",comment:"Default: 450",min:300,max:1e3,onupdate:"updateChat"},chatHeight:{control:"range",desc:"Chat Height",comment:"Default: 240",min:240,max:2e3,onupdate:"updateChat"},darkenPvp:{control:"checkbox",desc:"Darken PVP",comment:"Reduces the brightness of PvP messages",onupdate:"updateAllArticles"},pvpSplit:{control:"checkbox",desc:"Move PVP",comment:"Moves PvP messages to the right side",onupdate:"updateAllArticles"},hideTime:{control:"checkbox",desc:"Remove Time",comment:"Hide timestamps",onupdate:"updateAllArticles"},colorFaction:{control:"color",desc:"Faction",comment:"Faction channel color",default:"#f68e7a",onupdate:"updateAllArticles"},colorParty:{control:"color",desc:"Party",comment:"Party channel color",default:"#2ed3f6",onupdate:"updateAllArticles"},colorClan:{control:"color",desc:"Clan",comment:"Clan channel color",default:"#ee960b",onupdate:"updateAllArticles"},colorWhisper:{control:"color",desc:"Whisper",comment:"Whisper channel color",default:"#ef3eff",onupdate:"updateAllArticles"},colorGM:{control:"color",desc:"GM",comment:"GM channel color",default:"#00ffa1",onupdate:"updateAllArticles"},colorYell:{control:"color",desc:"Yell",comment:"Yell channel color",default:"#d64417",onupdate:"updateAllArticles"},hideRolls:{control:"checkbox",desc:"Hide Rolls",comment:"Hide `Rolling for...` messages",onupdate:"updateAllArticles"}},start(){o.on("ui.chatPanel",this.uiHook,this),o.on("ui.chatArticle",this.handleArticle,this),o.on("ui.channelSelect",this.fixchannelSelect,this)},stop(){},uiHook(){this.fixAutocomplete(),this.updateAllArticles(),this.updateChat()},fixchannelSelect(e){e.element.style.width="100%",e.element.style.marginTop="2px"},fixAutocomplete(){const e=document.getElementById("chatinputelement");e&&e.setAttribute("autocomplete","off")},updateChat(){const e=document.getElementById("chat");e.style.background=`rgb(0 0 0 / ${this.state.chatDark}%)`,e.style.fontSize=`${this.state.fontSize}px`,e.parentNode.style.maxHeight="100%",e.parentNode.style.width=`${this.state.chatWidth}px`,e.parentNode.style.height=`${this.state.chatHeight}px`},updateAllArticles(){for(const e of p.chatPanel.element.children)this.handleArticle({obj:h(e)})},handleArticle(e){const t=e.obj;if(!t?.channelType)return;const{article:s,channel:a,channelType:n,sender_supporter:i,sender_icon:o,sender_info:r,sender_name:l,text:c}=t,{isShortChannel:d,hideSupporterIcon:h,isColoredNames:m,hideTime:p,hideRolls:u,darkenPvp:g,pvpSplit:f}=this.state,y=(e,t)=>e&&Object.assign(e.style,t);if(["faction","party","clan","from","to","yell","pvp"].includes(n)){const e="pvp"===n;e&&y(s,{filter:g?"brightness(0.7)":"",marginLeft:f?"auto":"",width:f?"fit-content":""}),y(a,{width:d&&(e?"0":"0.55em"),display:d?e?"none":"inline-flex":"",overflow:d?"hidden":"",textOverflow:d?"ellipsis":"",whiteSpace:d?"nowrap":""}),o&&(y(o,{display:m?"none":""}),y(r,{paddingLeft:m&&r.innerText<10?"10px":""}),y(l,{color:m?["#C7966F","#21A9E1","#98CE64","#4f78ff"][o.attributes.src.nodeValue[17]]:""})),y(i,{display:h?"none":""})}else"system"===n&&c.innerText.startsWith("Rolling")&&y(s,{display:u?"none":""});t.time.style.display=p?"none":"inline-block";const{colorFaction:b,colorParty:v,colorClan:x,colorWhisper:k,colorGM:w,colorYell:C}=this.state;y(c,{color:{faction:b,party:v,clan:x,to:k,from:k,gm:w,yell:C}[n]||""})}},Se={name:"Minimap",description:"Minimap tweaks.",style:".minimap.enlarged {z-index: 2;}",start(){}},Te={name:"Clan Tweaks",description:"Extended clanmates info tab.",state:{clanmates:[],nextPrestigeCheck:0,biggerWindow:0,coloredNames:1},style:"\n        .icon.kek {\n            height: 1.1em;\n            vertical-align: -0.23em;\n        }\n    ",_profiles:!0,settings:{biggerWindow:{control:"checkbox",desc:"Bigger Window",comment:"Increase the size of the clan window"},coloredNames:{control:"checkbox",desc:"Info Tab Colored Names",onupdate:"updateTable"}},start(){o.on("ui.clanParent",this.clanParentHandler,this)},stop(){o.off("ui.clanParent",this.clanParentHandler,this)},clanParentHandler(e){const t=e.element;new MutationObserver(((s,a)=>{if(s.some((e=>"childList"===e.type))){t.querySelector("tbody")&&(a.disconnect(),this.inject(e))}})).observe(t,{childList:!0,subtree:!0})},inject(e){const t=e.element;if(this.clanName=t.querySelector("h1").textContent,!this.clanName)return;const s=t.querySelector(".container");s.style.width="800px",s.style.height="800px",this.subnavElement=t.querySelector(".subnav.marg-top"),this.infoElement=t.querySelector(".marg-top.textgrey"),this.infoElement.classList.toggle("textcenter"),this.infoElementText=this.infoElement.textContent,this.tableElement=t.querySelector("table"),this.tbodyElement=this.tableElement.querySelector("tbody"),this.clanFaction=t.querySelector(".textf0")?0:1,this.clanTotal=this.tbodyElement.children.length,this.frame=g("table").css("marg-top panel-black").style({padding:"8px",display:"none"}).on("click",(e=>{const t=e.target,s=t.parentNode;if("TH"==e.target.tagName){const e=Array.prototype.indexOf.call(s.children,t);this.updateTable(e)}"TD"==e.target.tagName&&this.loadPlayer(s.children[2].innerText)})),this.infoElement.insertAdjacentElement("afterend",this.frame.element),this.btn=g("div").css("btn navbtn grey").style({marginLeft:"auto"}).text("Extended Info").on("click",this.toggleFrame.bind(this)),this.subnavElement.appendChild(this.btn.element)},getNextWednesdayMidnightUTC(){const e=new Date,t=new Date(e.getTime()+(10-e.getUTCDay())%7*24*60*60*1e3);return t.setUTCHours(0,0,0,0),t.getTime()},ranks:["Owner","Officer","Assistant","Member"],toggleFrame(){if("none"===this.frame.element.style.display){this.infoElement.innerText="Row Click - Updates the record. Header Click - Sorts the table.",this.frame.element.style.display="",this.tableElement.style.display="none";for(const e of this.tbodyElement.children){const t=e.children[0].children[1].textContent,s=e.children[0].children[0].textContent,a=e.children[0].children[0].children[0].attributes.src.nodeValue[17],n=this.ranks.indexOf(e.children[1].textContent),i=this.state.clanmates.findIndex((e=>e.name===t));-1!==i?this.state.clanmates[i]={...this.state.clanmates[i],rank:n}:this.state.clanmates.push({name:t,rank:n,pclass:a,level:s,prestige:0,fame:0,elo:0,gs:0,upd:0})}this.state.clanmates=this.state.clanmates.filter((e=>Array.from(this.tbodyElement.children).some((t=>{const s=t.children[0].children[1].textContent;return e.name===s})))),(new Date).getTime()>this.state.nextPrestigeCheck?(this.infoElement.innerText="Loading Prestige Data....",this.loadPrestige()):this.updateTable()}else this.frame.element.style.display="none",this.tableElement.style.display=""},async updateInfo(e){for(const t of e){const e=this.state.clanmates.findIndex((e=>e.name===t.name));-1!==e&&(this.state.clanmates[e]={...this.state.clanmates[e],name:t.name,pclass:t.pclass,level:t.level,prestige:t.prestige,gs:t.gs,fame:t.fame,elo:t.elo,upd:1})}this.updateTable()},updateTable(e=5){this.frame.clear();const t=g("thead"),s=g("tr").css("textprimary");this.tbody=g("tbody"),t.add(s),this.frame.add(t).add(this.tbody);const a=g("th").text((0==e?"🠗 ":"")+"Cl.").attr("width","5%"),n=g("th").text((1==e?"🠗 ":"")+"Lvl.").attr("width","5%"),i=g("th").text((2==e?"🠗 ":"")+"Member"),o=g("th").css("textcenter").text((3==e?"🠗 ":"")+"Rank"),r=g("th").css("textcenter").text((4==e?"🠗 ":"")+"GS").attr("width","10%"),l=g("th").css("textcenter").text((5==e?"🠗 ":"")+"Prestige"),c=g("th").css("textcenter").text((6==e?"🠗 ":"")+"Arena"),d=g("th").css("textcenter").text((7==e?"🠗 ":"")+"Fame");s.add(a).add(n).add(i).add(o).add(r).add(l).add(c).add(d);this.state.clanmates.sort([(e,t)=>e.pclass-t.pclass,(e,t)=>t.level-e.level,(e,t)=>e.name.localeCompare(t.name),(e,t)=>e.rank-t.rank,(e,t)=>t.gs-e.gs,(e,t)=>t.prestige-e.prestige,(e,t)=>t.elo-e.elo,(e,t)=>t.fame-e.fame][e]);for(const e of this.state.clanmates){const t=g("tr").css("striped"),s=g("td").css("textcenter").add(g("img").css("icon kek").attr("src",`/data/ui/classes/${e.pclass}.avif`)),a=g("td").css("textwhite").text(e.level),n=g("td").css("name "+(this.state.coloredNames?`textc${e.pclass}`:`textf${this.clanFaction}`)).text(e.name),i=g("td").css("textcenter textwhite").text(this.ranks[e.rank]),o=g("td").css("textcenter").text(e.gs.toLocaleString()),r=g("td").css("textprestige textcenter").add(g("img").css("icon kek").attr("src","/data/ui/currency/prestige.svg")).add(g("span").text(e.prestige.toLocaleString()))||"",l=g("td").css("textcenter").text(e.elo.toLocaleString()),c=g("td").css("textfame textcenter").add(g("img").css("icon kek").attr("src","/data/ui/currency/fame.svg")).add(g("span").text(e.fame.toLocaleString()));t.add(s).add(a).add(n).add(i).add(o).add(r).add(l).add(c),this.tbody.add(t)}},async loadPlayer(e){const t=await fetch("/api/playerinfo/search",{method:"POST",body:JSON.stringify({name:e,order:"prestige",limit:100,offset:0})}).then((e=>e.json()));for(const s of t)s.name===e&&this.updateInfo([s])},async loadPrestige(){const e=[];for(let t=0;t<10;t++)e.push({method:"POST",url:"/api/playerinfo/search",data:{name:"",order:"prestige",limit:100,offset:100*t}});const t=e.map((async e=>(await fetch(e.url,{method:e.method,body:e.data&&JSON.stringify(e.data)})).json())),s=await Promise.all(t),a=[].concat(...s).filter((e=>e.clan===this.clanName));this.state.nextPrestigeCheck=this.getNextWednesdayMidnightUTC(),this.updateInfo(a)}};window.ci=Te;const Ee=new class{constructor(){this.myAudioContext=new AudioContext,this.volume=50,this.melodies={H_2_1:[[50,784,80],[50,988,80]],H_2_2:[[50,659,80],[50,880,80]],L_2_1:[[50,392,80],[50,494,80]],L_2_2:[[50,329,80],[50,440,80]],H_3_1:[[50,784,80],[50,988,80],[50,1174,80]],H_3_2:[[50,659,80],[50,784,80],[50,988,80]],L_3_1:[[50,392,80],[50,440,80],[50,494,80]],L_3_2:[[50,329,80],[50,392,80],[50,440,80]],H_4_1:[[50,784,80],[50,880,80],[50,988,80],[50,1047,80]],H_4_2:[[50,659,80],[50,784,80],[50,880,80],[50,988,80]],L_4_1:[[50,392,80],[50,440,80],[50,494,80],[50,523,80]],L_4_2:[[50,329,80],[50,392,80],[50,440,80],[50,494,80]]}}getMelodies(){return Object.keys(this.melodies)}note(e,t,s){return new Promise(((a,n)=>{e=e||200,t=t||440,s=(s||100)*this.volume;try{let n=this.myAudioContext.createOscillator(),i=this.myAudioContext.createGain();n.connect(i),n.frequency.value=t,n.type="square",i.connect(this.myAudioContext.destination),i.gain.value=.01*s,n.start(this.myAudioContext.currentTime),n.stop(this.myAudioContext.currentTime+.001*e),n.onended=()=>{a()}}catch(e){n(e)}}))}setVolume(e){this.volume=e/100}play(e="L_4_2"){if(0!=e)return this.melodies[e].reduce(((e,t)=>e.then((()=>this.note(t[0],t[1],t[2])))),Promise.resolve())}},Le={name:"Notify",description:"Instant visual and auditory notifications.",state:{volume:50,itemEquip:0,chatGM:0,chatParty:0,chatClan:0,chatPvP:0},settings:{volume:{control:"range",desc:"Notify Volume",comment:"Control notification sound intensity.",min:0,max:100,after:"playExample"},itemEquip:{control:"sound",desc:"Item Equip",comment:"For gear swapping",options:Ee.getMelodies()},chatGM:{control:"sound",desc:"GM Talk",comment:"For GMs messages",options:Ee.getMelodies()},chatParty:{control:"sound",desc:"Party Message",comment:"For new party messages",options:Ee.getMelodies()},chatClan:{control:"sound",desc:"Clan Message",comment:"For new clan messages",options:Ee.getMelodies()},chatPvP:{control:"sound",desc:"Killing Blow",comment:"For your kills",options:Ee.getMelodies()}},start(){o.on("ui.contextMenu",this.contextMenuHandler,this),o.on("ui.chatArticle",this.chatArticleHandler,this),Ee.setVolume(this.state.volume),this.playerName=B.playerName},stop(){o.off("ui.chatArticle",this.contextMenuHandler,this),o.off("ui.chatArticle",this.chatArticleHandler,this)},playExample(){Ee.setVolume(this.state.volume),Ee.play()},chatArticleHandler(e){const{channelType:t,text:s}=e.obj,{chatParty:a,chatPvP:n,chatClan:i,chatGM:o}=this.state;a&&"party"==t&&Ee.play(a),i&&"clan"==t&&Ee.play(i),o&&"GM"==t&&Ee.play(o),n&&"pvp"==t&&s.children[0].children[2].innerText===this.playerName&&Ee.play(a)},contextMenuHandler(e){for(const t of e.element.children)"Equip item"===t.innerText&&(i(t.innerText),t.addEventListener("pointerup",(()=>{Ee.play(this.state.itemEquip)})))}},Pe={name:"Merchant Filters",description:"For those who asked",style:"\n        .kekant {\n            grid-area: ff;\n            padding: 8px 5px 16px;\n            display: grid;\n            grid-template-columns: 4fr 1fr;\n        }\n    ",start(){o.on("ui.merchantParent",this.merchantHandler,this),o.on("uiclose.merchantParent",this.merchantDestruct,this)},stop(){o.off("ui.merchantParent",this.merchantHandler,this),o.off("uiclose.merchantParent",this.merchantDestruct,this)},merchantHandler(e){const t=window.fetch;window.fetch=(e,s)=>t(e,s).then((t=>new Promise((a=>{e.endsWith("getAuction")?(this.list=JSON.parse(s.body).ids,t.clone().json().then((e=>{this.transform(e),a(t)}))):a(t)})))),this.originalFetch=t,this.inject(e.element)},merchantDestruct(){this.qualityFilter=0,window.fetch=this.originalFetch},stats:["Strength","Stamina","Dexterity","Intelligence","Wisdom","Luck","HP","MP","HP Reg./5s","MP Reg./5s","Min Dmg.","Max Dmg.","Defense","Block","Critical","Move Spd.","Haste","Attack Spd.","Item Find","Bag Slots"],inject(e){this.merchantList=e.querySelector(".buytable").children[1];const t=e.querySelector(".layout");t.style.gridTemplate="'s s s' auto 'c i ff' auto 'p p p' auto/1fr 5fr 150px",t.style.width="880px";const s=g("section").css("choices border grey scrollbar kekant"),a=g("div").css("textprimary").text("Filters:").style({gridColumn:"span 2"}),n=g("div").style({gridColumn:"span 2"});s.add(a).add(n),this.filters=Array(this.stats.length).fill(0);for(const e of["Strength","Intelligence","Dexterity","Wisdom",null,"Critical","Haste",null,"Min Dmg.","Max Dmg.",null,"Stamina","Defense","Block"]){const t=g("div").text(e),a=e&&g("div").css("btn checkbox").on("click",(()=>{a.toggle("active");const t=this.stats.indexOf(e);this.filters[t]^=1,this.filter()}))||g("div");s.add(t).add(a)}s.add(g("div")).add(g("div")),s.add(g("div").css("textprimary").text("Quality")).add(g("div"));const i={Common:{color:"white",value:0},Uncommon:{color:"green",value:50},Rare:{color:"blue",value:70},Epic:{color:"purp",value:90},"99+":{color:"orange",value:99}},o=g("select").css("btn grey").style({gridColumn:"span 2",height:"30px"}).on("change",(e=>{this.qualityFilter=e.target.value,this.filter()}));for(const[e,t]of Object.entries(i)){const s=g("option").css(`text${t.color}`).attr("value",t.value).text(e);o.add(s)}s.add(o),t.appendChild(s.element)},transform(e){for(const t of e){const e=this.list.indexOf(t.id);if(["amulet","armlet","bag","boot","bow","armor","glove","hammer","orb","quiver","ring","shield","staff","sword","totem"].includes(t.type)){let s=new Y(t.id);s.hydrate(t),this.list[e]=s}else t.auction=new Date(t.auction),t.stats=new Map,this.list[e]=t}this.waitForMerchantList().then((()=>{this.filter()}))},waitForMerchantList(){return new Promise((e=>{const t=setInterval((()=>{this.merchantList.children.length==this.list.length&&(clearInterval(t),e())}),100)}))},filter(){for(let e=0;e<this.merchantList.children.length;e++){let t=!0;for(let s=0;s<this.filters.length;s++){if(this.list[e].quality<this.qualityFilter){t=!1;break}if(1===this.filters[s]&&!this.list[e].stats.has(s)){t=!1;break}}this.merchantList.children[e].style.display=t?"":"none"}}};window.mr=Pe;const Ie={name:"Timers",description:"Enhance time-related features within a game.",state:{isTitle:0},settings:{isTitle:{control:"checkbox",desc:"Show Widget Title",comment:"show/hide title 'Time:'",onupdate:"updateBtnTitle"}},style:"\n        .kektimers {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            grid-gap: 8px;\n            padding: 8px;\n        }\n        .kektimers>.span{\n            grid-column: span 2;\n        }\n        .kektimers>.period {\n            margin-top: 4px;\n        }\n        .kektimers>.custom {\n            margin-bottom: 4px;\n        }\n        .kektimers>.time {\n            font-family: monospace;\n        }\n    ",start(){p?.partyBtnbar?.element&&this.addBtn(p.partyBtnbar.element),o.on("ui.partyBtnbar",this.addBtn,this),this.createFrame()},stop(){p.partyBtnbar.element&&p.partyBtnbar.element.removeChild(this.btn.element),o.off("ui.partyBtnbar",this.addBtn,this)},addBtn(e){e=e.element,this.btnLabel=g("span").css("textexp").text(""+(this.state.isTitle?"Time: ":"")),this.btnText=g("span").css("textgreen").text("."),this.btn=g("div").css("btn border black textgrey").on("mouseenter",this.showFrame.bind(this)).on("mouseleave",(()=>this.removeFrameDelay(100))).add(this.btnLabel).add(this.btnText),e.appendChild(this.btn.element),this.updateBtnTimer()},updateBtnTitle(){this.btnLabel.text(""+(this.state.isTitle?"Time: ":""))},updateBtnInfo(){const e=(new Date).getUTCHours();e%3==0?this.btnText.text("Obelisks"):e%3==1?this.btnText.text("Gloomfury"):e%3==2&&this.btnText.text("Idle")},updateBtnTimer(){this.updateBtnInfo();var e=new Date,t=1e3*(60*(59-e.getUTCMinutes())+(60-e.getUTCSeconds()));setTimeout((()=>{this.updateBtnInfo(),setInterval(this.updateBtnInfo.bind(this),36e5)}),t)},toggleFrame(){Array.from(p.mainContainer.element.children).some((e=>e===this.frame.element))?this.removeFrame():this.showFrame()},timers:{Obelisks:108e5,"Last Obelisk":75e5,Gloomfury:72e5,"Gloomfury spawn":684e4,"Idle time":36e5,"Next Obelisks":0,"Next Gloomfury":-36e5},timerElements:{},createFrame(){const e=g("div").css("window panel-black kektimers").on("mouseleave",(()=>this.removeFrameDelay(100))).on("mouseenter",(()=>clearTimeout(this.frameTimer))).add(g("h3").css("textprimary span period").text("Time Periods"));for(const t of Object.keys(this.timers))e.add(g("span").text(t)),this.timerElements[t]=g("span").css("textcenter time").text("--:--:--"),e.add(this.timerElements[t]);e.add(g("div").css("span").text("---")),e.add(g("span").css("textexp").text("Weekly restart")),this.timerElements["Weekly restart"]=g("span").css("textcenter time").text("--:--:--"),e.add(this.timerElements["Weekly restart"]),this.frame=e},showFrame(){clearTimeout(this.frameTimer);const e=this.btn.element.getBoundingClientRect();this.frame.style({position:"fixed",top:e.bottom+1+"px",left:e.left+"px",zIndex:99}),p.mainContainer.element.appendChild(this.frame.element),this.frameOn=!0,this.update(),clearInterval(this.frameUpdateIntervalID),this.frameUpdateIntervalID=setInterval(this.update.bind(this),1e3)},removeFrameDelay(e){this.frameTimer=this.frameOn&&setTimeout(this.removeFrame.bind(this),e)},removeFrame(){clearTimeout(this.frameTimer),p.mainContainer.element.removeChild(this.frame.element),clearInterval(this.frameUpdateIntervalID)},update(){i();let e=new Date,t=new Date(e.getTime()+60*e.getTimezoneOffset()*1e3);const s=t.getHours(),a=3*Math.ceil(s/3)+(s%3==0?3:0),n=new Date(t.getFullYear(),t.getMonth(),t.getDate(),a,0,0,0);for(const[e,s]of Object.entries(this.timers)){const a=n-t-s;if(a<0)this.timerElements[e].text("↓");else{let t=a/1e3;const s=Math.floor(t/3600);t%=3600;const n=Math.floor(t/60),i=Math.floor(t%60);s>0?this.timerElements[e].text(`${s}:${n.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`):this.timerElements[e].text(`${n}:${i.toString().padStart(2,"0")}`)}}const o=new Date,r=o.getUTCDay(),l=24*(3===r?7:(3-r+7)%7)*60*60*1e3,c=new Date(o.getTime()+l);c.setUTCHours(0,0,0,0);const d=c.getTime()-o.getTime(),h=Math.floor(d/864e5),m=Math.floor(d%864e5/36e5),p=Math.floor(d%36e5/6e4),u=Math.floor(d%6e4/1e3);this.timerElements["Weekly restart"].text(`${h}d ${m}:${p.toString().padStart(2,"0")}:${u.toString().padStart(2,"0")}`)}};window.timer=Ie;const Me={name:"Party Button Tweaks",description:"Party button appearance and functionality",state:{isBlack:1,isAuto:0},settings:{isBlack:{control:"checkbox",desc:"Black Color",comment:"Change the color of the party button.",onupdate:"handle"},isAuto:{control:"checkbox",desc:"Auto Controls",comment:"Mouse Left: Create/Leave, Right: Menu.",onupdate:"handle"}},start(){o.on("ui.partybtn",this.handle,this)},stop(){o.off("ui.partybtn",this.handle,this)},handle(){const e=p.partybtn.element;e.innerText="Party",this.state.isBlack?(e.classList.add("black"),e.classList.add("textparty")):(e.classList.remove("black"),e.classList.remove("textparty")),this.state.isAuto?(e.addEventListener("mouseup",this.control.bind(this)),o.on("ui.contextMenu",this.contextMenu,this)):e.removeEventListener("mouseup",this.control.bind(this),o.off("ui.contextMenu",this.contextMenu,this))},autoAction:-1,control(e){0===e.button?this.autoAction=0:2===e.button&&(this.autoAction=2,e.target.click())},contextMenu(e){if(i(this.autoAction),!(this.autoAction<0)){if(0===this.autoAction){for(const t of e.element.children)["Create Party","Leave Party"].includes(t.innerText)&&t.dispatchEvent(new MouseEvent("mouseup",{bubbles:!0,cancelable:!0,view:window}));this.autoAction=-1}this.autoAction=-1}},disbandParty(){this.autoAction=99,p.partyframes.element.childNodes.forEach((e=>{if(1===e.nodeType&&"star."!=e.children[1]?.children[1]?.attributes.src.nodeValue.substring(15,20)){e.children[1]?.children[0]?.children[0].children[0].dispatchEvent(new MouseEvent("contextmenu",{bubbles:!0,cancelable:!0,view:window}));for(const e of p.contextMenu.element.children)i(e.innerText),"Party kick"===e.innerText&&e.dispatchEvent(new MouseEvent("mouseup",{bubbles:!0,cancelable:!0,view:window}))}}))}};class Be{constructor(e){this.x=e?.x||"50%",this.y=e?.y||"50%",this.draggable=e?.draggable;const t="number"==typeof this.x,s="number"==typeof this.y,a=`translate(${t?"0":"-50%"}${s?"":",-50%"})`;this.pos=g("div").css("window-pos kek").style({position:"absolute",transformOrigin:`${t?"left":"center"} ${s?"top":"center"}`,transform:a,left:this.x,top:this.y,zIndex:10}),this.container=g("div").css("window panel-black").style({padding:"5px",transformOrigin:"inherit",minWidth:"fit-content",maxWidth:"1000px",maxHeight:"850px"}).to(this.pos),e?.title&&(this.container.style({display:"grid",gridTemplateRows:"30px 1fr",gridGap:"4px"}),this.titlebar(e.title)),this.slot=g("div").css("slot").style({height:"100%",minWidth:"fit-content"}).to(this.container)}titlebar(e){this.titlebar=g("div").css("titleframe").style({display:"flex",alignItems:"center",letterSpacing:"0.5px",cursor:"pointer"}).to(this.container),g("div").css("textprimary title").text(e).style({width:"100%",paddingLeft:"4px",fontWeight:"bold"}).to(this.titlebar),this.closeBtn=g("img").css("btn black svgicon").attr("src","/data/ui/icons/cross.svg").on("click",this.remove.bind(this)).to(this.titlebar)}show(){this.pos.style({position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:99}),p.mainContainer.element.appendChild(this.pos.element),this.isOn=!0}remove(){p.mainContainer.element.removeChild(this.pos.element),this.isOn=!1}}var Ae=["amulet","armlet","bag","book","boot","bow","armor","glove","hammer","misc","orb","quiver","ring","rune","shield","staff","sword","mount","totem","box","charm","pet"],Ne=["common","uncommon","rare","epic"],De=["Strength","Stamina","Dexterity","Intelligence","Wisdom","Luck","HP","MP","HP Reg./5s","MP Reg./5s","Min Dmg.","Max Dmg.","Defense","Block","Critical","Move Spd.","Haste","Attack Spd.","Item Find","Bag Slots","Prestige","Rating","Stat Points","Skill Points","Skill Points (Max)","Gear Score","PvP Level","% Increased Dmg.","% Increased Aggro Generation","% Movement Spd. Reduction","Healing Reduction"];const qe=e=>new Fe(e);class Fe{constructor(e){this.config={search:!0,height:"15rem",placeholder:"select",txtSelected:"selected",txtAll:"All",txtRemove:"Remove",txtSearch:"search",...e},this.create()}create(){this.select=g("div").css("multiselect").attr("tabindex",0).style({fontSize:".9em",boxSizing:"border-box",display:"inline-block",padding:"5px 8px",borderRadius:"3px",border:"3px solid #a4bfc5",backgroundColor:"#27353f",position:"relative",backgroundImage:"url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23dae8ea' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e\")",backgroundRepeat:"no-repeat",backgroundPosition:"right .75rem center",backgroundSize:"16px 12px",width:"100%",color:"#dae8ea"}).on("click",(()=>{this.list.element.style.display="block"===this.list.element.style.display?"none":"block"})).on("blur",(()=>{this.list.element.style.display="none"})),this.list=g("div").css("multiselect-list").style({backgroundColor:"#151a24",height:this.config.height,display:"none",overflowY:"auto",overflowX:"hidden",position:"absolute",top:"30px",left:0,scrollbarWidth:"thin",scrollbarColor:"#5b858e rgba(0,0,0,0)",color:"#a6dcd5",width:"-webkit-fill-available",zIndex:99,paddingTop:"6px"}),this.select.add(this.list),this.values=g("div"),this.select.add(this.values);for(const e of this.config.options){if(""===e){this.list.add(g("div").style({marginTop:"12px"}));continue}const t=g("div").style({padding:"3px 6px"}).on("mouseenter",(e=>{e.stopPropagation(),e.target.style.background="#1967d2",e.target.style.color="#a6dcd5"})).on("mouseleave",(e=>{e.stopPropagation(),e.target.style.background="",e.target.style.color=""})).on("click",(e=>{e.stopPropagation(),t.element.children[0].classList.toggle("active"),this.update()})),s=g("div").css("btn checkbox"),a=g("div").text(e).style({paddingLeft:"0.7em",display:"inline-block"});t.add(s).add(a),this.list.add(t)}this.element=this.select.element,this.update()}set(e){for(const t of this.list.element.children)e.includes(t.children[1]?.innerText)?t.children[0].classList.add("active"):t.children[0]?.classList.remove("active");this.update()}clear(){for(const e of this.list.element.children)e.children[0]?.classList.remove("active");this.update()}update(){this.values.clear(),this.selected=[];for(const e of this.list.element.children)if(e.children[0]?.classList.contains("active")){const t=g("span").style({marginRight:"0.5em"}).text(e.children[1].textContent);this.values.add(t),this.selected.push(e.children[1].textContent)}if(0===this.selected.length){const e=g("span").style({color:"#759ea7"}).text(this.config.placeholder);this.values.add(e)}}}const Re={name:"Item Filters",description:"Back to the Filters Part III.",state:{filters:{},preset:""},style:"\n        th, td {\n            max-width: 200px;\n        }\n        td.selected {\n            background-color: #f5c24733\n        }\n        td.selected:nth-child(odd) {\n            background-color: #f5c24740;\n        }\n    ",filters:{},defaultFilters:{BIS:[[1,4,270713,0,"",0,0,0,0,"#ff9500"],[1,8,270709,0,"",0,0,0,0,"#ff9500"],[1,1,262524,0,"",0,0,0,0,"#ff9500"],[1,16,270701,0,"",0,0,0,0,"#ff9500"],[210,16,271277,0,"",0,0,0,0,"#ff9500"],[210,4,271289,0,"",0,0,0,0,"#ff9500"],[210,8,271285,0,"",0,0,0,0,"#ff9500"],[210,1,263100,0,"",0,0,0,0,"#ff9500"],[4,4,271353,0,"",0,0,0,0,"#ff9500"],[4,8,271349,0,"",0,0,0,0,"#ff9500"],[4,1,263164,0,"",0,0,0,0,"#ff9500"],[4,16,271341,0,"",0,0,0,0,"#ff9500"],[32,4,271353,0,"",0,0,0,0,"#ff9500"],[256,16,271341,0,"",0,0,0,0,"#ff9500"],[1024,8,270837,0,"",0,0,0,0,"#ff9500"],[2048,4,270841,0,"",0,0,0,0,"#ff9500"],[4096,16,271149,0,"",0,0,0,0,"#ff9500"],[16384,1,262652,0,"",0,0,0,0,"#ff9500"],[32768,8,271349,0,"",0,0,0,0,"#ff9500"],[65536,1,263164,0,"",0,0,0,0,"#ff9500"],[262144,16,270829,0,"",0,0,0,0,"#ff9500"]]},start(){o.on("ui.bagParent",this.inject,this),o.on("ui.characterParent",this.charHandler,this),o.on("ui.stashParent",this.stashHandler,this),this.extractFilters()},stop(){o.off("ui.bagParent",this.inject,this)},charHandler(e){this.slotsCharacter=e.element.querySelector(".items")},stashHandler(e){this.slotDescriptionStash=e.element.querySelectorAll(".slotparent")[0],this.slotsStash=e.element.querySelectorAll(".slotcontainer")},inject(e){const t=e.element.children[0].children[1];this.slots=t.querySelector(".slotcontainer");const s=g("div").style({display:"grid",gridTemplateColumns:"1fr auto",gridGap:"4px",marginBottom:"8px"});this.presetSelect=g("select").css("btn grey").on("input",(e=>{this.state.preset=e.target.value})),this.updatePresetSelect(),this.enabled=0;const a=g("div").css("btn border grey").text("Filter").on("pointerup",(e=>{0==e.button?(this.enabled^=1,a.toggle("grey").toggle("orange"),this.enabled?this.slotsParser():this.slotsReset()):2==e.button&&this.showSettings()}));s.add(this.presetSelect).add(a),t.insertBefore(s.element,t.firstChild),t.children[1].style.display="none"},updatePresetSelect(){this.presetSelect.clear();for(const e in this.filters){const t=g("option").text(e);e===this.state.preset&&t.attr("selected",1),this.presetSelect.add(t)}},slotsParser(){const e=(e,t)=>{if(!e)return;let s=0;for(let a of e.children){if(!a.classList.contains("filled"))continue;const e=new MutationObserver(((e,n)=>{if(e.some((e=>"childList"===e.type))){let e;e=t?t.querySelectorAll(".slotdescription")[s++]:a.querySelector(".slotdescription"),e&&(n.disconnect(),this.slotsHighlight(a,e),a.dispatchEvent(new PointerEvent("pointerleave")))}}));t?e.observe(t,{childList:!0}):e.observe(a,{childList:!0}),a.dispatchEvent(new PointerEvent("pointerenter"))}};if(this.slots&&e(this.slots,null),this.slotsStash)for(const t of this.slotsStash)e(t,this.slotDescriptionStash);this.slotsCharacter&&e(this.slotsCharacter,null)},meetsFilterCriteria(e,t){if(t[0].length&&!t[0].includes(e.type))return!1;if(t[1].length){if(t[1].map((e=>De.indexOf(e))).some((t=>0===e.stats[t])))return!1}if(t[2].length){if(t[2].map((e=>De.indexOf(e))).some((t=>0!==e.stats[t])))return!1}return!(t[3].length&&!t[3].includes(e.rarity))&&(!(t[4]&&!e.name.includes(t[4]))&&(!(t[5]>0&&t[5]>=e.gs||t[5]<0&&Math.abs(t[5])<=e.gs)&&(!(t[6]>0&&t[6]>=e.quality||t[6]<0&&Math.abs(t[6])<=e.quality)&&(!(t[7]>0&&t[7]>=e.upgrade||t[7]<0&&Math.abs(t[7])<=e.upgrade)&&!(t[8]>0&&t[8]>=e.gold||t[8]<0&&Math.abs(t[8])<=e.gold)))))},slotsHighlight(e,t){const s=(e=>{const t=e.children[0],s=t.children[0],a=s.children[0],n=a.childNodes[1].textContent,i=a.childNodes[2].textContent;let o=0;i&&i.length>2&&(o=parseFloat(i.slice(2)));const r=s.children[1],l=r.childNodes[0].textContent,c=r.childNodes[2].textContent,d=r.childNodes[4].textContent;let h=0;d&&d.length>1&&(h=parseFloat(d.slice(0,-1)));const m=s.children[2];let p,u;2===m.childNodes.length?(p=0,u=parseFloat(m.children[0].childNodes[1].textContent)):(p=parseFloat(m.children[0].childNodes[1].textContent),u=parseFloat(m.children[1].childNodes[1].textContent));const g=Array(De.length).fill(0);if("misc"!==c&&"charm"!==c){const e=t.children[1];for(let t=0;t<e.children.length;t++){const s=e.children[t],a=s.childNodes[3].textContent;let n=s.childNodes[1].textContent;n.endsWith("%")&&(n=n.slice(0,-1));const i=De.indexOf(a);-1!==i&&("Damage"===a?(g[i]=parseFloat(s.childNodes[0].textContent),g[i+1]=parseFloat(s.childNodes[2].textContent)):g[i]=parseFloat(n))}}const f=t.children[3].textContent.replace(/\s+/g,"");return{name:n,upgrade:o,quality:h,rarity:l,type:c,gs:p,id:u,stats:g,gold:parseFloat(f)}})(t),a=this.filters[this.state.preset];for(const t of a){if(this.meetsFilterCriteria(s,t)){e.style.filter="",e.style.border="3px solid "+t[9];break}e.style.filter="grayscale(1) brightness(0.5)"}},slotsReset(){if(this.slots)for(let e of this.slots.children)e.style.filter="",e.style.border="";if(this.slotsCharacter)for(let e of this.slotsCharacter.children)e.style.filter="",e.style.border="";if(this.slotsStash)for(const e of this.slotsStash)for(let t of e.children)t.style.filter="",t.style.border=""},filtersToBitnum(e,t){const s={};for(let e=0;e<t.length;e++)s[t[e]]=e;let a=0;for(let t=0;t<e.length;t++){const n=s[e[t]];void 0!==n&&(a|=1<<n)}return a},bitnumToFilters(e,t){const s=[];for(let a=0;a<t.length;a++)0!=(e&1<<a)&&s.push(t[a]);return s},helper:e=>g("span").css("textyellow").style({marginLeft:"0.4em"}).text("(?)").on("pointerenter",(t=>{const{top:s,left:a}=t.target.getBoundingClientRect(),{top:n,left:i}=t.target.offsetParent.getBoundingClientRect(),o=g("div").css("panel-black textyellow").style({position:"absolute",top:s-n+t.target.offsetHeight-20+"px",left:a-i+30+"px",width:"250px",zIndex:99}).text(e);t.target.offsetParent.appendChild(o.element)})).on("pointerleave",(e=>{const t=e.target.offsetParent.lastChild;t&&t.parentNode.removeChild(t)})),showSettings(){this.frame=new Be({title:"Filter Settings",y:100}),this.filtersTable=g("div").css("scrollbar").style({width:"900px",minHeight:"400px",maxHeight:"400px"}).on("pointerup",(e=>{const t=e.target;if("TD"===t.tagName){const s=t.closest("tr"),a=s?s.rowIndex:-1;-1!==a&&(0===e.button?(this.newRecordContainer.element.style.display="grid",this.selectFilters(a-1)):2===e.button&&this.removeFilters(a-1))}}));const e=this.presetContainer();this.frame.slot.add(e),this.newRecordContainer=g("div").css("panel-bright").style({display:"none",gridTemplateColumns:"auto 170px 65px 50px 110px 50px 110px 40px 70px 100px",gridGap:"4px",padding:"8px"});const t="span 9",s=g("div").css("btn textright textgreen").text("Type");this.typeSelect=qe({options:["sword","staff","bow","hammer","","shield","orb","quiver","totem","","armor","armlet","boot","glove","","amulet","bag","ring","","book","rune","misc","","mount","box","charm","pet"],height:"18rem",placeholder:"ANY selected checked against item TYPE, or leave empty to ignore"}),this.typeSelect.element.style.gridColumn=t,this.newRecordContainer.add(s).add(this.typeSelect);const a=["","Strength","Intelligence","Dexterity","Wisdom","","Critical","Haste","","Min Dmg.","Max Dmg.","","Stamina","Defense","Block","","Luck","Item Find","HP","MP","HP Reg./5s","MP Reg./5s","Move Spd.","Attack Spd."],n=g("div").css("btn textright textgreen").text("Stats +");this.statSelect=qe({options:a,height:"17rem",placeholder:"ALL selected checked against item STATS, or leave empty to ignore"}),this.statSelect.element.style.gridColumn=t,this.newRecordContainer.add(n).add(this.statSelect);const i=g("div").css("btn textright textred").text("Stats -");this.nstatSelect=qe({options:a,height:"17rem",placeholder:"ALL selected checked to be excluded from item STATS, or leave empty to ignore"}),this.nstatSelect.element.style.gridColumn=t,this.newRecordContainer.add(i).add(this.nstatSelect);const o=g("div").css("btn textright textgreen").text("Rarity");this.raritySelect=qe({options:Ne,height:"7rem",placeholder:"ANY selected checked against item RARITY, or leave empty to ignore"}),this.raritySelect.element.style.gridColumn=t,this.newRecordContainer.add(o).add(this.raritySelect);const r=g("div").css("btn textright textgreen").text("Name").add(this.helper("Enter part of item name to include in the item name. For example, 'Lv. 5' will show all books level 5."));this.nameSelect=g("input").type("text").attr("placeholder","..."),this.newRecordContainer.add(r).add(this.nameSelect);const l="0",c=g("div").css("btn textright textgreen").text("GS").add(this.helper("Enter gear score of item. Use a negative number for less than or equal, and a positive number for more than or equal. For example, -50 will include all items with a gear score less than or equal to 50. Leave empty to ignore this filter."));this.gsSelect=g("input").type("number").attr("placeholder",l),this.newRecordContainer.add(c).add(this.gsSelect);const d=g("div").css("btn textright textgreen").text("Quality %").add(this.helper("Enter Quality % of item. Use a negative number for less than or equal, and a positive number for more than or equal. For example, -50 will include all items with Quality % less than or equal to 50. Leave empty to ignore this filter."));this.qualitySelect=g("input").type("number").attr("placeholder",l),this.newRecordContainer.add(d).add(this.qualitySelect);const h=g("div").css("btn textright textgreen").text("Upgrade").add(this.helper("Enter upgrade level of item. Use a negative number for less than or equal, and a positive number for more than or equal. For example, -3 will include all items with upgrade level less than or equal to 3. Leave empty to ignore this filter."));this.upgradeSelect=g("input").type("number").attr("placeholder",l),this.newRecordContainer.add(h).add(this.upgradeSelect);const m=g("div").css("btn textright textgreen").text("Cost").add(this.helper("Enter cost of item. Use a negative number for less than or equal, and a positive number for more than or equal. For example, -10000 will include all items with cost less than or equal to 1 gold coin. Leave empty to ignore this filter."));this.goldSelect=g("input").type("number").attr("placeholder",l),this.newRecordContainer.add(m).add(this.goldSelect);const p=g("div").css("btn textright textgreen").text("Color").add(this.helper("Select a color for the rule to highlight filtered items."));this.colorSelect=g("input").type("color").style({height:"100%"}),this.newRecordContainer.add(p).add(this.colorSelect);const u=g("div").css("btn grey").style({gridColumn:"span 7",width:"80px",marginLeft:"auto",textAlign:"center"}).text("Clear").on("click",(()=>{this.addFilters([this.typeSelect.clear(),this.statSelect.clear(),this.nstatSelect.clear(),this.raritySelect.clear(),this.nameSelect.element.value="",this.gsSelect.element.value="",this.qualitySelect.element.value="",this.upgradeSelect.element.value="",this.goldSelect.element.value="",this.colorSelect.element.value="#FF9500"]),this.updateFilters()})),f=g("div").css("btn green").style({width:"80px",marginLeft:"auto",textAlign:"center"}).text("Save").on("click",(()=>{this.addFilters([this.typeSelect.selected,this.statSelect.selected,this.nstatSelect.selected,this.raritySelect.selected,this.nameSelect.element.value||"",parseFloat(this.gsSelect.element.value||0),parseFloat(this.qualitySelect.element.value||0),parseFloat(this.upgradeSelect.element.value||0),parseFloat(this.goldSelect.element.value||0),this.colorSelect.element.value]),this.updateFilters()}));this.newRecordContainer.add(u).add(f);const y=g("div").css("btn grey textgreen").text("Edit Filter").on("click",(()=>{const e="none"===this.newRecordContainer.element.style.display?"grid":"none";this.newRecordContainer.element.style.display=e})),b=g("span").css("textgrey").text(" (table left click - select record and fill the form, right - delete record)"),v=g("div").css("textgrey").style({float:"right"}).text("▼");y.add(b).add(v),this.frame.slot.add(y),this.frame.slot.add(this.newRecordContainer),this.updateFilters(),this.frame.slot.add(this.filtersTable),this.frame.show()},presetContainer(){const e=g("div").css("panel-black").style({display:"grid",gridTemplateColumns:"auto 400px 1fr auto auto auto auto auto",gridGap:"4px",marginBottom:"4px"});g("span").css("btn textprimary").text("Preset:").to(e);const t=g("div").to(e),s=g("div").style({display:"grid",gridTemplateColumns:"1fr auto auto",gridGap:"4px"}).to(t),a=()=>{s.clear();const e=g("select").css("btn grey").on("input",(e=>{this.state.preset=e.target.value,this.updatePresetSelect(),this.updateFilters()})).to(s);for(const t in this.filters){const s=g("option").text(t);t===this.state.preset&&s.attr("selected",1),e.add(s)}this.updateFilters()};a();const n=()=>g("div").css("btn orange").text("Cancel").to(s).on("click",(()=>{a()})),i=()=>{s.clear();const e=g("input").style({padding:"unset"}).type("text").value(this.state.preset).to(s);g("div").css("btn green").text("Rename").to(s).on("click",(()=>{this.filters[e.element.value]=this.filters[this.state.preset],this.state.filters[e.element.value]=this.state.filters[this.state.preset],delete this.filters[this.state.preset],delete this.state.filters[this.state.preset],this.state.preset=e.element.value,this.updatePresetSelect(),a()})),n()},o=()=>{s.clear();const e=g("input").style({padding:"unset"}).type("text").to(s);g("div").css("btn green").text("Create").to(s).on("click",(()=>{this.filters[e.element.value]=[],this.state.filters[e.element.value]=[],this.state.preset=e.element.value,this.updatePresetSelect(),a()})),n()},r=()=>{s.clear();const e=g("input").style({padding:"unset"}).type("text").to(s);g("div").css("btn green").text("Import").to(s).on("click",(()=>{if(e.element.value){const t=JSON.parse(e.element.value),s=Object.keys(t)[0],a=t[s];this.state.filters[s]=a,this.state.preset=s,this.extractFilters()}a()})),n()},l=()=>{const e={};e[this.state.preset]=this.state.filters[this.state.preset],s.clear();const t=g("input").style({padding:"unset"}).type("text").value(JSON.stringify(e)).to(s);g("div").css("btn green").text("Copy").to(s).on("click",(()=>{navigator.clipboard.writeText(t.element.value),a()})),n()},c=()=>{s.clear(),g("span").css("btn red textwhite").text("'"+this.state.preset+"' WILL BE DELETED!").to(s),g("div").css("btn red").text("Delete").to(s).on("click",(()=>{delete this.filters[this.state.preset],delete this.state.filters[this.state.preset],this.state.preset=Object.keys(this.state.filters)[0]||"",""===this.state.preset&&this.importDefault(),this.updatePresetSelect(),a()})),n()};return g("div").to(e),g("div").css("btn cyan").text("Rename").on("click",(()=>{i()})).to(e),g("div").css("btn green").text("Create").on("click",(()=>{o()})).to(e),g("div").css("btn grey").text("Import").on("click",(()=>{r()})).to(e),g("div").css("btn grey").text("Export").on("click",(()=>{l()})).to(e),g("div").css("btn red").text("Delete").on("click",(()=>{c()})).to(e),e},importDefault(){this.state.filters={...this.defaultFilters},this.state.preset=Object.keys(this.defaultFilters)[0],this.extractFilters()},selectFilters(e){const t=this.filters[this.state.preset][e];this.typeSelect.set(t[0]),this.statSelect.set(t[1]),this.nstatSelect.set(t[2]),this.raritySelect.set(t[3]),this.nameSelect.element.value=t[4]||"",this.gsSelect.element.value=t[5]||"",this.qualitySelect.element.value=t[6]||"",this.upgradeSelect.element.value=t[7]||"",this.goldSelect.element.value=t[8]||"",this.colorSelect.element.value=t[9],i()},removeFilters(e){this.filters[this.state.preset].splice(e,1),this.compactFilters(),this.updateFilters()},addFilters(e){const t=e.slice(0,9).flat().join("");if(i(),!t)return;const s=this.filters[this.state.preset],a=s.findIndex((e=>e.slice(0,9).flat().join("")===t));-1!==a?s[a]=e:s.push(e),this.compactFilters()},updateFilters(){const e=this.transformFilters(),t=pe(e);this.filtersTable.clear().add(t.element)},transformFilters(){if(Object.prototype.hasOwnProperty.call(this.filters,this.state.preset))return this.filters[this.state.preset].map((e=>({T:e[0].join(", "),"S+":e[1].join(", "),"S-":e[2].join(", "),R:e[3]?.join(", "),N:e[4]||"",GS:e[5]||"",Q:e[6]||"",U:e[7]||"",G:e[8]||"",C:e[9]&&g("div").css("btn").style({background:e[9]})})))},compactFilters(){i(this.state.preset,this.filters[this.state.preset]),this.filters[this.state.preset].sort(((e,t)=>{const s=e[0][0],a=t[0][0];if(s<a)return-1;if(s>a)return 1;{const s=e[1][0],a=t[1][0];return s<a?-1:s>a?1:0}})),this.state.filters[this.state.preset]=[];for(const e of this.filters[this.state.preset]){const t=[];t.push(this.filtersToBitnum(e[0],Ae)),t.push(this.filtersToBitnum(e[1],De)),t.push(this.filtersToBitnum(e[2],De)),t.push(this.filtersToBitnum(e[3],Ne)),t.push(e[4]),t.push(e[5]),t.push(e[6]),t.push(e[7]),t.push(e[8]),t.push(e[9]),this.state.filters[this.state.preset].push(t)}},extractFilters(){if(Object.keys(this.state.filters)[0])for(const e in this.state.filters){this.filters[e]=[];for(const t of this.state.filters[e]){const s=[];s.push(this.bitnumToFilters(t[0],Ae)),s.push(this.bitnumToFilters(t[1],De)),s.push(this.bitnumToFilters(t[2],De)),s.push(this.bitnumToFilters(t[3],Ne)),s.push(t[4]),s.push(t[5]),s.push(t[6]),s.push(t[7]),s.push(t[8]),s.push(t[9]),this.filters[e].push(s)}}else this.importDefault()}},Oe={name:"Chat Log",description:"Move info messages out of chat",state:{log:[[1708901631333,7,"To disable this mod, navigate to:"],[1708901631335,2,"Settings -> [KEK] Mods -> Chat Log -> [ ]"],[1708901631336,0,""],[1708901631337,0,"But we recommend giving it a try first!"],[1708901631338,0,"Believe, a clean chat experience is truly enjoyable."]],chatDark:30,fontSize:14,fontDark:100,width:450,height:240,posBottom:100,posLeft:100,layout:"chat",unfoldDown:0,heightUnfolded:500,isColored:1,isFormated:0,isExpanded:0,killsShow:1,fameShow:1,noteShow:1,sysShow:1,lvlShow:1,expShow:1,invShow:0},style:"\n        .chatlog {\n            padding: 4px;\n            position: absolute;\n            left: 0;\n            bottom: 0;\n            transform-origin: bottom left;\n            height: 240px;\n            width: 450px;\n            max-width: 50%;\n            min-width: 300px;\n            display: grid;\n            grid-template-rows: 1fr 44px;\n            z-index: 2;\n            font-size: 14px;\n        }\n        .chatlog .log {\n            flex: 1 1 auto;\n            overflow-y: scroll;\n            overflow-x: hidden;\n            direction: rtl;\n            scrollbar-width: none;\n        }\n        .chatlog .log::-webkit-scrollbar {\n            display: none\n        }\n        .chatlog .lowercontainer {\n            position: relative\n        }\n        .chatlog .chatlogselect {\n            position: absolute;\n            width: 100%;\n            top: 0;\n            opacity: .15;\n            display: flex;\n            margin-top: 2px;\n            pointer-events: all\n        }\n        .chatlog .chatlogselect>small {\n            line-height: 1em;\n            margin-right: 4px\n        }\n        .chatlog .chatlogselect:hover {\n            opacity: 1\n        }\n        .chatlog .chatlogselect .btn:nth-child(8) {\n            margin-left: auto;\n        }\n        .chatlog .line {\n            text-shadow: 1px 1px #000;\n            overflow: hidden;\n            direction: ltr;\n            display: block;\n        }\n        .chatlog .linewrap {\n            display: inline;\n            border-radius: 3px;\n            background-color: #10131d4d;\n            padding: 0 3px;\n        }\n        .chatlog .time {\n            display: inline-block;\n            font-size: 11px;\n            color: #5b858e;\n            width: 2.8em;\n        }\n        .chatlog .textGM {\n            background-color: #10131dcc;\n        }\n    ",settings:{chatDark:{control:"range",desc:"Background",comment:"Transparency of the log window",step:10,onupdate:"updateFrame"},fontSize:{control:"range",desc:"Font Size",comment:"Default: 14",step:1,onupdate:"updateFrame"},fontDark:{control:"range",desc:"Font Brightness",comment:"Default: 100",min:40,step:1,onupdate:"updateFrame"},width:{control:"range",desc:"Width",comment:"Default: 450",min:300,max:1e3,onupdate:"updateFrame"},height:{control:"range",desc:"Height",comment:"Default: 200",min:70,max:2e3,onupdate:"updateFrame"},layout:{control:"select",desc:"Position",comment:"Log window layout",options:{chat:"Over Chat",tl:"Top Left",br:"Bottom Right",tr:"Top Right",custom:"Custom"},onupdate:"updateFrame"},posLeft:{control:"range",desc:"X",comment:"For custom Position",min:0,max:2e3,onupdate:"updateFrame"},posBottom:{control:"range",desc:"Y",comment:"For custom Position",min:0,max:2e3,onupdate:"updateFrame"},unfoldDown:{control:"checkbox",desc:"Expand down",comment:"Expand direction",onupdate:"updateFrame"},heightUnfolded:{control:"range",desc:"Height Expanded",comment:"Default: 500",min:70,max:2e3,onupdate:"updateFrame"}},logChannelType:["GM","pvp","fame","system","notice","lvlup","inv","error","exp"],start(){o.on("ui.channelSelect",this.showFrame,this),o.on("ui.chatArticle",this.handleArticle,this)},stop(){},showFrame(e){for(const e of p.chatPanel.element.children){const t=h(e);this.logChannelType.includes(t.channelType)&&(e.style.display="none")}const t=e.element.children[3];t.classList.contains("textgrey")&&t.click(),t.style.display="none";const s=e.element.children[4];s.classList.contains("textgrey")&&s.click(),s.style.display="none",this.frame=g("div").css("chatlog container uiscaled"),this.content=g("div").css("log panel scrollbar");const a=g("div").css("lowercontainer"),n=g("div").css("chatlogselect"),i=(e,t,s,a)=>g("small").css(`btn border black text${this.state[e]?s:"grey"}`).text(t).on("click",(t=>{this.state[e]^=1,t.target.classList.toggle(`text${s}`),t.target.classList.toggle("textgrey"),a.call(this)}));this.killBtn=i.call(this,"killsShow","kills","f1",this.updateRecords).to(n),this.fameBtn=i.call(this,"fameShow","fame","fame",this.updateRecords).to(n),this.lootBtn=i.call(this,"noteShow","note","notice",this.updateRecords).to(n),this.rollBtn=i.call(this,"sysShow","sys","system",this.updateRecords).to(n),this.levelBtn=i.call(this,"lvlShow","lvl","lvlup",this.updateRecords).to(n),this.expBtn=i.call(this,"expShow","exp","exp",this.updateRecords).to(n),this.invBtn=i.call(this,"invShow","inv","white",this.updateRecords).to(n),this.formatBtn=i.call(this,"isFormated","Format","exp",this.updateRecords).to(n),this.unfoldBtn=i.call(this,"isExpanded","Expand","exp",this.updateFrame).style({marginRight:"0"}).to(n),a.add(n),this.frame.add(this.content),this.frame.add(a),p.mainContainer.element.appendChild(this.frame.element),this.updateFrame(),this.updateRecords()},updateFrame(){if(this.frame.style({transformOrigin:"bottom left",transform:"unset",top:"unset",bottom:"unset",height:(this.state.isExpanded&&this.state.heightUnfolded||this.state.height)+"px",width:this.state.width+"px"}),"chat"==this.state.layout){const{left:e,top:t}=p.chatPanel.element.getBoundingClientRect();i(p.chatPanel.element.getBoundingClientRect()),this.frame.style({left:e-4+"px",top:t+"px",transform:"translate(0, -100%)"}),this.state.unfoldDown=1}else if("br"==this.state.layout)this.frame.style({transformOrigin:"bottom right",top:"100%",left:"100%",transform:"translate(-100%, -100%)"}),this.state.unfoldDown=0;else if("tr"==this.state.layout){const{bottom:e}=p.urContainer.element.getBoundingClientRect();i(p.urContainer.element.getBoundingClientRect()),this.frame.style({transformOrigin:"top right",top:e+"px",right:"0px",transform:"translate(-100%)"}),this.state.unfoldDown=1}else if("tl"==this.state.layout){const{left:e,bottom:t}=p.partyBtnbar.element.getBoundingClientRect();i(p.partyBtnbar.element.getBoundingClientRect()),this.frame.style({transformOrigin:"top left",top:t+"px",left:e-4+"px"}),this.state.unfoldDown=1}else"custom"==this.state.layout&&this.frame.style({left:this.state.posLeft+"px",bottom:this.state.posBottom+"px"});this.state.fontDark<100?this.content.style({filter:`brightness(${this.state.fontDark}%)`}):this.content.style({filter:"unset"}),this.content.style({background:`rgb(0 0 0 / ${this.state.chatDark}%)`,fontSize:this.state.fontSize+"px"})},updateRecords(){this.content.clear();for(const e of this.state.log)this.showMessage(e)},formatCurrency(e){const t=Math.floor(e/1e4),s=Math.floor(e%1e4/100),a=e%100;let n=g("span");if(this.state.isCompact&&n.style({display:"inline-flex",width:"3em",justifyContent:"end"}),t>0){const e=g("span").css("textgold").text(t+" "),s=g("img").css("texticon").style({paddingRight:"0.15em"}).attr("src","/data/ui/currency/gold.avif");if(e.add(s),n.add(e),this.state.isFormated)return n}if(s>0){const e=g("span").css("textsilver").text(s+" "),t=g("img").css("texticon").style({paddingRight:"0.15em"}).attr("src","/data/ui/currency/silver.avif");if(e.add(t),n.add(e),this.state.isFormated)return n}if(a>0){const e=g("span").css("textcopper").text(a+" "),t=g("img").css("texticon").style({paddingRight:"0.15em"}).attr("src","/data/ui/currency/copper.avif");if(e.add(t),n.add(e),this.state.isFormated)return n}return n},formatDate(e){const t=new Date(e),s=t.getHours().toString().padStart(2,"0"),a=t.getMinutes().toString().padStart(2,"0");t.getSeconds().toString().padStart(2,"0");return g("span").css("time").text(`${s}:${a}`)},formatKill(e,t){const s=g("div"),a=g("span").css(`textf${t[2]}`).text(t[5]),n=g("span").css("textwhite").style({marginRight:"0.3em"}).text(t[7]),i=g("span").css("textwhite").style({marginRight:"0.3em"}).text(t[4]),o=g("span").css("textf"+(1^t[2])).text(t[8]),r=g("span").css("textfame").text(t[9].toLocaleString()),l=this.formatCurrency(t[10]);if(this.state.isFormated)r.style({textAlign:"end"}),l.style({textAlign:"end"}),a.style({textOverflow:"ellipsis",overflow:"hidden"}),o.style({textOverflow:"ellipsis",overflow:"hidden"}),i.css(`textc${t[3]}`),n.css(`textc${t[6]}`),s.style({display:"inline-grid",gridTemplateColumns:"auto 1fr auto 1fr 80px 60px",width:"100%"}).add(i).add(a).add(n).add(o).add(r).add(l);else{const e=g("img").css("icon").style({height:"1.1em",verticalAlign:"-0.23em"}).attr("src",`/data/ui/classes/${t[3]}.avif`);i.prepend(e);const c=g("img").css("icon").style({height:"1.1em",verticalAlign:"-0.23em"}).attr("src",`/data/ui/classes/${t[6]}.avif`);n.prepend(c);const d=g("img").css("icon").style({height:"1.1em",verticalAlign:"-0.23em"}).attr("src","/data/ui/currency/fame.svg");r.prepend(d),s.style({display:"inline"}).add(g("span").css("textfame").text("pvp ")).add(e).add(i).add(a).add(g("span").css("textfame").text(" killed ")).add(c).add(n).add(o).add(g("span").css("textfame").text(" for ")).add(r).add(g("span").css("textfame").text(" and ")).add(l)}return s},formatInv(e){const t=g("span").css("textinv").text(e[2]);return e[3]&&t.add(this.formatCurrency(e[3])),t},formatMessage:(e,t)=>g("span").css(`text${e}`).text(t[2]).style({display:"inline"}),showMessage(e){const t=this.logChannelType[e[1]];let s=!1;if("GM"===t||"error"===t?s=this.formatMessage(t,e):"pvp"===t&&this.state.killsShow?s=this.formatKill(t,e):"fame"===t&&this.state.fameShow||"notice"===t&&this.state.noteShow||"system"===t&&this.state.sysShow||"lvlup"===t&&this.state.lvlShow||"exp"===t&&this.state.expShow?s=this.formatMessage(t,e):"inv"===t&&this.state.invShow&&(s=this.formatInv(e)),s){const t=g("div").css("line"),a=g("div").css("linewrap");if(t.add(a),!this.state.isFormated){const t=this.formatDate(e[0]);a.add(t)}a.add(s),this.content.add(t),this.content.element.scrollTop=this.content.element.scrollHeight}},addRecord(e){this.state.log.push(e),this.state.log.length>100&&this.state.log.shift(),this.showMessage(e)},handleArticle(e){const t=e.obj;if(!t?.channelType)return;const{channelType:s,text:a}=t;if(this.logChannelType.includes(s)){e.element.style.display="none";const t=this.logChannelType.indexOf(s);if("pvp"==s){const e=a.children[0],s=[Date.now(),t,"textf0"==e.children[2].className?0:1,parseFloat(e.children[0].attributes.src.value[17]),parseFloat(e.children[1].innerText),e.children[2].innerText,parseFloat(e.children[3].attributes.src.value[17]),parseFloat(e.children[4].innerText),e.children[5].innerText,parseFloat(e.children[6]?.innerText.split(" ").join(""))||0,parseFloat(e.children[7]?.innerText.split(" ").join(""))||0];this.addRecord(s)}else if("inv"==s)if(a.children.length>0&&a.children[0].children.length>0){const e=a.children[0].childNodes[0].textContent,s=parseFloat(a.children[0].childNodes[1].textContent.split(" ").join(""))||0;this.addRecord([Date.now(),t,e,s])}else this.addRecord([Date.now(),t,a.innerText]);else{const e=a.children.length>0?a.children[0].innerText:a.innerText;this.addRecord([Date.now(),t,e])}this.content.element.children.length>100&&this.content.element.removeChild(this.content.element.firstElementChild)}}};window.kl=Oe;const Ke=[Me,be,C,M,A,S,N,D,v,Ie,q,re,ce,le,de,he,I,ue,ve,ye,xe,ke,we,Ce,Se,Re,Te,Pe,Le,Oe,{name:"Skillbar Tweaks",description:"Removes Skillbar Tooltips",state:{tooltips:!1},style:"\n        #skillbar .slotdescription {\n            display: none;\n        }\n    "}];class Ge{#e={};constructor(){for(const e of Ke){if(!Object.prototype.hasOwnProperty.call(e,"name"))throw new Error("Mod name is missing or falsy!");e._enabled=!0,this.#e[e.name]=e}l.register("modules"),o.on("state.load",this.onLoad,this),o.on("state.save",this.onSave,this)}init(){for(const e of Object.values(this.#e))e._enabled&&Object.prototype.hasOwnProperty.call(e,"start")&&e.start()}onLoad(e){const t=B.playerName;for(const[s,a]of Object.entries(e.modules)){if(!Object.prototype.hasOwnProperty.call(this.#e,s)){delete e.modules[s];continue}const n=this.#e[s];if(n._enabled=a._enabled,Object.prototype.hasOwnProperty.call(n,"state")){const e=t in a?a[t]:a._state;if(e){for(const t in e)t in n.state||delete e[t];n.state={...n.state,...e}}}}}onSave(e){const t=B.playerName;for(const{name:s,_enabled:a,state:n,_profiles:i}of Object.values(this.#e)){const o=e.modules[s]||{};o._enabled=void 0===a||a,n&&i?o[t]=n:n&&(o._state=n),e.modules[s]=o}}toggle(e){this.#e[e]._enabled^=1,this.#e[e]._enabled?this.start(e):this.stop(e),o.trigger("mod.toggle",this.#e[e])}start(e){const t=this.#e[e];Object.prototype.hasOwnProperty.call(t,"start")&&t.start()}stop(e){const t=this.#e[e];Object.prototype.hasOwnProperty.call(t,"stop")&&t.stop()}status(e){return this.#e[e]?._enabled}get(e){return this.#e[e]}[Symbol.iterator](){const e=Object.keys(this.#e).sort();let t=0;return{next:()=>t<e.length?{value:this.#e[e[t++]],done:!1}:{done:!0}}}}const He=new Ge;class _e{#e={};constructor(){l.register("keys"),o.on("state.load",this.onLoad,this),o.on("state.save",this.onSave,this),o.on("mod.toggle",this.onModToggle,this),document.addEventListener("keyup",this.handleKeyUp.bind(this))}init(){for(const e of He){const{name:t,hotkey:s}=e;if(s){this.#e[t]||={};for(const[a,{key:n,callback:i}]of Object.entries(s)){if("string"==typeof i&&Object.prototype.hasOwnProperty.call(e,i)&&"function"==typeof e[i]){const s=n.toLowerCase();this.#e[t][a]=s,o.on(`keyup.${s}`,e[i],e)}}}}}handleKeyUp(e){const t=e.target.tagName.toLowerCase();if("input"===t||"textarea"===t)return;const{key:s}=e;o.trigger("keyup."+s.toLowerCase())}onLoad(e){const{keys:t}=e;if(t)for(const e in t)if(Object.prototype.hasOwnProperty.call(this.#e,e))for(const[s,a]of Object.entries(t[e]))s in this.#e[e]&&this.updateKey(e,s,a)}onSave(e){e.keys=this.#e}onModToggle(e){const t=e.name;if(Object.prototype.hasOwnProperty.call(this.#e,t))for(const[e,s]of Object.entries(this.#e[t]))this.updateKey(t,e,s)}updateKey(e,t,s){let a=He.get(e),n=s.toLowerCase(),i=a.hotkey[t].callback,r=this.#e[e][t];this.#e[e][t]=n,o.off("keyup."+r,a[i],a),a._enabled&&o.on("keyup."+n,a[i],a)}[Symbol.iterator](){const e=Object.entries(this.#e);let t=0;return{next:()=>{if(t<e.length){const[s,a]=e[t++];return{value:[s,a],done:!1}}return{done:!0}}}}}const je=new _e;const ze=new class{constructor(){this.cssStyleSheet=new CSSStyleSheet,document.adoptedStyleSheets=[...document.adoptedStyleSheets,this.cssStyleSheet]}init(){this.css_mods=[...He].map((e=>e.style||"")).join(""),this.cssStyleSheet.replaceSync(this.css_mods)}add(e){e.split("}").forEach((e=>{const t=e.trim();""!==t&&this.cssStyleSheet.insertRule(t,this.cssStyleSheet.cssRules.length)})),document.adoptedStyleSheets=[...document.adoptedStyleSheets,this.cssStyleSheet]}show(){for(const e of this.cssStyleSheet.cssRules)console.log(e.cssText)}};const Ue=new class{constructor(){this.version=e,this.lastVersion=void 0,this.url=void 0,this.body=void 0,this.update=0}init(){o.on("ui.mainContainer",this.notification,this)}notification(e){fetch("https://api.github.com/repos/hordesmod/kek-ui/releases/latest").then((e=>e.json())).then((t=>{this.lastVersion=t.tag_name,this.url=t.assets[0].browser_download_url,this.body=t.body;const s=this.version.split(".").map(Number),a=this.lastVersion.split(".").map(Number);for(let e=0;e<3;e++)if(s[e]<a[e])this.update=1;else if(s[e]>a[e])break;if(this.update){const s=g("div").css("window-pos").style({zIndex:99,position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}),a=g("div").css("window panel-black").style({padding:"0 5px 5px",height:"100%",display:"grid",gridTemplateRows:"auto 1fr",transformOrigin:"inherit",minWidth:"fit-content",width:"500px"});s.add(a);const n=g("div").css("titleframe").style({cursor:"pointer"}).style({lineHeight:"1em",display:"flex",alignItems:"center",position:"relative",paddingTop:"4px",paddingBottom:"4px"}),i=g("div").css("textprimary title").text("KEK UI New Release").style({width:"100%",paddingLeft:"4px",fontWeight:"700",pointerEvents:"none"}),o=g("img").css("btn black svgicon").attr("src","/data/ui/icons/cross.svg").on("click",(()=>s.remove()));n.add(i).add(o),a.add(n);const r=g("div").css("slot"),l=g("div").css("container").style({minWidth:"200px",padding:"12px"});r.add(l);const c=g("p").text("We apologize for any inconvenience, but it's essential to update your 'KEK UI' mod now. ");l.add(c);const d=g("p").text("");l.add(d);const h=g("h3").css("textprimary").text(`New in version ${t.tag_name}:`);l.add(h),t.body.split("-").forEach((e=>{e&&l.add(g("p").text(`- ${e}`))}));const m=g("div").css("textprimary").text("-----");l.add(m);const p=g("div").text("Remember to press the button in Tampermonkey.");l.add(p).add(p);const u=g("div").css("textfame").text("[Update] / [Downgrade] / [Reinstall] / [Overwrite].");l.add(u).add(u);const f=g("div").css("container").style({minWidth:"200px",textAlign:"center",padding:"12px"});r.add(f);const y=g("div").css("btn green textblack").text("Update Now").on("click",(()=>{window.open(t.assets[0].browser_download_url),window.location.href="/"}));f.add(y),a.add(r),e.element.appendChild(s.element)}})).catch((e=>{console.error("Error fetching data:",e)}))}};const $e=new class{constructor(){this.menu={mod:{name:"[KEK] Mods",callback:"showMods"},key:{name:"[KEK] Hotkeys",callback:"showModKeys"},set:{name:"[KEK] Settings",callback:"showModSettings"}}}init(){o.on("ui.settingsParent",this.inject,this),ze.add("\n            .kek-settings {\n                display: grid;\n                grid-template-columns: 1fr 1fr;\n                grid-gap: 8px;\n                align-items: center;\n            }\n            .kek-settings.mods{\n                grid-template-columns: 4fr 1fr;\n            }\n            .title-grid{\n                display: grid;\n                grid-template-columns: auto 1fr;\n                grid-gap: 8px;\n                align-items: center;\n            }\n            .kek-settings .sound {\n                display: grid;\n                grid-template-columns: 3fr 1fr;\n                gap: 10px;\n                justify-content: center;\n                align-items: center;\n            }\n            .kek-settings .color {\n                display: grid;\n                grid-template-columns: 1fr auto;\n                gap: 10px;\n                justify-content: center;\n                align-items: center;\n            }\n            .kek-settings .key {\n                display: grid;\n                grid-template-columns: 1fr 1fr;\n                gap: 10px;\n                justify-content: center;\n                align-items: center;\n            }\n            .kek-settings .btn {\n                text-align: center;\n            }\n            .sticky {\n                position: sticky;\n                top: 0;\n                background-color: #10131d;\n            }\n        ")}inject(e){const t=e.element.children[0].children[1].children[0];this.panel=g("div").css("menu panel-black scrollbar").style({display:"none",paddingLeft:"12px",paddingTop:0}).text("test"),t.appendChild(this.panel.element);let s=t.children[0],a=t.children[1];for(const[e,t]of Object.entries(this.menu)){const a=g("div").css("choice").text(t.name).data("id",e);s.appendChild(a.element)}s.addEventListener("mouseup",(e=>{"choice"===e.target.className&&(s.childNodes.forEach((e=>e.classList.remove("active"))),e.target.dataset.id?(e.target.classList.add("active"),a.style.display="none",this.panel.style({display:"block"}),this[this.menu[e.target.dataset.id].callback]()):(a.style.display="block",this.panel.style({display:"none"})))}))}showMods(){const e=g("h3").css("textprimary").text("KEK mods"),t=g("div").css("kek-settings mods");this.panel.clear().add(e).add(t);for(const e of He){const s=g("div").css("").text(e.name);s.add(g("br")),s.add(g("small").css("textgrey").text(e.description||"<no description>")),t.add(s);const a=g("div").css("btn checkbox"+(He.status(e.name)?" active":"")).on("click",(()=>{He.toggle(e.name),a.toggle("active")}));t.add(a)}}showModKeys(){const e=g("h3").css("textprimary").text("KEK Hotkeys"),t=g("div").css("kek-settings");this.panel.clear().add(e).add(t);for(const[e,s]of je)if(He.get(e)._enabled){const a=g("div").css("textprimary").text(e);t.add(a).add(g("div"));for(const a in s)if(Object.prototype.hasOwnProperty.call(s,a)){const n=g("div").text(a),i=g("div").css("key"),o=g("input").type("text").value(s[a]).attr("maxlength",1).on("keyup",(t=>{t.target.value=t.key.toLowerCase(),je.updateKey(e,a,t.target.value)})),r=g("div").css("btn grey textwhite").text("clear").on("click",(()=>{o.element.value="",je.updateKey(e,a,"")}));i.add(o).add(r),t.add(n).add(i)}}}showModSettings(){const e=g("div").css("title-grid sticky"),t=g("h3").css("textprimary").text("KEK Settings"),s=g("div").css("panel-black"),a=g("select").css("btn grey").on("change",(e=>{const t=document.getElementById(e.target.value),s=this.panel.element;if(t){const e=-90,a=t.offsetTop+e;s.scrollTo({top:a,behavior:"smooth"})}}));s.add(a),e.add(t).add(s),this.settings=g("div").css("kek-settings"),this.panel.clear().add(e).add(this.settings);for(const e of He)if(e._enabled&&e.settings){const t=g("option").attr("value",e.name).text(e.name);a.add(t);const s=g("h3").css("textprimary").text(e.name).attr("id",e.name);this.settings.add(s).add(g("div"));for(const[t,s]of Object.entries(e.settings))this.makeField(e,t,s);this.settings.add(g("br")).add(g("div"))}}makeField(e,t,s){const a=g("div").text(s.desc);let n;if("checkbox"===s.control)n=g("div").css("btn checkbox"+(e.state[t]?" active":"")).on("pointerup",(a=>{0===a.button&&(a.target.classList.toggle("active"),e.state[t]^=1,s.onupdate&&e[s.onupdate]())}));else if("range"===s.control){let i=parseInt(e.state[t]),o=g("span").css("textgrey").text(i);a.element.appendChild(document.createTextNode(" ")),a.add(o),n=g("input").type("range"),n.element.step=s.step||1,n.element.min=s.min||0,n.element.max=s.max||100,n.element.value=i||50,n.on("input",(a=>{e.state[t]=parseInt(a.target.value),o.text(a.target.value),s.onupdate&&e[s.onupdate]()})),s.after&&n.on("change",(()=>{e[s.after]()}))}else if("text"===s.control)n=g("input").type("text").value(e.state[t]),n.on("input",(a=>{e.state[t]=a.target.value,s.onupdate&&e[s.onupdate]()}));else if("number"===s.control)n=g("input").type("number").value(e.state[t]),n.on("input",(a=>{e.state[t]=parseInt(parseFloat(a.target.value)),s.onupdate&&e[s.onupdate]()}));else if("select"===s.control){n=g("select");for(let[a,i]of Object.entries(s.options)){let s=g("option").value(a).selected(a==e.state[t]).text(i);n.add(s)}n.on("change",(a=>{e.state[t]=a.target.value,s.onupdate&&e[s.onupdate]()}))}else if("sound"===s.control){n=g("div").css("sound");const a=g("select");i(s.options);let o=g("option").value(0).selected(0===e.state[t]).text("-- No Sound --");a.add(o);for(let n of s.options){const s=g("option").value(n).selected(n===e.state[t]).text(n);a.add(s)}a.on("change",(a=>{e.state[t]=a.target.value,Ee.play(e.state[t]),s.onupdate&&e[s.onupdate]()}));const r=g("div").css("btn grey textwhite").text("⏵").on("click",(()=>{Ee.play(e.state[t])}));n.add(a).add(r)}else if("info"===s.control)n=g("span").text(e.state[t]);else if("color"===s.control){n=g("div").css("color");const a=g("input").type("color").value(e.state[t]).on("input",(a=>{e.state[t]=a.target.value,s.onupdate&&e[s.onupdate]()})),i=g("div").css("btn black").text("default color").style({color:s.default}).on("click",(()=>{a.element.value=s.default,e.state[t]=s.default,s.onupdate&&e[s.onupdate]()}));n.add(a).add(i)}else n=g("div").text(s.control);s.comment&&(a.add(g("br")),a.add(g("small").css("textgrey").text(s.comment))),this.settings.add(a),this.settings.add(n)}};new class{#e={};constructor(){l.register("cache")}};(new class{constructor(){}init(){if(document.querySelector("#ufplayer")){this.initializeCoreModules();const e=document.body;new MutationObserver((e=>{e.forEach((e=>{e.addedNodes.forEach((e=>{e instanceof HTMLElement&&e.matches(".layout")&&p.init()}))}))})).observe(e,{childList:!0})}else setTimeout(this.init.bind(this),1)}initializeCoreModules(){Ue.init(),a.init(),n.init(),B.init(),B.playerName.endsWith("...")?(console.error("wrong profile found retrying..."),setTimeout(this.initializeCoreModules.bind(this),0)):(je.init(),ze.init(),$e.init(),l.init(),He.init(),p.init(),window.addEventListener("beforeunload",(()=>{l.save()})))}}).init();
